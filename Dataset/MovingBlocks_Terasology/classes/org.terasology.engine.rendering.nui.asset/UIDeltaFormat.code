/** 
 * Enables UI screens (.ui) to have delta files. The delta files share the same extension as UI screens. Note that in the current form, only skinning is supported via delta files. Further, the skin you are overriding the existing skin with should reside in the same module as the delta file.
 */
@RegisterAssetDeltaFileFormat public class UIDeltaFormat extends AbstractAssetAlterationFileFormat<UIData> {
  private static final Logger logger=LoggerFactory.getLogger(UIDeltaFormat.class);
  public UIDeltaFormat(){
    super("ui");
  }
  @Override public void apply(  AssetDataFile input,  UIData assetData) throws IOException {
    try (JsonReader reader=new JsonReader(new InputStreamReader(input.openStream(),Charsets.UTF_8))){
      JsonElement jsonElement=new JsonParser().parse(reader);
      String skinUri=jsonElement.getAsJsonObject().get("skin").getAsString();
      String filePath=input.toString();
      String moduleName=filePath.substring(1,filePath.indexOf('/',1));
      Optional<UISkin> skin=Assets.getSkin(moduleName + ":" + skinUri);
      if (skin.isPresent()) {
        assetData.getRootWidget().setSkin(skin.get());
      }
 else {
        logger.warn("Failed to load skin " + skinUri + " for the delta file "+ input.getFilename());
      }
    }
   }
}
