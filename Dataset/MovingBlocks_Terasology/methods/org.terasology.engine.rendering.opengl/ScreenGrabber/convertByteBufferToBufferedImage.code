/** 
 * Transforms ByteBuffer into BufferedImage with specified width and height.
 */
private BufferedImage convertByteBufferToBufferedImage(ByteBuffer buffer,int width,int height){
  BufferedImage image=new BufferedImage(width,height,BufferedImage.TYPE_INT_RGB);
  for (int x=0; x < width; x++) {
    for (int y=0; y < height; y++) {
      int i=(x + width * y) * 4;
      int r=buffer.get(i) & 0xFF;
      int g=buffer.get(i + 1) & 0xFF;
      int b=buffer.get(i + 2) & 0xFF;
      image.setRGB(x,height - (y + 1),(0xFF << 24) | (r << 16) | (g << 8)| b);
    }
  }
  return image;
}
