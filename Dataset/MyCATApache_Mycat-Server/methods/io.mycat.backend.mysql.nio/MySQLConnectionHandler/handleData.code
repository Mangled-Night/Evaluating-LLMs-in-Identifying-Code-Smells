@Override protected void handleData(byte[] data){
switch (resultStatus) {
case RESULT_STATUS_INIT:
switch (data[4]) {
case OkPacket.FIELD_COUNT:
      int packetSize=(int)ByteUtil.readLength(data,0);
    if (packetSize == PreparedOkPacket.PACKET_SIZE && (responseHandler != null && responseHandler instanceof PrepareRequestHandler)) {
      handlePrepareOkPacket(data);
      resultStatus=RESULT_STATUS_PREPARE_RESPONSE_OK;
    }
 else {
      handleOkPacket(data);
    }
  break;
case ErrorPacket.FIELD_COUNT:
handleErrorPacket(data);
break;
case RequestFilePacket.FIELD_COUNT:
handleRequestPacket(data);
break;
default :
resultStatus=RESULT_STATUS_HEADER;
header=data;
fields=new ArrayList<byte[]>((int)ByteUtil.readLength(data,4));
}
break;
case RESULT_STATUS_HEADER:
switch (data[4]) {
case ErrorPacket.FIELD_COUNT:
resultStatus=RESULT_STATUS_INIT;
handleErrorPacket(data);
break;
case EOFPacket.FIELD_COUNT:
resultStatus=RESULT_STATUS_FIELD_EOF;
handleFieldEofPacket(data);
break;
default :
fields.add(data);
}
break;
case RESULT_STATUS_FIELD_EOF:
switch (data[4]) {
case ErrorPacket.FIELD_COUNT:
resultStatus=RESULT_STATUS_INIT;
handleErrorPacket(data);
break;
case EOFPacket.FIELD_COUNT:
resultStatus=RESULT_STATUS_INIT;
handleRowEofPacket(data);
break;
default :
handleRowPacket(data);
}
break;
case RESULT_STATUS_PREPARE_RESPONSE_OK:
handlePrepareOkPacket(data);
break;
default :
throw new RuntimeException("unknown status!");
}
}
