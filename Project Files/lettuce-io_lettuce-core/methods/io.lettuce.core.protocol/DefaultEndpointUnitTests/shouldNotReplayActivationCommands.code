@Test void shouldNotReplayActivationCommands(){
  when(channel.isActive()).thenReturn(true);
  ConnectionTestUtil.getDisconnectedBuffer(sut).add(new DefaultEndpoint.ActivationCommand<>(new Command<>(CommandType.SELECT,new StatusOutput<>(StringCodec.UTF8))));
  ConnectionTestUtil.getDisconnectedBuffer(sut).add(new LatencyMeteredCommand<>(new DefaultEndpoint.ActivationCommand<>(new Command<>(CommandType.SUBSCRIBE,new StatusOutput<>(StringCodec.UTF8)))));
  doAnswer(i -> {
    sut.write(new Command<>(CommandType.AUTH,new StatusOutput<>(StringCodec.UTF8)));
    return null;
  }
).when(connectionFacade).activated();
  sut.notifyChannelActive(channel);
  DefaultChannelPromise promise=new DefaultChannelPromise(channel,ImmediateEventExecutor.INSTANCE);
  when(channel.writeAndFlush(any())).thenAnswer(invocation -> {
    if (invocation.getArguments()[0] instanceof RedisCommand) {
      queue.add((RedisCommand)invocation.getArguments()[0]);
    }
    if (invocation.getArguments()[0] instanceof Collection) {
      queue.addAll((Collection)invocation.getArguments()[0]);
    }
    return promise;
  }
);
  assertThat(queue).hasSize(1).extracting(RedisCommand::getType).containsOnly(CommandType.AUTH);
}
