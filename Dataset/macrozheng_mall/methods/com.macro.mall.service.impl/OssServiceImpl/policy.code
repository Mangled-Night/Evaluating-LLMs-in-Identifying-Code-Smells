/** 
 * 签名生成
 */
@Override public OssPolicyResult policy(){
  OssPolicyResult result=new OssPolicyResult();
  SimpleDateFormat sdf=new SimpleDateFormat("yyyyMMdd");
  String dir=ALIYUN_OSS_DIR_PREFIX + sdf.format(new Date());
  long expireEndTime=System.currentTimeMillis() + ALIYUN_OSS_EXPIRE * 1000;
  Date expiration=new Date(expireEndTime);
  long maxSize=ALIYUN_OSS_MAX_SIZE * 1024 * 1024;
  OssCallbackParam callback=new OssCallbackParam();
  callback.setCallbackUrl(ALIYUN_OSS_CALLBACK);
  callback.setCallbackBody("filename=${object}&size=${size}&mimeType=${mimeType}&height=${imageInfo.height}&width=${imageInfo.width}");
  callback.setCallbackBodyType("application/x-www-form-urlencoded");
  String action="http://" + ALIYUN_OSS_BUCKET_NAME + "."+ ALIYUN_OSS_ENDPOINT;
  try {
    PolicyConditions policyConds=new PolicyConditions();
    policyConds.addConditionItem(PolicyConditions.COND_CONTENT_LENGTH_RANGE,0,maxSize);
    policyConds.addConditionItem(MatchMode.StartWith,PolicyConditions.COND_KEY,dir);
    String postPolicy=ossClient.generatePostPolicy(expiration,policyConds);
    byte[] binaryData=postPolicy.getBytes("utf-8");
    String policy=BinaryUtil.toBase64String(binaryData);
    String signature=ossClient.calculatePostSignature(postPolicy);
    String callbackData=BinaryUtil.toBase64String(JSONUtil.parse(callback).toString().getBytes("utf-8"));
    result.setAccessKeyId(ossClient.getCredentialsProvider().getCredentials().getAccessKeyId());
    result.setPolicy(policy);
    result.setSignature(signature);
    result.setDir(dir);
    result.setCallback(callbackData);
    result.setHost(action);
  }
 catch (  Exception e) {
    LOGGER.error("签名生成失败",e);
  }
  return result;
}
