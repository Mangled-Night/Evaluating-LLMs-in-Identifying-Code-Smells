@Override protected void initChannel(Channel ch) throws Exception {
  ChannelPipeline p=ch.pipeline();
  p.addLast(MetricRecordingHandler.NAME,new MetricRecordingHandler());
  p.addLast("inflateDecoder",new Lz4FrameDecoder());
  p.addLast("lengthFrameDecoder",new LengthFieldBasedFrameDecoder(8388608,0,3,0,3));
  p.addLast("protobufDecoder",new ProtobufDecoder(NetData.NetMessage.getDefaultInstance()));
  p.addLast("deflateEncoder",new Lz4FrameEncoder(true));
  p.addLast("frameLengthEncoder",new LengthFieldPrepender(3));
  p.addLast("protobufEncoder",new ProtobufEncoder());
  p.addLast("authenticationHandler",createWithConstructorInjection(ServerHandshakeHandler.class,context));
  p.addLast("connectionHandler",createWithConstructorInjection(ServerConnectionHandler.class,context));
  p.addLast("handler",createWithConstructorInjection(ServerHandler.class,context));
}
