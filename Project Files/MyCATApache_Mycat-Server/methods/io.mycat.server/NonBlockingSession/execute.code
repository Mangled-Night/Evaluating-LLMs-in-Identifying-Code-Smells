@Override public void execute(RouteResultset rrs,int type){
  this.rrs=rrs;
  clearHandlesResources();
  if (LOGGER.isDebugEnabled()) {
    StringBuilder s=new StringBuilder();
    LOGGER.debug(s.append(source).append(rrs).toString() + " rrs ");
  }
  RouteResultsetNode[] nodes=rrs.getNodes();
  if (nodes == null || nodes.length == 0 || nodes[0].getName() == null || nodes[0].getName().equals("")) {
    source.writeErrMessage(ErrorCode.ER_NO_DB_ERROR,"No dataNode found ,please check tables defined in schema:" + source.getSchema());
    source.getListener().fireEvent(SqlExecuteStage.END);
    return;
  }
  boolean autocommit=source.isAutocommit();
  final int initCount=target.size();
  if (nodes.length == 1) {
    singleNodeHandler=new SingleNodeHandler(rrs,this);
    if (this.isPrepared()) {
      singleNodeHandler.setPrepared(true);
    }
    try {
      if (initCount > 1) {
        checkDistriTransaxAndExecute(rrs,1,autocommit);
      }
 else {
        singleNodeHandler.execute();
      }
    }
 catch (    Exception e) {
      LOGGER.warn(new StringBuilder().append(source).append(rrs).toString(),e);
      source.writeErrMessage(ErrorCode.ERR_HANDLE_DATA,e.toString());
      source.getListener().fireEvent(SqlExecuteStage.END);
    }
  }
 else {
    multiNodeHandler=new MultiNodeQueryHandler(type,rrs,autocommit,this);
    if (this.isPrepared()) {
      multiNodeHandler.setPrepared(true);
    }
    try {
      if (((type == ServerParse.DELETE || type == ServerParse.INSERT || type == ServerParse.UPDATE) && !rrs.isGlobalTable() && nodes.length > 1) || initCount > 1) {
        checkDistriTransaxAndExecute(rrs,2,autocommit);
      }
 else {
        multiNodeHandler.execute();
      }
    }
 catch (    Exception e) {
      LOGGER.warn(new StringBuilder().append(source).append(rrs).toString(),e);
      source.writeErrMessage(ErrorCode.ERR_HANDLE_DATA,e.toString());
      source.getListener().fireEvent(SqlExecuteStage.END);
    }
  }
  if (this.isPrepared()) {
    this.setPrepared(false);
  }
}
