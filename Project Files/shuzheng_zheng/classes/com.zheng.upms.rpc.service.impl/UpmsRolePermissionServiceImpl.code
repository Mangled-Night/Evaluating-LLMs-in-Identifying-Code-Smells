/** 
 * UpmsRolePermissionService实现 Created by shuzheng on 2017/3/20.
 */
@Service @Transactional @BaseService public class UpmsRolePermissionServiceImpl extends BaseServiceImpl<UpmsRolePermissionMapper,UpmsRolePermission,UpmsRolePermissionExample> implements UpmsRolePermissionService {
  private static final Logger LOGGER=LoggerFactory.getLogger(UpmsRolePermissionServiceImpl.class);
  @Autowired UpmsRolePermissionMapper upmsRolePermissionMapper;
  @Override public int rolePermission(  JSONArray datas,  int id){
    List<Integer> deleteIds=new ArrayList<>();
    for (int i=0; i < datas.size(); i++) {
      JSONObject json=datas.getJSONObject(i);
      if (!json.getBoolean("checked")) {
        deleteIds.add(json.getIntValue("id"));
      }
 else {
        UpmsRolePermission upmsRolePermission=new UpmsRolePermission();
        upmsRolePermission.setRoleId(id);
        upmsRolePermission.setPermissionId(json.getIntValue("id"));
        upmsRolePermissionMapper.insertSelective(upmsRolePermission);
      }
    }
    if (deleteIds.size() > 0) {
      UpmsRolePermissionExample upmsRolePermissionExample=new UpmsRolePermissionExample();
      upmsRolePermissionExample.createCriteria().andPermissionIdIn(deleteIds).andRoleIdEqualTo(id);
      upmsRolePermissionMapper.deleteByExample(upmsRolePermissionExample);
    }
    return datas.size();
  }
}
