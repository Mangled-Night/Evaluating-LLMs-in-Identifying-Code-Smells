@Nested class Subscribers {
  private Setting<Integer> setting;
  private SettingChangeListener<Integer> listener;
  private int eventCallCount;
  @BeforeEach public void setUp(){
    setting=new SettingImpl<>(TypeInfo.of(Integer.class),50,new NumberRangeConstraint<>(0,100,false,false),"","",Optional::empty);
    eventCallCount=0;
    listener=(setting,oldValue) -> eventCallCount++;
  }
  @Test void testHasSubscribers(){
    setting.subscribe(listener);
    assertTrue(setting.hasSubscribers());
    setting.unsubscribe(listener);
    assertFalse(setting.hasSubscribers());
  }
  @Test void testSetEventCall(){
    setting.subscribe(listener);
    Random random=new FastRandom();
    final int maxSetValueCount=50;
    int expectedEventCallCount=0;
    for (int i=0; i < maxSetValueCount; i++) {
      int randomInt=random.nextInt(-50,150);
      expectedEventCallCount+=setting.set(randomInt) ? 1 : 0;
    }
    assertEquals(expectedEventCallCount,eventCallCount);
  }
  @Test void testSubscribe(){
    final int subscriberCount=10;
    for (int i=0; i < subscriberCount; i++) {
      setting.subscribe((setting1,oldValue) -> eventCallCount++);
    }
    setting.set(30);
    assertEquals(subscriberCount,eventCallCount);
  }
  @Test void testUnsubscribe(){
    int subscriberCount=10;
    List<SettingChangeListener<Integer>> listeners=Lists.newArrayListWithCapacity(subscriberCount);
    for (int i=0; i < subscriberCount; i++) {
      SettingChangeListener<Integer> listener=(setting1,oldValue) -> eventCallCount++;
      listeners.add(listener);
      setting.subscribe(listener);
    }
    for (int i=0; i < new FastRandom().nextInt(subscriberCount / 2); i++) {
      setting.unsubscribe(listeners.get(i));
      subscriberCount--;
    }
    setting.set(30);
    assertEquals(subscriberCount,eventCallCount);
  }
}
