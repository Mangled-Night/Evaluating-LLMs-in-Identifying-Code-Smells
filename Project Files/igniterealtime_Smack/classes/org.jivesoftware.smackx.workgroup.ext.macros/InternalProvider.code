/** 
 * An IQProvider for Macro packets.
 * @author Derek DeMoro
 */
public static class InternalProvider extends IqProvider<Macros> {
  @Override public Macros parse(  XmlPullParser parser,  int initialDepth,  IqData iqData,  XmlEnvironment xmlEnvironment) throws XmlPullParserException, IOException {
    Macros macroGroup=new Macros();
    boolean done=false;
    while (!done) {
      XmlPullParser.Event eventType=parser.next();
      if (eventType == XmlPullParser.Event.START_ELEMENT) {
        if (parser.getName().equals("model")) {
          String macros=parser.nextText();
          MacroGroup group=parseMacroGroups(macros);
          macroGroup.setRootGroup(group);
        }
      }
 else       if (eventType == XmlPullParser.Event.END_ELEMENT) {
        if (parser.getName().equals(ELEMENT_NAME)) {
          done=true;
        }
      }
    }
    return macroGroup;
  }
  public Macro parseMacro(  XmlPullParser parser) throws XmlPullParserException, IOException {
    Macro macro=new Macro();
    boolean done=false;
    while (!done) {
      XmlPullParser.Event eventType=parser.next();
      if (eventType == XmlPullParser.Event.START_ELEMENT) {
        if (parser.getName().equals("title")) {
          parser.next();
          macro.setTitle(parser.getText());
        }
 else         if (parser.getName().equals("description")) {
          macro.setDescription(parser.nextText());
        }
 else         if (parser.getName().equals("response")) {
          macro.setResponse(parser.nextText());
        }
 else         if (parser.getName().equals("type")) {
          macro.setType(Integer.valueOf(parser.nextText()).intValue());
        }
      }
 else       if (eventType == XmlPullParser.Event.END_ELEMENT) {
        if (parser.getName().equals("macro")) {
          done=true;
        }
      }
    }
    return macro;
  }
  public MacroGroup parseMacroGroup(  XmlPullParser parser) throws XmlPullParserException, IOException {
    MacroGroup group=new MacroGroup();
    boolean done=false;
    while (!done) {
      XmlPullParser.Event eventType=parser.next();
      if (eventType == XmlPullParser.Event.START_ELEMENT) {
        if (parser.getName().equals("macrogroup")) {
          group.addMacroGroup(parseMacroGroup(parser));
        }
        if (parser.getName().equals("title")) {
          group.setTitle(parser.nextText());
        }
        if (parser.getName().equals("macro")) {
          group.addMacro(parseMacro(parser));
        }
      }
 else       if (eventType == XmlPullParser.Event.END_ELEMENT) {
        if (parser.getName().equals("macrogroup")) {
          done=true;
        }
      }
    }
    return group;
  }
  public MacroGroup parseMacroGroups(  String macros) throws XmlPullParserException, IOException {
    MacroGroup group=null;
    XmlPullParser parser=PacketParserUtils.getParserFor(macros);
    XmlPullParser.Event eventType=parser.getEventType();
    while (eventType != XmlPullParser.Event.END_DOCUMENT) {
      eventType=parser.next();
      if (eventType == XmlPullParser.Event.START_ELEMENT) {
        if (parser.getName().equals("macrogroup")) {
          group=parseMacroGroup(parser);
        }
      }
    }
    return group;
  }
}
