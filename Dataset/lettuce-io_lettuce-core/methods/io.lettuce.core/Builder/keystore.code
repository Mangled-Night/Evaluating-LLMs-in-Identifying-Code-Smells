/** 
 * Sets the Keystore file to load client certificates. The key store file must be supported by {@link java.security.KeyStore} which is {@link KeyStore#getDefaultType()} by default. The keystore is reloaded oneach connection attempt that allows to replace certificates during runtime.
 * @param keystore the keystore file, must not be {@code null}.
 * @return {@code this}
 * @since 4.4
 */
public Builder keystore(File keystore){
  return keystore(keystore,new char[0]);
}
/** 
 * Sets the Keystore file to load client certificates. The keystore file must be supported by {@link java.security.KeyStore} which is {@link KeyStore#getDefaultType()} by default. The keystore is reloaded oneach connection attempt that allows to replace certificates during runtime.
 * @param keystore the keystore file, must not be {@code null}.
 * @param keystorePassword the keystore password. May be empty to omit password and the keystore integrity check.
 * @return {@code this}
 * @since 4.4
 */
public Builder keystore(File keystore,char[] keystorePassword){
  LettuceAssert.notNull(keystore,"Keystore must not be null");
  LettuceAssert.isTrue(keystore.exists(),() -> String.format("Keystore file %s does not exist",truststore));
  LettuceAssert.isTrue(keystore.isFile(),() -> String.format("Keystore %s is not a file",truststore));
  return keystore(Resource.from(keystore),keystorePassword);
}
/** 
 * Sets the Keystore resource to load client certificates. The keystore file must be supported by {@link java.security.KeyStore} which is {@link KeyStore#getDefaultType()} by default. The keystore is reloaded oneach connection attempt that allows to replace certificates during runtime.
 * @param keystore the keystore URL, must not be {@code null}.
 * @return {@code this}
 * @since 4.4
 */
public Builder keystore(URL keystore){
  return keystore(keystore,null);
}
/** 
 * Sets the Keystore resource to load client certificates. The keystore file must be supported by {@link java.security.KeyStore} which is {@link KeyStore#getDefaultType()} by default. The keystore is reloaded oneach connection attempt that allows to replace certificates during runtime.
 * @param keystore the keystore file, must not be {@code null}.
 * @return {@code this}
 * @since 4.4
 */
public Builder keystore(URL keystore,char[] keystorePassword){
  LettuceAssert.notNull(keystore,"Keystore must not be null");
  this.keystore=keystore;
  return keystore(Resource.from(keystore),keystorePassword);
}
/** 
 * Sets the Java Keystore resource to load client certificates. The keystore file must be supported by {@link java.security.KeyStore} which is {@link KeyStore#getDefaultType()} by default. The keystore is reloaded oneach connection attempt that allows to replace certificates during runtime.
 * @param resource the provider that opens a {@link InputStream} to the keystore file, must not be {@code null}.
 * @param keystorePassword the keystore password. May be empty to omit password and the keystore integrity check.
 * @return {@code this}
 * @since 5.3
 */
public Builder keystore(Resource resource,char[] keystorePassword){
  LettuceAssert.notNull(resource,"Keystore InputStreamProvider must not be null");
  char[] keystorePasswordToUse=getPassword(keystorePassword);
  this.keystorePassword=keystorePasswordToUse;
  this.keymanager=(builder,keyStoreType) -> {
    try (InputStream is=resource.get()){
      builder.keyManager(createKeyManagerFactory(is,keystorePasswordToUse,keyStoreType));
    }
   }
;
  return this;
}
