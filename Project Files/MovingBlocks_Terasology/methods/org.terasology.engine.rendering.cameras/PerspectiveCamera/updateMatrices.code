@Override public void updateMatrices(){
  updateMatrices(activeFov);
}
@Override public void updateMatrices(float fov){
  if (cachedPosition.equals(getPosition()) && cachedViewigDirection.equals(viewingDirection) && cachedBobbingRotationOffsetFactor == bobbingRotationOffsetFactor && cachedBobbingVerticalOffsetFactor == bobbingVerticalOffsetFactor && cachedFov == fov && cachedZFar == getzFar() && cachedZNear == getzNear() && cachedReflectionHeight == getReflectionHeight()) {
    return;
  }
  viewingDirection.cross(up,tempRightVector);
  tempRightVector.mul(bobbingRotationOffsetFactor);
  float aspectRatio=(float)displayDevice.getWidth() / displayDevice.getHeight();
  float fovY=(float)(2 * Math.atan2(Math.tan(0.5 * fov * TeraMath.DEG_TO_RAD),aspectRatio));
  projectionMatrix.setPerspective(fovY,aspectRatio,getzNear(),getzFar());
  viewMatrix.setLookAt(0f,bobbingVerticalOffsetFactor * 2.0f,0f,viewingDirection.x,viewingDirection.y + bobbingVerticalOffsetFactor * 2.0f,viewingDirection.z,up.x + tempRightVector.x,up.y + tempRightVector.y,up.z + tempRightVector.z);
  normViewMatrix.setLookAt(0f,bobbingVerticalOffsetFactor * 2.0f,0f,viewingDirection.x,viewingDirection.y + bobbingVerticalOffsetFactor * 2.0f,viewingDirection.z,up.x + tempRightVector.x,up.y + tempRightVector.y,up.z + tempRightVector.z);
  reflectionMatrix.setRow(0,new Vector4f(1.0f,0.0f,0.0f,0.0f));
  reflectionMatrix.setRow(1,new Vector4f(0.0f,-1.0f,0.0f,2f * (-position.y + getReflectionHeight())));
  reflectionMatrix.setRow(2,new Vector4f(0.0f,0.0f,1.0f,0.0f));
  reflectionMatrix.setRow(3,new Vector4f(0.0f,0.0f,0.0f,1.0f));
  viewMatrix.mul(reflectionMatrix,viewMatrixReflected);
  reflectionMatrix.setRow(1,new Vector4f(0.0f,-1.0f,0.0f,0.0f));
  normViewMatrix.mul(reflectionMatrix,normViewMatrixReflected);
  projectionMatrix.mul(viewMatrix,viewProjectionMatrix);
  projectionMatrix.invert(inverseProjectionMatrix);
  viewProjectionMatrix.invert(inverseViewProjectionMatrix);
  cachedPosition.set(getPosition());
  cachedViewigDirection.set(viewingDirection);
  cachedBobbingVerticalOffsetFactor=bobbingVerticalOffsetFactor;
  cachedBobbingRotationOffsetFactor=bobbingRotationOffsetFactor;
  cachedFov=fov;
  cachedZNear=getzNear();
  cachedZFar=getzFar();
  cachedReflectionHeight=getReflectionHeight();
  updateFrustum();
}
