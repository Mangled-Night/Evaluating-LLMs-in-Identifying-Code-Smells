public final class Chat extends Manager {
  private final EntityBareJid jid;
  volatile EntityFullJid lockedResource;
  Presence lastPresenceOfLockedResource;
  Chat(  final XMPPConnection connection,  EntityBareJid jid){
    super(connection);
    this.jid=jid;
  }
  public void send(  CharSequence message) throws NotConnectedException, InterruptedException {
    Message stanza=connection().getStanzaFactory().buildMessageStanza().ofType(Message.Type.chat).setBody(message).build();
    send(stanza);
  }
  public void send(  Message message) throws NotConnectedException, InterruptedException {
switch (message.getType()) {
case normal:
case chat:
      break;
default :
    throw new IllegalArgumentException("Message must be of type 'normal' or 'chat'");
}
Jid to=lockedResource;
if (to == null) {
  to=jid;
}
message.setTo(to);
connection().sendStanza(message);
}
public EntityBareJid getXmppAddressOfChatPartner(){
return jid;
}
void unlockResource(){
lockedResource=null;
lastPresenceOfLockedResource=null;
}
}
