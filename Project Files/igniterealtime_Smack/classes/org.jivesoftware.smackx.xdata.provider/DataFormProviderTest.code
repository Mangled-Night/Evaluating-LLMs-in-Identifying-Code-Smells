public class DataFormProviderTest {
  @Test public void testRetrieveFieldTypeFromReported() throws XmlPullParserException, IOException, SmackParsingException {
    String firstForm="<x xmlns='jabber:x:data' type='form'>" + "  <title>Advanced User Search</title>" + "  <instructions>The following fields are available for searching. Wildcard (*) characters are allowed as part of the query.</instructions>"+ "  <field var='FORM_TYPE' type='hidden'>"+ "    <value>jabber:iq:search</value>"+ "  </field>"+ "  <field label='Search' var='search'>"+ "    <required/>"+ "  </field>"+ "  <field label='Username' var='Username' type='boolean'>"+ "    <value>true</value>"+ "  </field>"+ "  <field label='Name' var='Name' type='boolean'>"+ "    <value>true</value>"+ "  </field>"+ "  <field label='Email' var='Email' type='boolean'>"+ "    <value>true</value>"+ "  </field>"+ "</x>";
    XmlPullParser parser=PacketParserUtils.getParserFor(firstForm);
    DataForm firstDataForm=DataFormProvider.INSTANCE.parse(parser);
    FormField usernameFormField=firstDataForm.getField("Username");
    assertEquals(FormField.Type.bool,usernameFormField.getType());
    String secondForm="<x xmlns='jabber:x:data' type='result'>" + "  <field var='FORM_TYPE' type='hidden'/>" + "  <reported>"+ "    <field var='jid' type='jid-single' label='JID'/>"+ "    <field var='Username' type='text-single' label='Username'/>"+ "    <field var='Name' type='text-single' label='Name'/>"+ "    <field var='Email' type='text-single' label='Email'/>"+ "  </reported>"+ "  <item>"+ "    <field var='Email'>"+ "      <value>"+ "        0"+ "      </value>"+ "    </field>"+ "    <field var='jid'>"+ "      <value>frank@orphu</value>"+ "    </field>"+ "    <field var='Username'>"+ "      <value>"+ "        frank"+ "      </value>"+ "    </field>"+ "    <field var='Name'>"+ "      <value>"+ "        0"+ "      </value>"+ "    </field>"+ "  </item>"+ "  <item>"+ "    <field var='Email'>"+ "      <value>"+ "      </value>"+ "    </field>"+ "    <field var='jid'>"+ "      <value>frank2@orphu</value>"+ "    </field>"+ "    <field var='Username'>"+ "      <value>"+ "        frank2"+ "      </value>"+ "    </field>"+ "    <field var='Name'>"+ "      <value>"+ "      </value>"+ "    </field>"+ "  </item>"+ "</x>";
    parser=PacketParserUtils.getParserFor(secondForm);
    DataForm secondDataForm=DataFormProvider.INSTANCE.parse(parser);
    List<DataForm.Item> items=secondDataForm.getItems();
    assertEquals(2,items.size());
  }
  @Test public void testRetrieveFieldWithEmptyLabel() throws XmlPullParserException, IOException, SmackParsingException {
    String form="<x xmlns='jabber:x:data' type='form'>" + "  <title>Advanced User Search</title>" + "  <instructions>The following fields are available for searching. Wildcard (*) characters are allowed as part of the query.</instructions>"+ "  <field var='FORM_TYPE' label='' type='hidden'>"+ "    <value>jabber:iq:search</value>"+ "  </field>"+ "  <field label='Search' var='search'>"+ "    <required/>"+ "  </field>"+ "  <field label='Username' var='Username' type='boolean'>"+ "    <value>true</value>"+ "  </field>"+ "  <field label='Name' var='Name' type='boolean'>"+ "    <value>true</value>"+ "  </field>"+ "  <field label='Email' var='Email' type='boolean'>"+ "    <value>true</value>"+ "  </field>"+ "</x>";
    XmlPullParser parser=PacketParserUtils.getParserFor(form);
    DataForm dataForm=DataFormProvider.INSTANCE.parse(parser);
    FormField usernameFormField=dataForm.getField("FORM_TYPE");
    assertEquals(FormField.Type.hidden,usernameFormField.getType());
    assertEquals("",usernameFormField.getLabel());
  }
}
