private CuratorTransactionFinal modifyRuleData(CuratorTransactionFinal transactionFinal,List<MigrateTask> allTaskList,TableConfig tableConfig,List<String> allNewDataNodes) throws Exception {
  InterProcessMutex ruleDataLock=null;
  try {
    String path=ZKUtils.getZKBasePath() + "lock/ruledata.lock";
    ruleDataLock=new InterProcessMutex(ZKUtils.getConnection(),path);
    ruleDataLock.acquire(30,TimeUnit.SECONDS);
    RuleConfig ruleConfig=tableConfig.getRule();
    String ruleName=((TableRuleAware)ruleConfig.getRuleAlgorithm()).getRuleName() + ".properties";
    String rulePath=ZKUtils.getZKBasePath() + "ruledata/" + ruleName;
    CuratorFramework zk=ZKUtils.getConnection();
    byte[] ruleData=zk.getData().forPath(rulePath);
    Properties prop=new Properties();
    prop.load(new ByteArrayInputStream(ruleData));
    for (    MigrateTask migrateTask : allTaskList) {
      modifyRuleData(prop,migrateTask,allNewDataNodes);
    }
    ByteArrayOutputStream out=new ByteArrayOutputStream();
    prop.store(out,"WARNING   !!!Please do not modify or delete this file!!!");
    if (transactionFinal == null) {
      transactionFinal=ZKUtils.getConnection().inTransaction().setData().forPath(rulePath,out.toByteArray()).and();
    }
 else {
      transactionFinal.setData().forPath(rulePath,out.toByteArray());
    }
  }
  finally {
    try {
      if (ruleDataLock != null)       ruleDataLock.release();
    }
 catch (    Exception e) {
      throw new RuntimeException(e);
    }
  }
  return transactionFinal;
}
private void modifyRuleData(Properties prop,MigrateTask task,List<String> allNewDataNodes){
  int fromIndex=-1;
  int toIndex=-1;
  List<String> dataNodes=allNewDataNodes;
  for (int i=0; i < dataNodes.size(); i++) {
    String dataNode=dataNodes.get(i);
    if (dataNode.equalsIgnoreCase(task.getFrom())) {
      fromIndex=i;
    }
 else     if (dataNode.equalsIgnoreCase(task.getTo())) {
      toIndex=i;
    }
  }
  String from=prop.getProperty(String.valueOf(fromIndex));
  String to=prop.getProperty(String.valueOf(toIndex));
  String fromRemain=removeRangesRemain(from,task.getSlots());
  String taskRanges=MigrateUtils.convertRangeListToString(task.getSlots());
  String newTo=to == null ? taskRanges : to + "," + taskRanges;
  prop.setProperty(String.valueOf(fromIndex),fromRemain);
  prop.setProperty(String.valueOf(toIndex),newTo);
}
