@SuppressWarnings({"unchecked","restriction"}) public static URL[] getUrls(ClassLoader classLoader){
  if (classLoader instanceof URLClassLoader) {
    return ((URLClassLoader)classLoader).getURLs();
  }
  if (classLoader.getClass().getName().startsWith("jdk.internal.loader.ClassLoaders$")) {
    try {
      Field field=sun.misc.Unsafe.class.getDeclaredField("theUnsafe");
      field.setAccessible(true);
      sun.misc.Unsafe unsafe=(sun.misc.Unsafe)field.get(null);
      Class<?> ucpOwner=classLoader.getClass();
      Field ucpField=null;
      while (ucpField == null && !ucpOwner.getName().equals("java.lang.Object")) {
        try {
          ucpField=ucpOwner.getDeclaredField("ucp");
        }
 catch (        NoSuchFieldException ex) {
          ucpOwner=ucpOwner.getSuperclass();
        }
      }
      if (ucpField == null) {
        return null;
      }
      long ucpFieldOffset=unsafe.objectFieldOffset(ucpField);
      Object ucpObject=unsafe.getObject(classLoader,ucpFieldOffset);
      if (ucpObject == null) {
        return null;
      }
      Field pathField=ucpField.getType().getDeclaredField("path");
      if (pathField == null) {
        return null;
      }
      long pathFieldOffset=unsafe.objectFieldOffset(pathField);
      ArrayList<URL> path=(ArrayList<URL>)unsafe.getObject(ucpObject,pathFieldOffset);
      return path.toArray(new URL[path.size()]);
    }
 catch (    Throwable e) {
      return null;
    }
  }
  return null;
}
