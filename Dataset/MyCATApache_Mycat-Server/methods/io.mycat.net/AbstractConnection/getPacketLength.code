protected int getPacketLength(ByteBuffer buffer,int offset){
  int headerSize=getPacketHeaderSize();
  if (isSupportCompress()) {
    headerSize=7;
  }
  if (buffer.position() < offset + headerSize) {
    return -1;
  }
 else {
    int length=buffer.get(offset) & 0xff;
    length|=(buffer.get(++offset) & 0xff) << 8;
    length|=(buffer.get(++offset) & 0xff) << 16;
    return length + headerSize;
  }
}
