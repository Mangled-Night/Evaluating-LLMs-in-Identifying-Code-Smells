public final class RelayHandler extends ChannelInboundHandlerAdapter {
  private final static Logger logger=LoggerFactory.getLogger(RelayHandler.class);
  private final Channel relayChannel;
  public RelayHandler(  Channel relayChannel){
    this.relayChannel=relayChannel;
  }
  @Override public void channelActive(  ChannelHandlerContext ctx){
    ctx.writeAndFlush(Unpooled.EMPTY_BUFFER);
  }
  @Override public void channelRead(  ChannelHandlerContext ctx,  Object msg){
    if (relayChannel.isActive()) {
      relayChannel.writeAndFlush(msg);
    }
 else {
      ReferenceCountUtil.release(msg);
    }
  }
  @Override public void channelInactive(  ChannelHandlerContext ctx){
    if (relayChannel.isActive()) {
      relayChannel.writeAndFlush(Unpooled.EMPTY_BUFFER).addListener(ChannelFutureListener.CLOSE);
    }
  }
  @Override public void exceptionCaught(  ChannelHandlerContext ctx,  Throwable cause){
    logger.error("",cause);
    ctx.close();
  }
}
