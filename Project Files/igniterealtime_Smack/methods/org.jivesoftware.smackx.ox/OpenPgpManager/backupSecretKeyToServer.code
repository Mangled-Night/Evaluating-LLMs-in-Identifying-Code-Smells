/** 
 * Upload the encrypted secret key to a private PEP node.
 * @see <a href="https://xmpp.org/extensions/xep-0373.html#synchro-pep">XEP-0373 ยง5</a>
 * @param selectKeyCallback callback, which will receive the users choice of which keys will be backed up.
 * @return secret key passphrase used to encrypt the backup.
 * @throws InterruptedException if the thread is interrupted.
 * @throws PubSubException.NotALeafNodeException if the private node is not a {@link LeafNode}.
 * @throws XMPPException.XMPPErrorException in case of an XMPP protocol error.
 * @throws SmackException.NotConnectedException if we are not connected.
 * @throws SmackException.NoResponseException if the server doesn't respond.
 * @throws SmackException.NotLoggedInException if we are not logged in.
 * @throws IOException IO is dangerous.
 * @throws SmackException.FeatureNotSupportedException if the server doesn't support the PubSub whitelist access model.
 * @throws PGPException PGP is brittle
 * @throws MissingOpenPgpKeyException in case we have no OpenPGP key pair to back up.
 */
public OpenPgpSecretKeyBackupPassphrase backupSecretKeyToServer(SecretKeyBackupSelectionCallback selectKeyCallback) throws InterruptedException, PubSubException.NotALeafNodeException, XMPPException.XMPPErrorException, SmackException.NotConnectedException, SmackException.NoResponseException, SmackException.NotLoggedInException, IOException, SmackException.FeatureNotSupportedException, PGPException, MissingOpenPgpKeyException {
  OpenPgpSecretKeyBackupPassphrase passphrase=SecretKeyBackupHelper.generateBackupPassword();
  backupSecretKeyToServer(selectKeyCallback,passphrase);
  return passphrase;
}
/** 
 * Upload the encrypted secret key to a private PEP node. The backup is encrypted using the provided secret key passphrase.
 * @see <a href="https://xmpp.org/extensions/xep-0373.html#synchro-pep">XEP-0373 ยง5</a>
 * @param selectKeyCallback callback, which will receive the users choice of which keys will be backed up.
 * @param passphrase secret key passphrase
 * @throws InterruptedException if the thread is interrupted.
 * @throws PubSubException.NotALeafNodeException if the private node is not a {@link LeafNode}.
 * @throws XMPPException.XMPPErrorException in case of an XMPP protocol error.
 * @throws SmackException.NotConnectedException if we are not connected.
 * @throws SmackException.NoResponseException if the server doesn't respond.
 * @throws SmackException.NotLoggedInException if we are not logged in.
 * @throws IOException IO is dangerous.
 * @throws SmackException.FeatureNotSupportedException if the server doesn't support the PubSub whitelist access model.
 * @throws PGPException PGP is brittle
 * @throws MissingOpenPgpKeyException in case we have no OpenPGP key pair to back up.
 */
public void backupSecretKeyToServer(SecretKeyBackupSelectionCallback selectKeyCallback,OpenPgpSecretKeyBackupPassphrase passphrase) throws InterruptedException, PubSubException.NotALeafNodeException, XMPPException.XMPPErrorException, SmackException.NotConnectedException, SmackException.NoResponseException, SmackException.NotLoggedInException, IOException, SmackException.FeatureNotSupportedException, PGPException, MissingOpenPgpKeyException {
  throwIfNoProviderSet();
  throwIfNotAuthenticated();
  BareJid ownJid=connection().getUser().asBareJid();
  PGPSecretKeyRingCollection secretKeyRings=provider.getStore().getSecretKeysOf(ownJid);
  Set<OpenPgpV4Fingerprint> availableKeyPairs=new HashSet<>();
  for (  PGPSecretKeyRing ring : secretKeyRings) {
    availableKeyPairs.add(new OpenPgpV4Fingerprint(ring));
  }
  Set<OpenPgpV4Fingerprint> selectedKeyPairs=selectKeyCallback.selectKeysToBackup(availableKeyPairs);
  SecretkeyElement secretKey=SecretKeyBackupHelper.createSecretkeyElement(provider,ownJid,selectedKeyPairs,passphrase);
  OpenPgpPubSubUtil.depositSecretKey(connection(),secretKey);
}
