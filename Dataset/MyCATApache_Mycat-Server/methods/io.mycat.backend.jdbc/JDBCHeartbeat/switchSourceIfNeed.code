/** 
 * switch data source
 */
private void switchSourceIfNeed(String reason){
  int switchType=source.getHostConfig().getSwitchType();
  String notSwitch=source.getHostConfig().getNotSwitch();
  if (notSwitch.equals(DataHostConfig.FOVER_NOT_SWITCH_DS) || switchType == DataHostConfig.NOT_SWITCH_DS) {
    if (LOGGER.isDebugEnabled()) {
      LOGGER.debug("not switch datasource ,for switchType is " + DataHostConfig.NOT_SWITCH_DS);
      return;
    }
    return;
  }
  if (LOGGER.isDebugEnabled()) {
    LOGGER.debug("to  switchSourceIfNeed function 进行读节点转换 ");
  }
  PhysicalDBPool pool=this.source.getDbPool();
  int curDatasourceHB=pool.getSource().getHeartbeat().getStatus();
  if (pool.getWriteType() == PhysicalDBPool.WRITE_ONLYONE_NODE && !source.isReadNode() && curDatasourceHB != DBHeartbeat.OK_STATUS && pool.getSources().length > 1) {
synchronized (pool) {
      curDatasourceHB=pool.getSource().getHeartbeat().getStatus();
      if (curDatasourceHB != DBHeartbeat.INIT_STATUS && curDatasourceHB != DBHeartbeat.OK_STATUS) {
        int curIndex=pool.getActivedIndex();
        int nextId=pool.next(curIndex);
        PhysicalDatasource[] allWriteNodes=pool.getSources();
        while (true) {
          if (nextId == curIndex) {
            break;
          }
          PhysicalDatasource theSource=allWriteNodes[nextId];
          DBHeartbeat theSourceHB=theSource.getHeartbeat();
          int theSourceHBStatus=theSourceHB.getStatus();
          if (theSourceHBStatus == DBHeartbeat.OK_STATUS) {
            if (switchType == DataHostConfig.SYN_STATUS_SWITCH_DS) {
              if (Integer.valueOf(0).equals(theSourceHB.getSlaveBehindMaster())) {
                LOGGER.info("try to switch datasource ,slave is synchronized to master " + theSource.getConfig());
                pool.switchSourceOrVoted(nextId,true,reason);
                break;
              }
 else {
                LOGGER.warn("ignored  datasource ,slave is not  synchronized to master , slave behind master :" + theSourceHB.getSlaveBehindMaster() + " "+ theSource.getConfig());
              }
            }
 else {
              LOGGER.info("try to switch datasource ,not checked slave synchronize status " + theSource.getConfig());
              pool.switchSourceOrVoted(nextId,true,reason);
              break;
            }
          }
          nextId=pool.next(nextId);
        }
      }
    }
  }
}
