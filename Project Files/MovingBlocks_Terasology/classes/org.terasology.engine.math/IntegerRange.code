public class IntegerRange implements Iterable<Integer> {
  private final Map<Integer,Integer> ranges=new TreeMap<>();
  public void addNumbers(  int from,  int to){
    if (from > to) {
      throw new IllegalArgumentException("From can't be larger than to");
    }
    Integer oldTo=ranges.get(from);
    if (oldTo == null || oldTo < to) {
      ranges.put(from,to);
    }
  }
  public IntegerRange copy(){
    IntegerRange newRange=new IntegerRange();
    for (    Map.Entry<Integer,Integer> entry : ranges.entrySet()) {
      newRange.addNumbers(entry.getKey(),entry.getValue());
    }
    return newRange;
  }
  @Override public Iterator<Integer> iterator(){
    return new RangesIterator(ranges);
  }
private static final class RangesIterator implements Iterator<Integer> {
    private Iterator<Map.Entry<Integer,Integer>> rangesIterator;
    private Integer next;
    private Integer rangeMax;
    private RangesIterator(    Map<Integer,Integer> iterator){
      this.rangesIterator=iterator.entrySet().iterator();
      goToNextRange();
    }
    @Override public boolean hasNext(){
      return next != null;
    }
    @Override public Integer next(){
      if (next == null) {
        throw new NoSuchElementException("You have reached the end of the iterator");
      }
      int result=next;
      if (next < rangeMax) {
        next++;
      }
 else {
        goToNextRange();
      }
      return result;
    }
    private void goToNextRange(){
      Integer newNext=null;
      Integer newRangeMax=null;
      while (rangesIterator.hasNext()) {
        Map.Entry<Integer,Integer> nextRange=rangesIterator.next();
        int tempNext=nextRange.getKey();
        int tempRangeMax=nextRange.getValue();
        if (rangeMax != null && rangeMax == Integer.MAX_VALUE) {
          break;
        }
        if (rangeMax != null && tempNext <= rangeMax) {
          tempNext=rangeMax + 1;
        }
        if (tempNext <= tempRangeMax) {
          newNext=tempNext;
          newRangeMax=tempRangeMax;
          break;
        }
      }
      next=newNext;
      rangeMax=newRangeMax;
    }
  }
}
