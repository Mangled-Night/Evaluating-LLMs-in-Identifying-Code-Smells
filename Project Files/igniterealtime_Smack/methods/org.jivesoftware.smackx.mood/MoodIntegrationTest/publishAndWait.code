/** 
 * Publish data using PEP, and block until the server has echoed the publication back to the publishing user.
 * @param moodManager The MoodManager instance for the connection that is expected to publish data.
 * @param discoManager The ServiceDiscoveryManager instance for the connection that is expected to publish data.
 * @param data The data to be published.
 * @throws Exception if the test fails
 */
public void publishAndWait(MoodManager moodManager,ServiceDiscoveryManager discoManager,Mood data) throws Exception {
  final SimpleResultSyncPoint publicationEchoReceived=new SimpleResultSyncPoint();
  final PepEventListener<MoodElement> publicationEchoListener=(jid,moodElement,id,message) -> {
    if (moodElement.getMood().equals(data)) {
      publicationEchoReceived.signal();
    }
  }
;
  try {
    registerListenerAndWait(moodManager,discoManager,publicationEchoListener);
    moodManager.addMoodListener(publicationEchoListener);
    moodManager.setMood(data);
  }
  finally {
    moodManager.removeMoodListener(publicationEchoListener);
  }
}
