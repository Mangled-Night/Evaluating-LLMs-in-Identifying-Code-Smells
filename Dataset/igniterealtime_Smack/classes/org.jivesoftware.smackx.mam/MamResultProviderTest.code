public class MamResultProviderTest {
  private static final String exampleMamResultXml="<result xmlns='urn:xmpp:mam:2' queryid='f27' id='28482-98726-73623'>" + "<forwarded xmlns='urn:xmpp:forward:0'>" + "<delay xmlns='urn:xmpp:delay' stamp='2010-07-10T23:08:25Z'/>"+ "<message xmlns='jabber:client' to='juliet@capulet.lit/balcony' from='romeo@montague.lit/orchard' "+ "type='chat'>"+ "<body>Call me but love, and I'll be new baptized; Henceforth I never will be Romeo.</body>"+ "</message>"+ "</forwarded>"+ "</result>";
  private static final String exampleResultMessage="<message id='aeb213' to='juliet@capulet.lit/chamber'>" + "<result xmlns='urn:xmpp:mam:2' queryid='f27' id='28482-98726-73623'>" + "<forwarded xmlns='urn:xmpp:forward:0'>"+ "<delay xmlns='urn:xmpp:delay' stamp='2010-07-10T23:08:25Z'/>"+ "<message xmlns='jabber:client' from='witch@shakespeare.lit' to='macbeth@shakespeare.lit'>"+ "<body>Hail to thee</body>"+ "</message>"+ "</forwarded>"+ "</result>"+ "</message>";
  @Test public void checkMamResultProvider() throws Exception {
    XmlPullParser parser=PacketParserUtils.getParserFor(exampleMamResultXml);
    MamResultExtension mamResultExtension=new MamResultProvider().parse(parser);
    assertEquals(mamResultExtension.getQueryId(),"f27");
    assertEquals(mamResultExtension.getId(),"28482-98726-73623");
    GregorianCalendar calendar=new GregorianCalendar(2010,7 - 1,10,23,8,25);
    calendar.setTimeZone(TimeZone.getTimeZone("UTC"));
    Date date=calendar.getTime();
    Forwarded<Message> forwarded=mamResultExtension.getForwarded();
    assertEquals(forwarded.getDelayInformation().getStamp(),date);
    Message message=forwarded.getForwardedStanza();
    assertEquals(message.getFrom().toString(),"romeo@montague.lit/orchard");
    assertEquals(message.getTo().toString(),"juliet@capulet.lit/balcony");
    assertEquals(message.getBody(),"Call me but love, and I'll be new baptized; Henceforth I never will be Romeo.");
  }
  @Test public void checkResultsParse() throws Exception {
    Message message=PacketParserUtils.parseStanza(exampleResultMessage);
    MamResultExtension mamResultExtension=MamResultExtension.from(message);
    assertEquals(mamResultExtension.getQueryId(),"f27");
    assertEquals(mamResultExtension.getId(),"28482-98726-73623");
    GregorianCalendar calendar=new GregorianCalendar(2010,7 - 1,10,23,8,25);
    calendar.setTimeZone(TimeZone.getTimeZone("UTC"));
    Date date=calendar.getTime();
    Forwarded<Message> forwarded=mamResultExtension.getForwarded();
    assertEquals(forwarded.getDelayInformation().getStamp(),date);
    Message forwardedMessage=forwarded.getForwardedStanza();
    assertEquals(forwardedMessage.getFrom().toString(),"witch@shakespeare.lit");
    assertEquals(forwardedMessage.getTo().toString(),"macbeth@shakespeare.lit");
    assertEquals(forwardedMessage.getBody(),"Hail to thee");
  }
}
