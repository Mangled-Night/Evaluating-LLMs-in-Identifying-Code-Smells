@ReceiveEvent(components={BlockItemComponent.class,ItemComponent.class}) public void onPlaceBlock(ActivateEvent event,EntityRef item){
  if (!event.getTarget().exists()) {
    event.consume();
    return;
  }
  BlockItemComponent blockItem=item.getComponent(BlockItemComponent.class);
  BlockFamily blockFamily=blockItem.blockFamily;
  Side surfaceSide=Side.inDirection(event.getHitNormal());
  BlockComponent blockComponent=event.getTarget().getComponent(BlockComponent.class);
  if (blockComponent == null) {
    event.consume();
    return;
  }
  Vector3i targetBlock=new Vector3i(blockComponent.getPosition());
  Vector3i placementPos=new Vector3i(targetBlock);
  placementPos.add(surfaceSide.direction());
  Vector2f relativeAttachmentPosition=getRelativeAttachmentPosition(event);
  Block block=blockFamily.getBlockForPlacement(new BlockPlacementData(placementPos,surfaceSide,event.getDirection(),relativeAttachmentPosition));
  if (canPlaceBlock(block,targetBlock,placementPos)) {
    if (networkSystem.getMode().isAuthority()) {
      PlaceBlocks placeBlocks=new PlaceBlocks(placementPos,block,event.getInstigator());
      worldProvider.getWorldEntity().send(placeBlocks);
      if (!placeBlocks.isConsumed()) {
        item.send(new OnBlockItemPlaced(placementPos,blockEntityRegistry.getBlockEntityAt(placementPos),event.getInstigator()));
      }
 else {
        event.consume();
      }
    }
    recordBlockPlaced(event,blockFamily);
    event.getInstigator().send(new PlaySoundEvent(Assets.getSound("engine:PlaceBlock").get(),0.5f));
  }
 else {
    event.consume();
  }
}
