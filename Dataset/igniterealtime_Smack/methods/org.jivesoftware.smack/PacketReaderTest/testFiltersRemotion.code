/** 
 * Tests that PacketReader adds new listeners and also removes them correctly.
 */
public void testFiltersRemotion(){
  resetCounter();
  int repeat=10;
  for (int j=0; j < repeat; j++) {
    PacketListener listener0=new PacketListener(){
      public void processStanza(      Packet packet){
        System.out.println("Packet Captured");
        incCounter();
      }
    }
;
    PacketFilter pf0=new PacketFilter(){
      public boolean accept(      Packet packet){
        System.out.println("Packet Filtered");
        incCounter();
        return true;
      }
    }
;
    PacketListener listener1=new PacketListener(){
      public void processStanza(      Packet packet){
        System.out.println("Packet Captured");
        incCounter();
      }
    }
;
    PacketFilter pf1=new PacketFilter(){
      public boolean accept(      Packet packet){
        System.out.println("Packet Filtered");
        incCounter();
        return true;
      }
    }
;
    getConnection(0).addAsyncPacketListener(listener0,pf0);
    getConnection(1).addAsyncPacketListener(listener1,pf1);
    Message msg0=new Message(getConnection(0).getUser(),Message.Type.normal);
    Message msg1=new Message(getConnection(1).getUser(),Message.Type.normal);
    for (int i=0; i < 5; i++) {
      getConnection(1).sendStanza(msg0);
      getConnection(0).sendStanza(msg1);
    }
    try {
      Thread.sleep(100);
    }
 catch (    InterruptedException e) {
      e.printStackTrace();
    }
    getConnection(0).removeAsyncPacketListener(listener0);
    getConnection(1).removeAsyncPacketListener(listener1);
    try {
      Thread.sleep(300);
    }
 catch (    InterruptedException e) {
      e.printStackTrace();
    }
    for (int i=0; i < 10; i++) {
      getConnection(0).sendStanza(msg1);
      getConnection(1).sendStanza(msg0);
    }
    try {
      Thread.sleep(100);
    }
 catch (    InterruptedException e) {
      e.printStackTrace();
    }
  }
  System.out.println(valCounter());
  assertEquals(valCounter(),repeat * 2 * 10);
}
