/** 
 * Unit tests for  {@link ExceptionFactory}.
 * @author Mark Paluch
 * @author Tobias Nehrlich
 */
class ExceptionFactoryUnitTests {
  @Test void shouldCreateBusyException(){
    assertThat(ExceptionFactory.createExecutionException("BUSY foo bar")).isInstanceOf(RedisBusyException.class).hasMessage("BUSY foo bar").hasNoCause();
    assertThat(ExceptionFactory.createExecutionException("BUSY foo bar",new IllegalStateException())).isInstanceOf(RedisBusyException.class).hasMessage("BUSY foo bar").hasRootCauseInstanceOf(IllegalStateException.class);
  }
  @Test void shouldCreateNoscriptException(){
    assertThat(ExceptionFactory.createExecutionException("NOSCRIPT foo bar")).isInstanceOf(RedisNoScriptException.class).hasMessage("NOSCRIPT foo bar").hasNoCause();
    assertThat(ExceptionFactory.createExecutionException("NOSCRIPT foo bar",new IllegalStateException())).isInstanceOf(RedisNoScriptException.class).hasMessage("NOSCRIPT foo bar").hasRootCauseInstanceOf(IllegalStateException.class);
  }
  @Test void shouldCreateExecutionException(){
    assertThat(ExceptionFactory.createExecutionException("ERR foo bar")).isInstanceOf(RedisCommandExecutionException.class).hasMessage("ERR foo bar").hasNoCause();
    assertThat(ExceptionFactory.createExecutionException("ERR foo bar",new IllegalStateException())).isInstanceOf(RedisCommandExecutionException.class).hasMessage("ERR foo bar").hasRootCauseInstanceOf(IllegalStateException.class);
    assertThat(ExceptionFactory.createExecutionException(null,new IllegalStateException())).isInstanceOf(RedisCommandExecutionException.class).hasRootCauseInstanceOf(IllegalStateException.class);
  }
  @Test void shouldCreateLoadingException(){
    assertThat(ExceptionFactory.createExecutionException("LOADING foo bar")).isInstanceOf(RedisLoadingException.class).hasMessage("LOADING foo bar").hasNoCause();
    assertThat(ExceptionFactory.createExecutionException("LOADING foo bar",new IllegalStateException())).isInstanceOf(RedisLoadingException.class).hasMessage("LOADING foo bar").hasRootCauseInstanceOf(IllegalStateException.class);
  }
  @Test void shouldCreateReadOnlyException(){
    assertThat(ExceptionFactory.createExecutionException("READONLY foo bar")).isInstanceOf(RedisReadOnlyException.class).hasMessage("READONLY foo bar").hasNoCause();
    assertThat(ExceptionFactory.createExecutionException("READONLY foo bar",new IllegalStateException())).isInstanceOf(RedisReadOnlyException.class).hasMessage("READONLY foo bar").hasRootCauseInstanceOf(IllegalStateException.class);
  }
  @Test void shouldFormatExactUnits(){
    assertThat(ExceptionFactory.formatTimeout(Duration.ofMinutes(2))).isEqualTo("2 minute(s)");
    assertThat(ExceptionFactory.formatTimeout(Duration.ofMinutes(1))).isEqualTo("1 minute(s)");
    assertThat(ExceptionFactory.formatTimeout(Duration.ofMinutes(0))).isEqualTo("no timeout");
    assertThat(ExceptionFactory.formatTimeout(Duration.ofSeconds(2))).isEqualTo("2 second(s)");
    assertThat(ExceptionFactory.formatTimeout(Duration.ofSeconds(1))).isEqualTo("1 second(s)");
    assertThat(ExceptionFactory.formatTimeout(Duration.ofSeconds(0))).isEqualTo("no timeout");
    assertThat(ExceptionFactory.formatTimeout(Duration.ofMillis(2))).isEqualTo("2 millisecond(s)");
    assertThat(ExceptionFactory.formatTimeout(Duration.ofMillis(1))).isEqualTo("1 millisecond(s)");
    assertThat(ExceptionFactory.formatTimeout(Duration.ofMillis(0))).isEqualTo("no timeout");
  }
  @Test void shouldFormatToMinmalApplicableTimeunit(){
    assertThat(ExceptionFactory.formatTimeout(Duration.ofMinutes(2).plus(Duration.ofSeconds(10)))).isEqualTo("130 second(s)");
    assertThat(ExceptionFactory.formatTimeout(Duration.ofSeconds(2).plus(Duration.ofMillis(5)))).isEqualTo("2005 millisecond(s)");
    assertThat(ExceptionFactory.formatTimeout(Duration.ofNanos(2))).isEqualTo("2 ns");
  }
}
