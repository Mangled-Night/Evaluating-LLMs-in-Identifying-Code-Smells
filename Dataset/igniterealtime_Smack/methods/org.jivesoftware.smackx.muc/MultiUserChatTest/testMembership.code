public void testMembership(){
  final String[] answer=new String[4];
  try {
    makeRoomModerated();
    MultiUserChat muc2=new MultiUserChat(getConnection(1),room);
    muc2.join("testbot2");
    muc2.addUserStatusListener(new DefaultUserStatusListener(){
      public void membershipGranted(){
        super.membershipGranted();
        answer[0]="I'm a member";
      }
      public void membershipRevoked(){
        super.membershipRevoked();
        answer[1]="I'm not a member";
      }
    }
);
    MultiUserChat muc3=new MultiUserChat(getConnection(2),room);
    muc3.join("testbot3");
    muc3.addParticipantStatusListener(new DefaultParticipantStatusListener(){
      public void membershipGranted(      String participant){
        super.membershipGranted(participant);
        answer[2]=participant;
      }
      public void membershipRevoked(      String participant){
        super.membershipRevoked(participant);
        answer[3]=participant;
      }
    }
);
    try {
      muc2.grantMembership(getBareJID(2));
      fail("User2 was able to grant membership privileges");
    }
 catch (    XMPPException e) {
      XMPPError xmppError=e.getStanzaError();
      assertNotNull("No XMPPError was received granting membership privileges",xmppError);
      assertEquals("A visitor was able to grant membership privileges to another visitor",403,xmppError.getCode());
    }
    muc.grantMembership(getBareJID(1));
    Thread.sleep(300);
    assertEquals("User2 didn't receive the grant membership notification","I'm a member",answer[0]);
    assertEquals("User3 didn't receive user2's grant membership notification",room + "/testbot2",answer[2]);
    muc.revokeMembership(getBareJID(1));
    Thread.sleep(300);
    assertEquals("User2 didn't receive the revoke membership notification","I'm not a member",answer[1]);
    assertEquals("User3 didn't receive user2's revoke membership notification",room + "/testbot2",answer[3]);
    muc2.leave();
    muc3.leave();
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail(e.getMessage());
  }
}
