static State.Result handleMap(RedisStateMachine rsm,State state,ByteBuf buffer,CommandOutput<?,?,?> output,Consumer<Exception> errorHandler){
  int length;
  int end;
  if (state.count == NOT_FOUND) {
    if ((end=rsm.findLineEnd(buffer)) == NOT_FOUND) {
      return State.Result.BREAK_LOOP;
    }
    length=readAndMarkReadIdx(rsm,state,buffer,end);
    rsm.safeMultiMap(output,state.count,errorHandler);
    state.count=length * 2;
  }
  return returnDependStateCount(rsm,state);
}
