public class FiltersTest extends MamTest {
  private static String getMamXMemberWith(  List<String> fieldsNames,  List<? extends CharSequence> fieldsValues){
    String xml="<x xmlns='jabber:x:data' type='submit'>" + "<field var='FORM_TYPE'>" + "<value>" + MamVersion.MAM2.getNamespace() + "</value>"+ "</field>";
    for (int i=0; i < fieldsNames.size() && i < fieldsValues.size(); i++) {
      xml+="<field var='" + fieldsNames.get(i) + "'>"+ "<value>"+ fieldsValues.get(i)+ "</value>"+ "</field>";
    }
    xml+="</x>";
    return xml;
  }
  @Test public void checkStartDateFilter() throws Exception {
    Date date=new Date();
    MamQueryArgs mamQueryArgs=MamQueryArgs.builder().limitResultsSince(date).build();
    DataForm dataForm=mamQueryArgs.getDataForm(MamVersion.MAM2);
    List<String> fields=new ArrayList<>();
    fields.add("start");
    List<String> values=new ArrayList<>();
    values.add(XmppDateTime.formatXEP0082Date(date));
    assertEquals(getMamXMemberWith(fields,values),dataForm.toXML().toString());
  }
  @Test public void checkEndDateFilter() throws Exception {
    Date date=new Date();
    MamQueryArgs mamQueryArgs=MamQueryArgs.builder().limitResultsBefore(date).build();
    DataForm dataForm=mamQueryArgs.getDataForm(MamVersion.MAM2);
    List<String> fields=new ArrayList<>();
    fields.add("end");
    List<String> values=new ArrayList<>();
    values.add(XmppDateTime.formatXEP0082Date(date));
    assertEquals(getMamXMemberWith(fields,values),dataForm.toXML().toString());
  }
  @Test public void checkWithJidFilter() throws Exception {
    Jid jid=JidTestUtil.BARE_JID_1;
    MamQueryArgs mamQueryArgs=MamQueryArgs.builder().limitResultsToJid(jid).build();
    DataForm dataForm=mamQueryArgs.getDataForm(MamVersion.MAM2);
    List<String> fields=new ArrayList<>();
    fields.add("with");
    List<CharSequence> values=new ArrayList<>();
    values.add(jid);
    assertEquals(getMamXMemberWith(fields,values),dataForm.toXML().toString());
  }
}
