@Test public void getConfigFormWithInsufficientPrivileges() throws XMPPException, SmackException, IOException, InterruptedException {
  ThreadedDummyConnection con=ThreadedDummyConnection.newInstance();
  PubSubManager mgr=new PubSubManager(con,PubSubManagerTest.DUMMY_PUBSUB_SERVICE);
  DiscoverInfoBuilder info=DiscoverInfo.builder("disco-result").ofType(IQ.Type.result).from(PubSubManagerTest.DUMMY_PUBSUB_SERVICE);
  Identity ident=new Identity("pubsub",null,"leaf");
  info.addIdentity(ident);
  DiscoverInfo discoverInfo=info.build();
  con.addIQReply(discoverInfo);
  Node node=mgr.getNode("princely_musings");
  PubSub errorIq=new PubSub();
  errorIq.setType(IQ.Type.error);
  errorIq.setFrom(PubSubManagerTest.DUMMY_PUBSUB_SERVICE);
  StanzaError error=StanzaError.getBuilder(Condition.forbidden).build();
  errorIq.setError(error);
  con.addIQReply(errorIq);
  try {
    node.getNodeConfiguration();
    fail();
  }
 catch (  XMPPErrorException e) {
    assertEquals(StanzaError.Type.AUTH,e.getStanzaError().getType());
  }
}
