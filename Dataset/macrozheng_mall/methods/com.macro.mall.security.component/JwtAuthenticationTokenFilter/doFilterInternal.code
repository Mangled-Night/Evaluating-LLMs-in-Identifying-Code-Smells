@Override protected void doFilterInternal(HttpServletRequest request,HttpServletResponse response,FilterChain chain) throws ServletException, IOException {
  String authHeader=request.getHeader(this.tokenHeader);
  if (authHeader != null && authHeader.startsWith(this.tokenHead)) {
    String authToken=authHeader.substring(this.tokenHead.length());
    String username=jwtTokenUtil.getUserNameFromToken(authToken);
    LOGGER.info("checking username:{}",username);
    if (username != null && SecurityContextHolder.getContext().getAuthentication() == null) {
      UserDetails userDetails=this.userDetailsService.loadUserByUsername(username);
      if (jwtTokenUtil.validateToken(authToken,userDetails)) {
        UsernamePasswordAuthenticationToken authentication=new UsernamePasswordAuthenticationToken(userDetails,null,userDetails.getAuthorities());
        authentication.setDetails(new WebAuthenticationDetailsSource().buildDetails(request));
        LOGGER.info("authenticated user:{}",username);
        SecurityContextHolder.getContext().setAuthentication(authentication);
      }
    }
  }
  chain.doFilter(request,response);
}
