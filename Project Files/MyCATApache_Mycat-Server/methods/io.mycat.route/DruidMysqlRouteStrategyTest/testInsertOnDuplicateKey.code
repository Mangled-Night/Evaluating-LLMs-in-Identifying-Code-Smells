/** 
 * insert ... on duplicate key ... update...
 * @throws Exception
 */
public void testInsertOnDuplicateKey() throws Exception {
  SchemaConfig schema=schemaMap.get("TESTDB");
  String sql="insert into employee (id,name,sharding_id) values(1,'testonly',10000) on duplicate key update name='nihao'";
  RouteResultset rrs=null;
  rrs=routeStrategy.route(new SystemConfig(),schema,ServerParse.SELECT,sql,null,null,cachePool);
  Assert.assertEquals(1,rrs.getNodes().length);
  Assert.assertEquals("dn1",rrs.getNodes()[0].getName());
  sql="insert into employee (id,name,sharding_id) values(1,'testonly',10000) " + "on duplicate key update name=VALUES(name),id = VALUES(id)";
  rrs=routeStrategy.route(new SystemConfig(),schema,ServerParse.SELECT,sql,null,null,cachePool);
  Assert.assertEquals(1,rrs.getNodes().length);
  Assert.assertEquals("dn1",rrs.getNodes()[0].getName());
  sql="insert into employee (id,name,sharding_id) values(1,'testonly',10000) " + "on duplicate key update name=VALUES(name),id = VALUES(id),sharding_id = VALUES(sharding_id)";
  try {
    rrs=routeStrategy.route(new SystemConfig(),schema,ServerParse.SELECT,sql,null,null,cachePool);
  }
 catch (  Exception e) {
    Assert.assertEquals("Sharding column can't be updated: EMPLOYEE -> SHARDING_ID",e.getMessage());
  }
}
