@Test void retryListenerCompletesSuccessfullyAfterDeferredRequeue(){
  DefaultEndpoint.RetryListener listener=DefaultEndpoint.RetryListener.newInstance(sut,command);
  ChannelFuture future=mock(ChannelFuture.class);
  EventLoop eventLoopGroup=mock(EventLoop.class);
  when(future.isSuccess()).thenReturn(false);
  when(future.cause()).thenReturn(new ClosedChannelException());
  when(channel.eventLoop()).thenReturn(eventLoopGroup);
  when(channel.close()).thenReturn(mock(ChannelFuture.class));
  sut.notifyChannelActive(channel);
  sut.closeAsync();
  listener.operationComplete(future);
  ArgumentCaptor<Runnable> runnableCaptor=ArgumentCaptor.forClass(Runnable.class);
  verify(eventLoopGroup).submit(runnableCaptor.capture());
  runnableCaptor.getValue().run();
  assertThat(command.exception).isInstanceOf(RedisException.class);
}
