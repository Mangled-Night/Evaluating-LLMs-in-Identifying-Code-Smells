/** 
 * 商品属性管理Service实现类 Created by macro on 2018/4/26.
 */
@Service public class PmsProductAttributeServiceImpl implements PmsProductAttributeService {
  @Autowired private PmsProductAttributeMapper productAttributeMapper;
  @Autowired private PmsProductAttributeCategoryMapper productAttributeCategoryMapper;
  @Autowired private PmsProductAttributeDao productAttributeDao;
  @Override public List<PmsProductAttribute> getList(  Long cid,  Integer type,  Integer pageSize,  Integer pageNum){
    PageHelper.startPage(pageNum,pageSize);
    PmsProductAttributeExample example=new PmsProductAttributeExample();
    example.setOrderByClause("sort desc");
    example.createCriteria().andProductAttributeCategoryIdEqualTo(cid).andTypeEqualTo(type);
    return productAttributeMapper.selectByExample(example);
  }
  @Override public int create(  PmsProductAttributeParam pmsProductAttributeParam){
    PmsProductAttribute pmsProductAttribute=new PmsProductAttribute();
    BeanUtils.copyProperties(pmsProductAttributeParam,pmsProductAttribute);
    int count=productAttributeMapper.insertSelective(pmsProductAttribute);
    PmsProductAttributeCategory pmsProductAttributeCategory=productAttributeCategoryMapper.selectByPrimaryKey(pmsProductAttribute.getProductAttributeCategoryId());
    if (pmsProductAttribute.getType() == 0) {
      pmsProductAttributeCategory.setAttributeCount(pmsProductAttributeCategory.getAttributeCount() + 1);
    }
 else     if (pmsProductAttribute.getType() == 1) {
      pmsProductAttributeCategory.setParamCount(pmsProductAttributeCategory.getParamCount() + 1);
    }
    productAttributeCategoryMapper.updateByPrimaryKey(pmsProductAttributeCategory);
    return count;
  }
  @Override public int update(  Long id,  PmsProductAttributeParam productAttributeParam){
    PmsProductAttribute pmsProductAttribute=new PmsProductAttribute();
    pmsProductAttribute.setId(id);
    BeanUtils.copyProperties(productAttributeParam,pmsProductAttribute);
    return productAttributeMapper.updateByPrimaryKeySelective(pmsProductAttribute);
  }
  @Override public PmsProductAttribute getItem(  Long id){
    return productAttributeMapper.selectByPrimaryKey(id);
  }
  @Override public int delete(  List<Long> ids){
    PmsProductAttribute pmsProductAttribute=productAttributeMapper.selectByPrimaryKey(ids.get(0));
    Integer type=pmsProductAttribute.getType();
    PmsProductAttributeCategory pmsProductAttributeCategory=productAttributeCategoryMapper.selectByPrimaryKey(pmsProductAttribute.getProductAttributeCategoryId());
    PmsProductAttributeExample example=new PmsProductAttributeExample();
    example.createCriteria().andIdIn(ids);
    int count=productAttributeMapper.deleteByExample(example);
    if (type == 0) {
      if (pmsProductAttributeCategory.getAttributeCount() >= count) {
        pmsProductAttributeCategory.setAttributeCount(pmsProductAttributeCategory.getAttributeCount() - count);
      }
 else {
        pmsProductAttributeCategory.setAttributeCount(0);
      }
    }
 else     if (type == 1) {
      if (pmsProductAttributeCategory.getParamCount() >= count) {
        pmsProductAttributeCategory.setParamCount(pmsProductAttributeCategory.getParamCount() - count);
      }
 else {
        pmsProductAttributeCategory.setParamCount(0);
      }
    }
    productAttributeCategoryMapper.updateByPrimaryKey(pmsProductAttributeCategory);
    return count;
  }
  @Override public List<ProductAttrInfo> getProductAttrInfo(  Long productCategoryId){
    return productAttributeDao.getProductAttrInfo(productCategoryId);
  }
}
