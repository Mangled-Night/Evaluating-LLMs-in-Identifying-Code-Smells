/** 
 * 从包package中获取所有的Class
 * @param packname 包名称
 * @return 包路径下所有类集合<p> 代码摘抄自 http://www.oschina.net/code/snippet_129830_8767</p>
 */
public static Set<Class<?>> getClasses(final ClassLoader loader,final String packname){
  Set<Class<?>> classes=new LinkedHashSet<Class<?>>();
  String packageName=packname;
  String packageDirName=packageName.replace('.','/');
  Enumeration<URL> dirs;
  try {
    dirs=loader.getResources(packageDirName);
    while (dirs.hasMoreElements()) {
      URL url=dirs.nextElement();
      String protocol=url.getProtocol();
      if ("file".equals(protocol)) {
        String filePath=URLDecoder.decode(url.getFile(),"UTF-8");
        findAndAddClassesInPackageByFile(packageName,filePath,true,classes);
      }
 else       if ("jar".equals(protocol)) {
        JarFile jar;
        try {
          jar=((JarURLConnection)url.openConnection()).getJarFile();
          Enumeration<JarEntry> entries=jar.entries();
          while (entries.hasMoreElements()) {
            JarEntry entry=entries.nextElement();
            String name=entry.getName();
            if (name.charAt(0) == '/') {
              name=name.substring(1);
            }
            if (name.startsWith(packageDirName)) {
              int idx=name.lastIndexOf('/');
              if (idx != -1) {
                packageName=name.substring(0,idx).replace('/','.');
              }
              if (name.endsWith(".class") && !entry.isDirectory()) {
                String className=name.substring(packageName.length() + 1,name.length() - 6);
                try {
                  classes.add(Class.forName(packageName + '.' + className));
                }
 catch (                ClassNotFoundException e) {
                }
              }
            }
          }
        }
 catch (        IOException e) {
        }
      }
    }
  }
 catch (  IOException e) {
  }
  return classes;
}
