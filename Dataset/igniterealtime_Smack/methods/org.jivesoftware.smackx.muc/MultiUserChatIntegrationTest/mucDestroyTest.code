/** 
 * Asserts that a user is notified when a room is destroyed <p>From XEP-0045 ยง 10.9:</p> <blockquote> A room owner MUST be able to destroy a room, especially if the room is persistent... The room removes all users from the room... and destroys the room </blockquote>
 * @throws TimeoutException when roomDestroyed event doesn't get fired
 * @throws Exception when other errors occur
 */
@SmackIntegrationTest public void mucDestroyTest() throws TimeoutException, Exception {
  EntityBareJid mucAddress=getRandomRoom("smack-inttest-destroy");
  MultiUserChat muc=mucManagerOne.getMultiUserChat(mucAddress);
  muc.join(Resourcepart.from("nick-one"));
  final SimpleResultSyncPoint mucDestroyed=new SimpleResultSyncPoint();
  @SuppressWarnings("deprecation") DefaultUserStatusListener userStatusListener=new DefaultUserStatusListener(){
    @Override public void roomDestroyed(    MultiUserChat alternateMUC,    String reason){
      mucDestroyed.signal();
    }
  }
;
  muc.addUserStatusListener(userStatusListener);
  assertEquals(1,mucManagerOne.getJoinedRooms().size());
  assertEquals(1,muc.getOccupantsCount());
  assertNotNull(muc.getNickname());
  try {
    muc.destroy("Dummy reason",null);
    mucDestroyed.waitForResult(timeout);
  }
  finally {
    muc.removeUserStatusListener(userStatusListener);
  }
  assertEquals(0,mucManagerOne.getJoinedRooms().size());
  assertEquals(0,muc.getOccupantsCount());
  assertNull(muc.getNickname());
}
