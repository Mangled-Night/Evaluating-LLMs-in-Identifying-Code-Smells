private static long count(int[] a,int[] b,int[] aux,int lo,int hi){
  long inversions=0;
  if (hi <= lo)   return 0;
  int mid=lo + (hi - lo) / 2;
  inversions+=count(a,b,aux,lo,mid);
  inversions+=count(a,b,aux,mid + 1,hi);
  inversions+=merge(b,aux,lo,mid,hi);
  assert inversions == brute(a,lo,hi);
  return inversions;
}
/** 
 * Returns the number of inversions in the integer array. The argument array is not modified.
 * @param a the array
 * @return the number of inversions in the array. An inversion is a pair ofindicies  {@code i} and {@code j} such that {@code i < j}and  {@code a[i] > a[j]}.
 */
public static long count(int[] a){
  int[] b=new int[a.length];
  int[] aux=new int[a.length];
  for (int i=0; i < a.length; i++)   b[i]=a[i];
  long inversions=count(a,b,aux,0,a.length - 1);
  return inversions;
}
private static <Key extends Comparable<Key>>long count(Key[] a,Key[] b,Key[] aux,int lo,int hi){
  long inversions=0;
  if (hi <= lo)   return 0;
  int mid=lo + (hi - lo) / 2;
  inversions+=count(a,b,aux,lo,mid);
  inversions+=count(a,b,aux,mid + 1,hi);
  inversions+=merge(b,aux,lo,mid,hi);
  assert inversions == brute(a,lo,hi);
  return inversions;
}
/** 
 * Returns the number of inversions in the comparable array. The argument array is not modified.
 * @param a the array
 * @param < Key > the inferred type of the elements in the array
 * @return the number of inversions in the array. An inversion is a pair ofindicies  {@code i} and {@code j} such that {@code i < j}and  {@code a[i].compareTo(a[j]) > 0}.
 */
public static <Key extends Comparable<Key>>long count(Key[] a){
  Key[] b=a.clone();
  Key[] aux=a.clone();
  long inversions=count(a,b,aux,0,a.length - 1);
  return inversions;
}
