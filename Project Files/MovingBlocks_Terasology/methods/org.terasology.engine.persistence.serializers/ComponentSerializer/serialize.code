/** 
 * Serializes a component.
 * @param component
 * @return The serialized component, or null if it could not be serialized.
 */
public EntityData.Component serialize(Component component){
  return serialize(component,FieldSerializeCheck.NullCheck.<Component>newInstance());
}
/** 
 * Serializes a component.
 * @param component
 * @param check     A check to use to see if each field should be serialized.
 * @return The serialized component, or null if it could not be serialized.
 */
public EntityData.Component serialize(Component component,FieldSerializeCheck<Component> check){
  ComponentMetadata<?> componentMetadata=componentLibrary.getMetadata(component.getClass());
  if (componentMetadata == null) {
    logger.error("Unregistered component type: {}",component.getClass());
    return null;
  }
  EntityData.Component.Builder componentMessage=EntityData.Component.newBuilder();
  serializeComponentType(componentMetadata,componentMessage);
  Serializer serializer=typeHandlerLibrary.getSerializerFor(componentMetadata);
  for (  ReplicatedFieldMetadata<?,?> field : componentMetadata.getFields()) {
    if (check.shouldSerializeField(field,component)) {
      PersistedData result=serializer.serialize(field,component,serializationContext);
      if (!result.isNull()) {
        EntityData.Value itemValue=((ProtobufPersistedData)result).getValue();
        if (usingFieldIds) {
          componentMessage.addField(EntityData.NameValue.newBuilder().setNameIndex(field.getId()).setValue(itemValue));
        }
 else {
          componentMessage.addField(EntityData.NameValue.newBuilder().setName(field.getName()).setValue(itemValue));
        }
      }
    }
  }
  return componentMessage.build();
}
/** 
 * Serializes the differences between two components.
 * @param base  The base component to compare against.
 * @param delta The component whose differences will be serialized
 * @return The serialized component, or null if it could not be serialized
 */
public EntityData.Component serialize(Component base,Component delta){
  return serialize(base,delta,FieldSerializeCheck.NullCheck.<Component>newInstance());
}
/** 
 * Serializes the differences between two components.
 * @param base  The base component to compare against.
 * @param delta The component whose differences will be serialized
 * @param check A check to use to see if each field should be serialized.
 * @return The serialized component, or null if it could not be serialized
 */
public EntityData.Component serialize(Component base,Component delta,FieldSerializeCheck<Component> check){
  ComponentMetadata<?> componentMetadata=componentLibrary.getMetadata(base.getClass());
  if (componentMetadata == null) {
    logger.error("Unregistered component type: {}",base.getClass());
    return null;
  }
  EntityData.Component.Builder componentMessage=EntityData.Component.newBuilder();
  serializeComponentType(componentMetadata,componentMessage);
  Serializer serializer=typeHandlerLibrary.getSerializerFor(componentMetadata);
  boolean changed=false;
  for (  ReplicatedFieldMetadata field : componentMetadata.getFields()) {
    if (check.shouldSerializeField(field,delta) && serializer.getHandlerFor(field) != null) {
      Object origValue=field.getValue(base);
      Object deltaValue=field.getValue(delta);
      if (!Objects.equal(origValue,deltaValue)) {
        PersistedData value=serializer.serializeValue(field,deltaValue,serializationContext);
        if (!value.isNull()) {
          EntityData.Value dataValue=((ProtobufPersistedData)value).getValue();
          if (usingFieldIds) {
            componentMessage.addField(EntityData.NameValue.newBuilder().setNameIndex(field.getId()).setValue(dataValue).build());
          }
 else {
            componentMessage.addField(EntityData.NameValue.newBuilder().setName(field.getName()).setValue(dataValue).build());
          }
          changed=true;
        }
      }
    }
  }
  if (changed) {
    return componentMessage.build();
  }
  return null;
}
