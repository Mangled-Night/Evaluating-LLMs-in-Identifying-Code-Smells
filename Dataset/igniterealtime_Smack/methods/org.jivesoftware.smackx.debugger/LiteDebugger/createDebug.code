/** 
 * Creates the debug process, which is a GUI window that displays XML traffic.
 */
private void createDebug(){
  frame=new JFrame("Smack Debug Window -- " + connection.getXMPPServiceDomain() + ":"+ connection.getPort());
  frame.addWindowListener(new WindowAdapter(){
    @Override public void windowClosing(    WindowEvent evt){
      rootWindowClosing(evt);
    }
  }
);
  JTabbedPane tabbedPane=new JTabbedPane();
  JPanel allPane=new JPanel();
  allPane.setLayout(new GridLayout(3,1));
  tabbedPane.add("All",allPane);
  final JTextArea sentText1=new JTextArea();
  final JTextArea sentText2=new JTextArea();
  sentText1.setEditable(false);
  sentText2.setEditable(false);
  sentText1.setForeground(new Color(112,3,3));
  sentText2.setForeground(new Color(112,3,3));
  allPane.add(new JScrollPane(sentText1));
  tabbedPane.add("Sent",new JScrollPane(sentText2));
  JPopupMenu menu=new JPopupMenu();
  JMenuItem menuItem1=new JMenuItem("Copy");
  menuItem1.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    ActionEvent e){
      Clipboard clipboard=Toolkit.getDefaultToolkit().getSystemClipboard();
      clipboard.setContents(new StringSelection(sentText1.getText()),null);
    }
  }
);
  JMenuItem menuItem2=new JMenuItem("Clear");
  menuItem2.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    ActionEvent e){
      sentText1.setText("");
      sentText2.setText("");
    }
  }
);
  MouseListener popupListener=new PopupListener(menu);
  sentText1.addMouseListener(popupListener);
  sentText2.addMouseListener(popupListener);
  menu.add(menuItem1);
  menu.add(menuItem2);
  final JTextArea receivedText1=new JTextArea();
  final JTextArea receivedText2=new JTextArea();
  receivedText1.setEditable(false);
  receivedText2.setEditable(false);
  receivedText1.setForeground(new Color(6,76,133));
  receivedText2.setForeground(new Color(6,76,133));
  allPane.add(new JScrollPane(receivedText1));
  tabbedPane.add("Received",new JScrollPane(receivedText2));
  menu=new JPopupMenu();
  menuItem1=new JMenuItem("Copy");
  menuItem1.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    ActionEvent e){
      Clipboard clipboard=Toolkit.getDefaultToolkit().getSystemClipboard();
      clipboard.setContents(new StringSelection(receivedText1.getText()),null);
    }
  }
);
  menuItem2=new JMenuItem("Clear");
  menuItem2.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    ActionEvent e){
      receivedText1.setText("");
      receivedText2.setText("");
    }
  }
);
  popupListener=new PopupListener(menu);
  receivedText1.addMouseListener(popupListener);
  receivedText2.addMouseListener(popupListener);
  menu.add(menuItem1);
  menu.add(menuItem2);
  interpretedText1.setEditable(false);
  interpretedText2.setEditable(false);
  interpretedText1.setForeground(new Color(1,94,35));
  interpretedText2.setForeground(new Color(1,94,35));
  allPane.add(new JScrollPane(interpretedText1));
  tabbedPane.add("Interpreted",new JScrollPane(interpretedText2));
  menu=new JPopupMenu();
  menuItem1=new JMenuItem("Copy");
  menuItem1.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    ActionEvent e){
      Clipboard clipboard=Toolkit.getDefaultToolkit().getSystemClipboard();
      clipboard.setContents(new StringSelection(interpretedText1.getText()),null);
    }
  }
);
  menuItem2=new JMenuItem("Clear");
  menuItem2.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    ActionEvent e){
      interpretedText1.setText("");
      interpretedText2.setText("");
    }
  }
);
  popupListener=new PopupListener(menu);
  interpretedText1.addMouseListener(popupListener);
  interpretedText2.addMouseListener(popupListener);
  menu.add(menuItem1);
  menu.add(menuItem2);
  frame.getContentPane().add(tabbedPane);
  frame.setSize(550,400);
  frame.setVisible(true);
  ObservableReader debugReader=new ObservableReader(reader);
  readerListener=new ReaderListener(){
    @Override public void read(    String str){
      int index=str.lastIndexOf(">");
      if (index != -1) {
        receivedText1.append(str.substring(0,index + 1));
        receivedText2.append(str.substring(0,index + 1));
        receivedText1.append(NEWLINE);
        receivedText2.append(NEWLINE);
        if (str.length() > index) {
          receivedText1.append(str.substring(index + 1));
          receivedText2.append(str.substring(index + 1));
        }
      }
 else {
        receivedText1.append(str);
        receivedText2.append(str);
      }
    }
  }
;
  debugReader.addReaderListener(readerListener);
  ObservableWriter debugWriter=new ObservableWriter(writer);
  writerListener=new WriterListener(){
    @Override public void write(    String str){
      sentText1.append(str);
      sentText2.append(str);
      if (str.endsWith(">")) {
        sentText1.append(NEWLINE);
        sentText2.append(NEWLINE);
      }
    }
  }
;
  debugWriter.addWriterListener(writerListener);
  reader=debugReader;
  writer=debugWriter;
}
