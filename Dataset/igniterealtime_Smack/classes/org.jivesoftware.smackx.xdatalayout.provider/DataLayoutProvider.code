/** 
 * Extension Provider for Page layout of forms.
 * @author Anno van Vliet
 */
public class DataLayoutProvider {
  public static DataLayout parse(  XmlPullParser parser) throws XmlPullParserException, IOException {
    DataLayout dataLayout=new DataLayout(parser.getAttributeValue("","label"));
    parseLayout(dataLayout.getPageLayout(),parser);
    return dataLayout;
  }
  private static Section parseSection(  XmlPullParser parser) throws XmlPullParserException, IOException {
    Section layout=new Section(parser.getAttributeValue("","label"));
    parseLayout(layout.getSectionLayout(),parser);
    return layout;
  }
  private static void parseLayout(  List<DataFormLayoutElement> layout,  XmlPullParser parser) throws XmlPullParserException, IOException {
    final int initialDepth=parser.getDepth();
    outerloop:     while (true) {
      XmlPullParser.Event eventType=parser.next();
switch (eventType) {
case START_ELEMENT:
switch (parser.getName()) {
case Text.ELEMENT:
          layout.add(new Text(parser.nextText()));
        break;
case Section.ELEMENT:
      layout.add(parseSection(parser));
    break;
case Fieldref.ELEMENT:
  layout.add(parseFieldref(parser));
break;
case Reportedref.ELEMENT:
layout.add(new Reportedref());
break;
default :
break;
}
break;
case END_ELEMENT:
if (parser.getDepth() == initialDepth) {
break outerloop;
}
break;
default :
break;
}
}
}
private static Fieldref parseFieldref(XmlPullParser parser) throws XmlPullParserException, IOException {
final int initialDepth=parser.getDepth();
Fieldref fieldref=new Fieldref(parser.getAttributeValue("","var"));
outerloop: while (true) {
XmlPullParser.Event eventType=parser.next();
if (eventType == XmlPullParser.Event.END_ELEMENT && parser.getDepth() == initialDepth) {
break outerloop;
}
}
return fieldref;
}
}
