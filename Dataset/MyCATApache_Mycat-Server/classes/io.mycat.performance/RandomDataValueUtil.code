/** 
 * @author wuzhih
 */
public class RandomDataValueUtil {
  /** 
 * eval template contains random vars and replace them with real value alues ( '${date(yyyyMMddHHmmsss-[2014-2015]y)}/psn${date(yyyy)}s/${int(0-9999)}/1 6 7 6 7 : 2 0 7 2 5 ' , ' $ { s t r i n g ( 2 , 0 - 9 9 )} OPP_${enum(BJ,SH,GZ,SZ)}_${int(0-9)} ',${int(10,11)},$int(400,420,500,600,800),$int(0-1000),$int(0-100),$int(0-10),$int(0-99),'201408040028317067b41c0db-4a93-4360-9eb4-e159d1 d b e f 4 5 ' , $ p h o n e , 2 , 2 0 1 4 0 7 1 7 1 5 , 2 3 1 5 9 9 8 , 1 3 9 7 , 1 5 2 3 1 7 9 9 8 , 1 3 9 5 , ' 0 0 0 0 ' )
 * @param templateStr
 * @return
 * @throws IllegalAccessException
 * @throws InstantiationException
 */
  public static LinkedList<StringItem> parselRandVarTemplateString(  String templateStr) throws Exception {
    char[] chars=templateStr.toCharArray();
    LinkedList<StringItem> stringItems=new LinkedList<StringItem>();
    int curPos=0;
    int prevPattenEndPos=0;
    while (curPos < chars.length) {
      char c=chars[curPos];
      if (c == '$' && curPos + 1 < chars.length && chars[curPos + 1] == '{') {
        int start=curPos;
        curPos+=2;
        int end=-1;
        if (curPos < chars.length) {
          for (int i=curPos; i < chars.length; i++) {
            if (chars[i] == '}') {
              end=i;
              if (prevPattenEndPos < start) {
                StringItem item=new StringItem();
                item.initString(templateStr.substring(prevPattenEndPos,start));
                stringItems.add(item);
              }
              stringItems.add(StringItemFactory.parseVarPattern(templateStr.substring(curPos,end)));
              prevPattenEndPos=end + 1;
              curPos=end + 1;
              break;
            }
          }
          if (end == -1) {
            throw new RuntimeException("can't find var patten end pos ,start at " + start);
          }
        }
 else {
          curPos++;
        }
      }
 else {
        curPos++;
      }
    }
    if (prevPattenEndPos < templateStr.length()) {
      StringItem item=new StringItem();
      item.initString(templateStr.substring(prevPattenEndPos,templateStr.length()));
      stringItems.add(item);
    }
    return stringItems;
  }
  public static Properties loadFromPropertyFile(  String sqlFile) throws IOException {
    java.util.Properties pros=new Properties();
    FileInputStream fin=null;
    fin=new FileInputStream(sqlFile);
    pros.load(fin);
    fin.close();
    return pros;
  }
  public static String evalRandValueString(  LinkedList<StringItem> items){
    StringBuilder sb=new StringBuilder();
    for (    StringItem item : items) {
      sb.append(item.getValue());
    }
    return sb.toString();
  }
  public static void main(  String[] args) throws Exception {
    String sqlTemplate="insert into opp_call (logthread, instanceid,callresult,partner, app_id,api_id,apiversion,format,token , phone,calltype, calldate,callminutes,callcost,ecipcalltime,ecipcallcost ,respcode) values ('${date(yyyyMMddHHmmssSSS-[2014-2015]y)}/psn2002s/${int(0-9999)}/${int(1111-9999)}:20725','${char([0-9]2:2)} OPP_${enum(BJ,SH,WU,GZ)}_1',10,${int(10-999)},${int(10-99)},100,3,15,'${date(yyyyMMddHHmmssSSS-[2014-2015]y}${char([a-f,0-9]8:8)}-${char([a-f,0-9]4:4)}-${char([0-9]4:4)}-9eb4-${char([a-f,0-9]12:12)}',${phone(139-189)},2,${date(yyyyMMddHH-[2014-2015]y},2315998,1397,${date(HHmmssSSS)},${int(100-1000)},'${enum(0000,0001,0002)}');";
    System.out.println("SQL template:\r\n" + sqlTemplate);
    LinkedList<StringItem> allItems=parselRandVarTemplateString(sqlTemplate);
    System.out.println("Random SQLs ");
    int total=5;
    for (int i=0; i < total; i++) {
      System.out.println(evalRandValueString(allItems));
    }
  }
}
