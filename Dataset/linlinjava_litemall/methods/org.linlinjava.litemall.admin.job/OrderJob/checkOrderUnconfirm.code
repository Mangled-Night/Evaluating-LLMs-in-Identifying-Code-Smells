/** 
 * 自动确认订单 <p> 定时检查订单未确认情况，如果超时 LITEMALL_ORDER_UNCONFIRM 天则自动确认订单 定时时间是每天凌晨3点。 <p> TODO 注意，因为是相隔一天检查，因此导致订单真正超时时间是 [LITEMALL_ORDER_UNCONFIRM, 1 + LITEMALL_ORDER_UNCONFIRM]
 */
@Scheduled(cron="0 0 3 * * ?") public void checkOrderUnconfirm(){
  logger.info("系统开启定时任务检查订单是否已经超期自动确认收货");
  List<LitemallOrder> orderList=orderService.queryUnconfirm(SystemConfig.getOrderUnconfirm());
  for (  LitemallOrder order : orderList) {
    order.setOrderStatus(OrderUtil.STATUS_AUTO_CONFIRM);
    order.setConfirmTime(LocalDateTime.now());
    if (orderService.updateWithOptimisticLocker(order) == 0) {
      logger.info("订单 ID=" + order.getId() + " 数据已经更新，放弃自动确认收货");
    }
 else {
      logger.info("订单 ID=" + order.getId() + " 已经超期自动确认收货");
    }
  }
  logger.info("系统结束定时任务检查订单是否已经超期自动确认收货");
}
