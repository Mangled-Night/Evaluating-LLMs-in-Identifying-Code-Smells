@Test void iteratorIsSafeDuringUpdate(){
  Partitions partitions=new Partitions();
  partitions.add(node1);
  partitions.add(node2);
  Iterator<RedisClusterNode> iterator=partitions.iterator();
  partitions.remove(node2);
  assertThat(iterator.hasNext()).isTrue();
  assertThat(iterator.next()).isEqualTo(node1);
  assertThat(iterator.next()).isEqualTo(node2);
  iterator=partitions.iterator();
  partitions.remove(node2);
  assertThat(iterator.hasNext()).isTrue();
  assertThat(iterator.next()).isEqualTo(node1);
  assertThat(iterator.hasNext()).isFalse();
}
