private JingleManager(XMPPConnection connection){
  super(connection);
  jutil=new JingleUtil(connection);
  connection.registerIQRequestHandler(new AbstractIqRequestHandler(Jingle.ELEMENT,Jingle.NAMESPACE,IQ.Type.set,Mode.async){
    @Override public IQ handleIQRequest(    IQ iqRequest){
      final Jingle jingle=(Jingle)iqRequest;
      FullJid fullFrom=jingle.getFrom().asFullJidOrThrow();
      String sid=jingle.getSid();
      FullJidAndSessionId fullJidAndSessionId=new FullJidAndSessionId(fullFrom,sid);
      JingleSessionHandler sessionHandler=jingleSessionHandlers.get(fullJidAndSessionId);
      if (sessionHandler != null) {
        return sessionHandler.handleJingleSessionRequest(jingle);
      }
      if (jingle.getAction() == JingleAction.session_initiate) {
        JingleContent content=jingle.getContents().get(0);
        JingleContentDescription description=content.getDescription();
        JingleHandler jingleDescriptionHandler=descriptionHandlers.get(description.getNamespace());
        if (jingleDescriptionHandler == null) {
          LOGGER.log(Level.WARNING,"Unsupported Jingle application.");
          return jutil.createSessionTerminateUnsupportedApplications(fullFrom,sid);
        }
        return jingleDescriptionHandler.handleJingleRequest(jingle);
      }
      LOGGER.log(Level.WARNING,"Unknown session.");
      return jutil.createErrorUnknownSession(jingle);
    }
  }
);
  JingleTransportMethodManager transportMethodManager=JingleTransportMethodManager.getInstanceFor(connection);
  transportMethodManager.registerTransportManager(JingleIBBTransportManager.getInstanceFor(connection));
  transportMethodManager.registerTransportManager(JingleS5BTransportManager.getInstanceFor(connection));
}
