@Test void shouldCompleteWithChunkedResponseOnStack() throws Exception {
  Command<String,String,String> command1=new Command<>(CommandType.SUBSCRIBE,new PubSubOutput<>(StringCodec.UTF8),null);
  Command<String,String,String> command2=new Command<>(CommandType.SUBSCRIBE,new PubSubOutput<>(StringCodec.UTF8),null);
  sut.channelRegistered(context);
  sut.channelActive(context);
  stack.add(command1);
  stack.add(command2);
  sut.channelRead(context,responseBytes("*3\r\n$9\r\nsubscribe\r\n$1\r\na\r\n:2\r\n*3\r\n$9\r\nsubscribe\r\n"));
  sut.channelRead(context,responseBytes("$1\r\nb\r\n:2\r\n"));
  assertThat(command1.isDone()).isTrue();
  assertThat(command2.isDone()).isTrue();
  assertThat(stack).isEmpty();
  ArgumentCaptor<PubSubOutput> captor=ArgumentCaptor.forClass(PubSubOutput.class);
  verify(endpoint,times(2)).notifyMessage(captor.capture());
  assertThat(captor.getAllValues().get(0).channel()).isEqualTo("a");
  assertThat(captor.getAllValues().get(1).channel()).isEqualTo("b");
}
