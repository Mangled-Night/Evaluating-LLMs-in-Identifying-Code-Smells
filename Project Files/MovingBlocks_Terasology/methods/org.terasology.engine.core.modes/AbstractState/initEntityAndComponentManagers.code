protected void initEntityAndComponentManagers(boolean isHeadless){
  verifyNotNull(context);
  CoreRegistry.setContext(context);
  EntitySystemSetupUtil.addEntityManagementRelatedClasses(context);
  entityManager=context.get(EngineEntityManager.class);
  eventSystem=context.get(EventSystem.class);
  context.put(Console.class,new ConsoleImpl(context));
  if (!isHeadless) {
    NUIManager nuiManager=new NUIManagerInternal((TerasologyCanvasRenderer)context.get(CanvasRenderer.class),context);
    context.put(NUIManager.class,nuiManager);
  }
  componentSystemManager=new ComponentSystemManager(context);
  context.put(ComponentSystemManager.class,componentSystemManager);
  componentSystemManager.register(new ConsoleSystem(),"engine:ConsoleSystem");
  componentSystemManager.register(new CoreCommands(),"engine:CoreCommands");
}
