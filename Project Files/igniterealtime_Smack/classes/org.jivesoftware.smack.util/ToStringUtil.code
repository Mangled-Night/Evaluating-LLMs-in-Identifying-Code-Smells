public class ToStringUtil {
  public static Builder builderFor(  Class<?> clazz){
    StringBuilder sb=new StringBuilder();
    sb.append(clazz.getSimpleName()).append('(');
    return new Builder(sb);
  }
public static final class Builder {
    private final StringBuilder sb;
    private Builder(    StringBuilder sb){
      this.sb=sb;
    }
    public Builder addValue(    String name,    Object value){
      if (value == null) {
        return this;
      }
      if (sb.charAt(sb.length() - 1) != '(') {
        sb.append(' ');
      }
      sb.append(name).append("='").append(value).append('\'');
      return this;
    }
    public <V>Builder add(    String name,    Collection<? extends V> values,    Function<?,V> toStringFunction){
      if (values.isEmpty()) {
        return this;
      }
      sb.append(' ').append(name).append('[');
      List<String> stringValues=new ArrayList<>(values.size());
      for (      V value : values) {
        String valueString=toStringFunction.apply(value).toString();
        stringValues.add(valueString);
      }
      StringUtils.appendTo(stringValues,", ",sb);
      sb.append(']');
      return this;
    }
    public String build(){
      sb.append(')');
      return sb.toString();
    }
  }
}
