/** 
 * Macros iq is responsible for handling global and personal macros in the a Live Assistant Workgroup.
 */
public class Macros extends IQ {
  /** 
 * Element name of the stanza extension.
 */
  public static final String ELEMENT_NAME="macros";
  /** 
 * Namespace of the stanza extension.
 */
  public static final String NAMESPACE="http://jivesoftware.com/protocol/workgroup";
  private MacroGroup rootGroup;
  private boolean personal;
  private MacroGroup personalMacroGroup;
  public Macros(){
    super(ELEMENT_NAME,NAMESPACE);
  }
  public MacroGroup getRootGroup(){
    return rootGroup;
  }
  public void setRootGroup(  MacroGroup rootGroup){
    this.rootGroup=rootGroup;
  }
  public boolean isPersonal(){
    return personal;
  }
  public void setPersonal(  boolean personal){
    this.personal=personal;
  }
  public MacroGroup getPersonalMacroGroup(){
    return personalMacroGroup;
  }
  public void setPersonalMacroGroup(  MacroGroup personalMacroGroup){
    this.personalMacroGroup=personalMacroGroup;
  }
  @Override protected IQChildElementXmlStringBuilder getIQChildElementBuilder(  IQChildElementXmlStringBuilder buf){
    buf.rightAngleBracket();
    if (isPersonal()) {
      buf.append("<personal>true</personal>");
    }
    if (getPersonalMacroGroup() != null) {
      buf.append("<personalMacro>");
      buf.append(StringUtils.escapeForXmlText(getPersonalMacroGroup().toXML()));
      buf.append("</personalMacro>");
    }
    return buf;
  }
  /** 
 * An IQProvider for Macro packets.
 * @author Derek DeMoro
 */
public static class InternalProvider extends IqProvider<Macros> {
    @Override public Macros parse(    XmlPullParser parser,    int initialDepth,    IqData iqData,    XmlEnvironment xmlEnvironment) throws XmlPullParserException, IOException {
      Macros macroGroup=new Macros();
      boolean done=false;
      while (!done) {
        XmlPullParser.Event eventType=parser.next();
        if (eventType == XmlPullParser.Event.START_ELEMENT) {
          if (parser.getName().equals("model")) {
            String macros=parser.nextText();
            MacroGroup group=parseMacroGroups(macros);
            macroGroup.setRootGroup(group);
          }
        }
 else         if (eventType == XmlPullParser.Event.END_ELEMENT) {
          if (parser.getName().equals(ELEMENT_NAME)) {
            done=true;
          }
        }
      }
      return macroGroup;
    }
    public Macro parseMacro(    XmlPullParser parser) throws XmlPullParserException, IOException {
      Macro macro=new Macro();
      boolean done=false;
      while (!done) {
        XmlPullParser.Event eventType=parser.next();
        if (eventType == XmlPullParser.Event.START_ELEMENT) {
          if (parser.getName().equals("title")) {
            parser.next();
            macro.setTitle(parser.getText());
          }
 else           if (parser.getName().equals("description")) {
            macro.setDescription(parser.nextText());
          }
 else           if (parser.getName().equals("response")) {
            macro.setResponse(parser.nextText());
          }
 else           if (parser.getName().equals("type")) {
            macro.setType(Integer.valueOf(parser.nextText()).intValue());
          }
        }
 else         if (eventType == XmlPullParser.Event.END_ELEMENT) {
          if (parser.getName().equals("macro")) {
            done=true;
          }
        }
      }
      return macro;
    }
    public MacroGroup parseMacroGroup(    XmlPullParser parser) throws XmlPullParserException, IOException {
      MacroGroup group=new MacroGroup();
      boolean done=false;
      while (!done) {
        XmlPullParser.Event eventType=parser.next();
        if (eventType == XmlPullParser.Event.START_ELEMENT) {
          if (parser.getName().equals("macrogroup")) {
            group.addMacroGroup(parseMacroGroup(parser));
          }
          if (parser.getName().equals("title")) {
            group.setTitle(parser.nextText());
          }
          if (parser.getName().equals("macro")) {
            group.addMacro(parseMacro(parser));
          }
        }
 else         if (eventType == XmlPullParser.Event.END_ELEMENT) {
          if (parser.getName().equals("macrogroup")) {
            done=true;
          }
        }
      }
      return group;
    }
    public MacroGroup parseMacroGroups(    String macros) throws XmlPullParserException, IOException {
      MacroGroup group=null;
      XmlPullParser parser=PacketParserUtils.getParserFor(macros);
      XmlPullParser.Event eventType=parser.getEventType();
      while (eventType != XmlPullParser.Event.END_DOCUMENT) {
        eventType=parser.next();
        if (eventType == XmlPullParser.Event.START_ELEMENT) {
          if (parser.getName().equals("macrogroup")) {
            group=parseMacroGroup(parser);
          }
        }
      }
      return group;
    }
  }
}
