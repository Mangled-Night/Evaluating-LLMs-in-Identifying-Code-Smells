/** 
 * A OMEMO device list update containing the IDs of all active devices of a contact.
 * @author Paul Schaub
 */
public abstract class OmemoDeviceListElement implements ExtensionElement {
  public static final String DEVICE="device";
  public static final String ID="id";
  public static final String LIST="list";
  /** 
 * Unmodifiable set of device IDs.
 */
  private final Set<Integer> deviceIds;
  public OmemoDeviceListElement(  Set<Integer> deviceIds){
    deviceIds=Objects.requireNonNull(deviceIds);
    this.deviceIds=Collections.unmodifiableSet(deviceIds);
  }
  public OmemoDeviceListElement(  OmemoCachedDeviceList cachedList){
    this.deviceIds=Collections.unmodifiableSet(cachedList.getActiveDevices());
  }
  public Set<Integer> getDeviceIds(){
    return deviceIds;
  }
  public Set<Integer> copyDeviceIds(){
    return new HashSet<>(deviceIds);
  }
  @Override public String getElementName(){
    return LIST;
  }
  @Override public final XmlStringBuilder toXML(  org.jivesoftware.smack.packet.XmlEnvironment enclosingNamespace){
    XmlStringBuilder sb=new XmlStringBuilder(this).rightAngleBracket();
    for (    Integer id : deviceIds) {
      sb.halfOpenElement(DEVICE).attribute(ID,id).closeEmptyElement();
    }
    sb.closeElement(this);
    return sb;
  }
  @Override public final String toString(){
    StringBuilder sb=new StringBuilder("OmemoDeviceListElement[");
    Iterator<Integer> iterator=deviceIds.iterator();
    for (    int i : deviceIds) {
      sb.append(i);
      if (iterator.hasNext()) {
        sb.append(',');
      }
    }
    return sb.append(']').toString();
  }
}
