public ByteBuffer writeToBuffer(byte[] src,ByteBuffer buffer){
  int offset=0;
  int length=src.length;
  int remaining=buffer.remaining();
  while (length > 0) {
    if (remaining >= length) {
      buffer.put(src,offset,length);
      break;
    }
 else {
      buffer.put(src,offset,remaining);
      writeNotSend(buffer);
      buffer=allocate();
      offset+=remaining;
      length-=remaining;
      remaining=buffer.remaining();
      continue;
    }
  }
  return buffer;
}
