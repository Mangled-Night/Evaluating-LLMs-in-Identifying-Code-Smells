/** 
 * Represents a set of data results returned as part of a search. The report is structured in columns and rows.
 * @author Gaston Dombiak
 */
public class ReportedData {
  private final List<Column> columns=new ArrayList<>();
  private final List<Row> rows=new ArrayList<>();
  private String title="";
  /** 
 * Returns a new ReportedData if the stanza is used for reporting data and includes an extension that matches the elementName and namespace "x","jabber:x:data".
 * @param packet the stanza used for reporting data.
 * @return ReportedData from the packet if present, otherwise null.
 */
  public static ReportedData getReportedDataFrom(  Stanza packet){
    DataForm dataForm=DataForm.from(packet);
    if (dataForm != null) {
      if (dataForm.getReportedData() != null)       return new ReportedData(dataForm);
    }
    return null;
  }
  /** 
 * Creates a new ReportedData based on the returned dataForm from a search (namespace "jabber:iq:search").
 * @param dataForm the dataForm returned from a search (namespace "jabber:iq:search").
 */
  private ReportedData(  DataForm dataForm){
    for (    FormField field : dataForm.getReportedData().getFields()) {
      columns.add(new Column(field.getLabel(),field.getFieldName(),field.getType()));
    }
    for (    Item item : dataForm.getItems()) {
      List<Field> fieldList=new ArrayList<>(columns.size());
      for (      FormField field : item.getFields()) {
        List<CharSequence> values=new ArrayList<>();
        values.addAll(field.getValues());
        fieldList.add(new Field(field.getFieldName(),values));
      }
      rows.add(new Row(fieldList));
    }
    this.title=dataForm.getTitle();
  }
  public ReportedData(){
  }
  /** 
 * Adds a new <code>Row</code>.
 * @param row the new row to add.
 */
  public void addRow(  Row row){
    rows.add(row);
  }
  /** 
 * Adds a new <code>Column</code>.
 * @param column the column to add.
 */
  public void addColumn(  Column column){
    columns.add(column);
  }
  /** 
 * Returns a List of the rows returned from a search.
 * @return a List of the rows returned from a search.
 */
  public List<Row> getRows(){
    return Collections.unmodifiableList(new ArrayList<>(rows));
  }
  /** 
 * Returns a List of the columns returned from a search.
 * @return a List of the columns returned from a search.
 */
  public List<Column> getColumns(){
    return Collections.unmodifiableList(new ArrayList<>(columns));
  }
  /** 
 * Returns the report's title. It is similar to the title on a web page or an X window.
 * @return title of the report.
 */
  public String getTitle(){
    return title;
  }
  /** 
 * Represents the columns definition of the reported data.
 * @author Gaston Dombiak
 */
public static class Column {
    private final String label;
    private final String variable;
    private final FormField.Type type;
    /** 
 * Creates a new column with the specified definition.
 * @param label the columns's label.
 * @param variable the variable name of the column.
 * @param type the format for the returned data.
 */
    public Column(    String label,    String variable,    FormField.Type type){
      this.label=label;
      this.variable=variable;
      this.type=type;
    }
    /** 
 * Returns the column's label.
 * @return label of the column.
 */
    public String getLabel(){
      return label;
    }
    /** 
 * Returns the column's data format.
 * @return format for the returned data.
 */
    public FormField.Type getType(){
      return type;
    }
    /** 
 * Returns the variable name that the column is showing.
 * @return the variable name of the column.
 */
    public String getVariable(){
      return variable;
    }
  }
public static class Row {
    private List<Field> fields=new ArrayList<>();
    public Row(    List<Field> fields){
      this.fields=fields;
    }
    /** 
 * Returns the values of the field whose variable matches the requested variable.
 * @param variable the variable to match.
 * @return the values of the field whose variable matches the requested variable.
 */
    public List<CharSequence> getValues(    String variable){
      for (      Field field : getFields()) {
        if (variable.equalsIgnoreCase(field.getVariable())) {
          return field.getValues();
        }
      }
      return null;
    }
    /** 
 * Returns the fields that define the data that goes with the item.
 * @return the fields that define the data that goes with the item.
 */
    private List<Field> getFields(){
      return Collections.unmodifiableList(new ArrayList<>(fields));
    }
  }
public static class Field {
    private final String variable;
    private final List<? extends CharSequence> values;
    public Field(    String variable,    List<? extends CharSequence> values){
      this.variable=variable;
      this.values=values;
    }
    /** 
 * Returns the variable name that the field represents.
 * @return the variable name of the field.
 */
    public String getVariable(){
      return variable;
    }
    /** 
 * Returns a List of the values reported as part of the search.
 * @return the returned values of the search.
 */
    public List<CharSequence> getValues(){
      return Collections.unmodifiableList(values);
    }
  }
}
