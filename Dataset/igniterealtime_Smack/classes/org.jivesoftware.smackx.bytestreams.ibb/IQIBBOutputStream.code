/** 
 * IQIBBOutputStream class implements IBBOutputStream to be used with IQ stanzas encapsulating the data packets.
 */
private class IQIBBOutputStream extends IBBOutputStream {
  @Override protected synchronized void writeToXML(  DataPacketExtension data) throws IOException {
    IQ iq=new Data(data);
    iq.setTo(remoteJID);
    try {
      connection.sendIqRequestAndWaitForResponse(iq);
    }
 catch (    Exception e) {
      if (!this.isClosed) {
        InBandBytestreamSession.this.close();
        IOException ioException=new IOException();
        ioException.initCause(e);
        throw ioException;
      }
    }
  }
}
