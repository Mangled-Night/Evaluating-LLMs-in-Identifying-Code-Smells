/** 
 * Check when a client set a new list and then update its content.
 */
public void testCreateAndUpdateList(){
  try {
    String listName="testCreateAndUpdateList";
    String user="tybalt@example.com";
    PrivacyListManager privacyManager=PrivacyListManager.getInstanceFor(getConnection(0));
    PrivacyClient client=new PrivacyClient(privacyManager);
    privacyManager.addListener(client);
    ArrayList<PrivacyItem> items=new ArrayList<PrivacyItem>();
    PrivacyItem item=new PrivacyItem(PrivacyItem.Type.jid.name(),true,1);
    item.setValue(getConnection(0).getUser());
    items.add(item);
    privacyManager.createPrivacyList(listName,items);
    Thread.sleep(500);
    items.remove(item);
    item=new PrivacyItem(PrivacyItem.Type.jid.name(),false,2);
    item.setValue(user);
    item.setFilterPresence_out(true);
    item.setFilterPresence_in(true);
    item.setFilterMessage(true);
    items.add(item);
    privacyManager.updatePrivacyList(listName,items);
    Thread.sleep(500);
    PrivacyList list=privacyManager.getPrivacyList(listName);
    assertEquals(1,list.getItems().size());
    PrivacyItem receivedItem=list.getItems().get(0);
    assertEquals(2,receivedItem.getOrder());
    assertEquals(PrivacyItem.Type.jid,receivedItem.getType());
    assertEquals(false,receivedItem.isAllow());
    assertEquals(user,receivedItem.getValue());
    assertEquals(false,receivedItem.isFilterEverything());
    assertEquals(true,receivedItem.isFilterMessage());
    assertEquals(true,receivedItem.isFilterPresence_in());
    assertEquals(true,receivedItem.isFilterPresence_out());
    assertEquals(true,client.wasModified());
    privacyManager.deletePrivacyList(listName);
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail(e.getMessage());
  }
}
