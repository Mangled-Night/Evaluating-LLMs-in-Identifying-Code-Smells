/** 
 * Adds a listener to this roster. The listener will be fired anytime one or more changes to the roster are pushed from the server.
 * @param listener an agent roster listener.
 */
public void addListener(AgentRosterListener listener){
synchronized (listeners) {
    if (!listeners.contains(listener)) {
      listeners.add(listener);
      for (      EntityBareJid jid : getAgents()) {
        if (entries.contains(jid)) {
          listener.agentAdded(jid);
          Jid j;
          try {
            j=JidCreate.from(jid);
          }
 catch (          XmppStringprepException e) {
            throw new IllegalStateException(e);
          }
          Map<Resourcepart,Presence> userPresences=presenceMap.get(j);
          if (userPresences != null) {
            Iterator<Presence> presences=userPresences.values().iterator();
            while (presences.hasNext()) {
              listener.presenceChanged(presences.next());
            }
          }
        }
      }
    }
  }
}
