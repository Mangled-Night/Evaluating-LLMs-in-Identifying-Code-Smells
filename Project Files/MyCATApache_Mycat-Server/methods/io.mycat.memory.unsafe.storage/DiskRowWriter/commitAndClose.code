/** 
 * Flush the partial writes and commit them as a single atomic block.
 */
public void commitAndClose() throws IOException {
  if (initialized) {
    objOut.flush();
    bs.flush();
    close();
    finalPosition=file.length();
  }
 else {
    finalPosition=file.length();
  }
  commitAndCloseHasBeenCalled=true;
}
