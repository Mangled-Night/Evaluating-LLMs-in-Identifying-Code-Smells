/** 
 * Invocation handler that takes care of connection.close(). Connections are returned to the pool on a close()-call.
 * @author Mark Paluch
 * @param < T > Connection type.
 * @since 4.3
 */
@SuppressWarnings("try") static class DelegateCloseToConnectionInvocationHandler<T extends AsyncCloseable & AutoCloseable> extends AbstractInvocationHandler implements Wrapper<Object> {
  private final T proxiedConnection;
  private final Object api;
  DelegateCloseToConnectionInvocationHandler(  T proxiedConnection,  Object api){
    this.proxiedConnection=proxiedConnection;
    this.api=api;
  }
  @Override protected Object handleInvocation(  Object proxy,  Method method,  Object[] args) throws Throwable {
    if (method.getName().equals("getStatefulConnection")) {
      return proxiedConnection;
    }
    try {
      if (method.getName().equals("close")) {
        proxiedConnection.close();
        return null;
      }
      if (method.getName().equals("closeAsync")) {
        return proxiedConnection.closeAsync();
      }
      return method.invoke(api,args);
    }
 catch (    InvocationTargetException e) {
      throw e.getTargetException();
    }
  }
  @Override public Object unwrap(){
    return api;
  }
}
