/** 
 * Represents the identity of a given XMPP entity. An entity may have many identities but all the identities SHOULD have the same name.<p> Refer to <a href="https://xmpp.org/registrar/disco-categories.html">XMPP Registry for Service Discovery Identities</a> in order to get the official registry of values for the <i>category</i> and <i>type</i> attributes.
 */
public static final class Identity implements Comparable<Identity> {
  private final String category;
  private final String type;
  private final String key;
  private final String name;
  private final String lang;
  /** 
 * Creates a new identity for an XMPP entity.
 * @param category the entity's category (required as per XEP-30).
 * @param type the entity's type (required as per XEP-30).
 */
  public Identity(  String category,  String type){
    this(category,type,null,null);
  }
  /** 
 * Creates a new identity for an XMPP entity. 'category' and 'type' are required by <a href="http://xmpp.org/extensions/xep-0030.html#schemas">XEP-30 XML Schemas</a>
 * @param category the entity's category (required as per XEP-30).
 * @param name the entity's name.
 * @param type the entity's type (required as per XEP-30).
 */
  public Identity(  String category,  String name,  String type){
    this(category,type,name,null);
  }
  /** 
 * Creates a new identity for an XMPP entity. 'category' and 'type' are required by <a href="http://xmpp.org/extensions/xep-0030.html#schemas">XEP-30 XML Schemas</a>
 * @param category the entity's category (required as per XEP-30).
 * @param type the entity's type (required as per XEP-30).
 * @param name the entity's name.
 * @param lang the entity's lang.
 */
  public Identity(  String category,  String type,  String name,  String lang){
    this.category=StringUtils.requireNotNullNorEmpty(category,"category cannot be null");
    this.type=StringUtils.requireNotNullNorEmpty(type,"type cannot be null");
    this.key=XmppStringUtils.generateKey(category,type);
    this.name=name;
    this.lang=lang;
  }
  /** 
 * Returns the entity's category. To get the official registry of values for the 'category' attribute refer to <a href="https://xmpp.org/registrar/disco-categories.html">XMPP Registry for Service Discovery Identities</a>.
 * @return the entity's category.
 */
  public String getCategory(){
    return category;
  }
  /** 
 * Returns the identity's name.
 * @return the identity's name.
 */
  public String getName(){
    return name;
  }
  /** 
 * Returns the entity's type. To get the official registry of values for the 'type' attribute refer to <a href="https://xmpp.org/registrar/disco-categories.html">XMPP Registry for Service Discovery Identities</a>.
 * @return the entity's type.
 */
  public String getType(){
    return type;
  }
  /** 
 * Returns the identities natural language if one is set.
 * @return the value of xml:lang of this Identity
 */
  public String getLanguage(){
    return lang;
  }
  private String getKey(){
    return key;
  }
  /** 
 * Returns true if this identity is of the given category and type.
 * @param category the category.
 * @param type the type.
 * @return true if this identity is of the given category and type.
 */
  public boolean isOfCategoryAndType(  String category,  String type){
    return this.category.equals(category) && this.type.equals(type);
  }
  public XmlStringBuilder toXML(){
    XmlStringBuilder xml=new XmlStringBuilder();
    xml.halfOpenElement("identity");
    xml.xmllangAttribute(lang);
    xml.attribute("category",category);
    xml.optAttribute("name",name);
    xml.optAttribute("type",type);
    xml.closeEmptyElement();
    return xml;
  }
  /** 
 * Check equality for Identity  for category, type, lang and name in that order as defined by <a href="http://xmpp.org/extensions/xep-0115.html#ver-proc">XEP-0015 5.4 Processing Method (Step 3.3)</a>.
 */
  @Override public boolean equals(  Object obj){
    return EqualsUtil.equals(this,obj,(e,o) -> {
      e.append(key,o.key).append(lang,o.lang).append(name,o.name);
    }
);
  }
  private final HashCode.Cache hashCodeCache=new HashCode.Cache();
  @Override public int hashCode(){
    return hashCodeCache.getHashCode(c -> c.append(key).append(lang).append(name));
  }
  /** 
 * Compares this identity with another one. The comparison order is: Category, Type, Lang. If all three are identical the other Identity is considered equal. Name is not used for comparison, as defined by XEP-0115
 * @param other TODO javadoc me please
 * @return a negative integer, zero, or a positive integer as this object is less than,equal to, or greater than the specified object.
 */
  @Override public int compareTo(  DiscoverInfo.Identity other){
    String otherLang=other.lang == null ? "" : other.lang;
    String thisLang=lang == null ? "" : lang;
    String otherType=other.type == null ? "" : other.type;
    String thisType=type == null ? "" : type;
    if (category.equals(other.category)) {
      if (thisType.equals(otherType)) {
        if (thisLang.equals(otherLang)) {
          return 0;
        }
 else {
          return thisLang.compareTo(otherLang);
        }
      }
 else {
        return thisType.compareTo(otherType);
      }
    }
 else {
      return category.compareTo(other.category);
    }
  }
  @Override public String toString(){
    return toXML().toString();
  }
}
