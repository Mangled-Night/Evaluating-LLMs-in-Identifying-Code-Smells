public class DefaultWorldGeneratorPluginLibrary implements WorldGeneratorPluginLibrary {
  private final ClassLibrary<WorldGeneratorPlugin> library;
  public DefaultWorldGeneratorPluginLibrary(  ModuleEnvironment moduleEnvironment,  Context context){
    library=new DefaultModuleClassLibrary<>(moduleEnvironment,context.get(ReflectFactory.class),context.get(CopyStrategyLibrary.class));
    for (    Class<?> entry : moduleEnvironment.getTypesAnnotatedWith(RegisterPlugin.class)) {
      if (WorldGeneratorPlugin.class.isAssignableFrom(entry)) {
        ResourceUrn resourceUrn=new ResourceUrn(moduleEnvironment.getModuleProviding(entry).toString(),entry.getSimpleName());
        library.register(resourceUrn.toString(),entry.asSubclass(WorldGeneratorPlugin.class));
      }
    }
  }
  @Override public <U extends WorldGeneratorPlugin>List<U> instantiateAllOfType(  Class<U> ofType){
    List<U> result=Lists.newArrayList();
    for (    ClassMetadata<?,?> classMetadata : library) {
      if (ofType.isAssignableFrom(classMetadata.getType()) && classMetadata.isConstructable() && classMetadata.getType().getAnnotation(RegisterPlugin.class) != null) {
        U item=ofType.cast(classMetadata.newInstance());
        if (item != null) {
          result.add(item);
        }
      }
    }
    return result;
  }
}
