/** 
 * Unit tests for  {@link ClusterClientOptions}.
 * @author Mark Paluch
 */
class ClusterClientOptionsUnitTests {
  @Test void testCopy(){
    Predicate<RedisClusterNode> nodeFilter=it -> true;
    ClusterClientOptions options=ClusterClientOptions.builder().autoReconnect(false).requestQueueSize(100).suspendReconnectOnProtocolFailure(true).maxRedirects(1234).validateClusterNodeMembership(false).protocolVersion(ProtocolVersion.RESP2).nodeFilter(nodeFilter).build();
    ClusterClientOptions copy=ClusterClientOptions.copyOf(options);
    assertThat(copy.getProtocolVersion()).isEqualTo(options.getProtocolVersion());
    assertThat(copy.getRefreshPeriod()).isEqualTo(options.getRefreshPeriod());
    assertThat(copy.isCloseStaleConnections()).isEqualTo(options.isCloseStaleConnections());
    assertThat(copy.isRefreshClusterView()).isEqualTo(options.isRefreshClusterView());
    assertThat(copy.isValidateClusterNodeMembership()).isEqualTo(options.isValidateClusterNodeMembership());
    assertThat(copy.getRequestQueueSize()).isEqualTo(options.getRequestQueueSize());
    assertThat(copy.isAutoReconnect()).isEqualTo(options.isAutoReconnect());
    assertThat(copy.isCancelCommandsOnReconnectFailure()).isEqualTo(options.isCancelCommandsOnReconnectFailure());
    assertThat(copy.isSuspendReconnectOnProtocolFailure()).isEqualTo(options.isSuspendReconnectOnProtocolFailure());
    assertThat(copy.getMaxRedirects()).isEqualTo(options.getMaxRedirects());
    assertThat(copy.getScriptCharset()).isEqualTo(StandardCharsets.UTF_8);
    assertThat(copy.getNodeFilter()).isEqualTo(nodeFilter);
  }
  @Test void builderFromDefaultClientOptions(){
    ClientOptions clientOptions=ClientOptions.builder().build();
    ClusterClientOptions clusterClientOptions=ClusterClientOptions.builder(clientOptions).build();
    assertThat(clusterClientOptions.getProtocolVersion()).isEqualTo(clusterClientOptions.getProtocolVersion());
    assertThat(clusterClientOptions.getDisconnectedBehavior()).isEqualTo(clusterClientOptions.getDisconnectedBehavior());
    assertThat(clusterClientOptions.getSslOptions()).isEqualTo(clusterClientOptions.getSslOptions());
    assertThat(clusterClientOptions.getTimeoutOptions()).isEqualTo(clusterClientOptions.getTimeoutOptions());
    assertThat(clusterClientOptions.getRequestQueueSize()).isEqualTo(clusterClientOptions.getRequestQueueSize());
    assertThat(clusterClientOptions.isAutoReconnect()).isEqualTo(clusterClientOptions.isAutoReconnect());
    assertThat(clusterClientOptions.isCloseStaleConnections()).isEqualTo(clusterClientOptions.isCloseStaleConnections());
    assertThat(clusterClientOptions.isCancelCommandsOnReconnectFailure()).isEqualTo(clusterClientOptions.isCancelCommandsOnReconnectFailure());
    assertThat(clusterClientOptions.isPublishOnScheduler()).isEqualTo(clusterClientOptions.isPublishOnScheduler());
    assertThat(clusterClientOptions.isSuspendReconnectOnProtocolFailure()).isEqualTo(clusterClientOptions.isSuspendReconnectOnProtocolFailure());
    assertThat(clusterClientOptions.getScriptCharset()).isEqualTo(clusterClientOptions.getScriptCharset());
    assertThat(clusterClientOptions.mutate()).isNotNull();
  }
  @Test void builderFromClusterClientOptions(){
    ClusterClientOptions options=ClusterClientOptions.builder().maxRedirects(1234).validateClusterNodeMembership(false).scriptCharset(StandardCharsets.US_ASCII).build();
    ClusterClientOptions copy=ClusterClientOptions.builder(options).build();
    assertThat(copy.getRefreshPeriod()).isEqualTo(options.getRefreshPeriod());
    assertThat(copy.isCloseStaleConnections()).isEqualTo(options.isCloseStaleConnections());
    assertThat(copy.isRefreshClusterView()).isEqualTo(options.isRefreshClusterView());
    assertThat(copy.isValidateClusterNodeMembership()).isEqualTo(options.isValidateClusterNodeMembership());
    assertThat(copy.getRequestQueueSize()).isEqualTo(options.getRequestQueueSize());
    assertThat(copy.isAutoReconnect()).isEqualTo(options.isAutoReconnect());
    assertThat(copy.isCancelCommandsOnReconnectFailure()).isEqualTo(options.isCancelCommandsOnReconnectFailure());
    assertThat(copy.isSuspendReconnectOnProtocolFailure()).isEqualTo(options.isSuspendReconnectOnProtocolFailure());
    assertThat(copy.getMaxRedirects()).isEqualTo(options.getMaxRedirects());
    assertThat(copy.getScriptCharset()).isEqualTo(options.getScriptCharset());
    assertThat(options.mutate()).isNotSameAs(copy.mutate());
  }
}
