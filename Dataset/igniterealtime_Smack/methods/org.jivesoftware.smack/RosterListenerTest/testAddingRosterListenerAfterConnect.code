public void testAddingRosterListenerAfterConnect() throws Exception {
  int inviterIndex=0;
  int inviteeIndex=1;
  XMPPTCPConnection inviterConnection=getConnection(inviterIndex);
  connectAndLogin(inviterIndex);
  assertTrue("Inviter is not online",inviterConnection.isConnected());
  Roster inviterRoster=inviterConnection.getRoster();
  inviterRoster.createEntry(getBareJID(inviteeIndex),getUsername(inviteeIndex),null);
  Thread.sleep(500);
  XMPPTCPConnection inviteeConnection=getConnection(inviteeIndex);
  connectAndLogin(inviteeIndex);
  assertTrue("Invitee is not online",inviteeConnection.isConnected());
  final List<String> addedEntries=new ArrayList<String>();
  Thread.sleep(200);
  Roster inviteeRoster=inviteeConnection.getRoster();
  inviteeRoster.addRosterListener(new RosterListener(){
    public void presenceChanged(    Presence presence){
    }
    public void entriesUpdated(    Collection<String> addresses){
    }
    public void entriesDeleted(    Collection<String> addresses){
    }
    public void entriesAdded(    Collection<String> addresses){
      addedEntries.addAll(addresses);
    }
  }
);
  Thread.sleep(500);
  assertNotNull("Inviter is not in roster",inviteeRoster.getEntry(getBareJID(inviterIndex)));
  assertFalse("got event for adding inviter",addedEntries.contains(getBareJID(inviterIndex)));
}
