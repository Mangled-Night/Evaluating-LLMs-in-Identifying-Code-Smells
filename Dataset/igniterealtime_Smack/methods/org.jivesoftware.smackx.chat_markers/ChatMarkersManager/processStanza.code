@Override public void processStanza(Stanza packet) throws NotConnectedException, InterruptedException, SmackException.NotLoggedInException {
  final Message message=(Message)packet;
  EntityBareJid bareFrom=message.getFrom().asEntityBareJidOrThrow();
  final Chat chat=chatManager.chatWith(bareFrom);
  asyncButOrdered.performAsyncButOrdered(chat,new Runnable(){
    @Override public void run(){
      for (      ChatMarkersListener listener : incomingListeners) {
        if (ChatMarkersElements.MarkableExtension.from(message) != null) {
          listener.newChatMarkerMessage(ChatMarkersState.markable,message,chat);
        }
 else         if (ChatMarkersElements.ReceivedExtension.from(message) != null) {
          listener.newChatMarkerMessage(ChatMarkersState.received,message,chat);
        }
 else         if (ChatMarkersElements.DisplayedExtension.from(message) != null) {
          listener.newChatMarkerMessage(ChatMarkersState.displayed,message,chat);
        }
 else         if (ChatMarkersElements.AcknowledgedExtension.from(message) != null) {
          listener.newChatMarkerMessage(ChatMarkersState.acknowledged,message,chat);
        }
      }
    }
  }
);
}
