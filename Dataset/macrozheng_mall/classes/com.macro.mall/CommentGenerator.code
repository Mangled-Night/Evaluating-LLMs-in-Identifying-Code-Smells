/** 
 * 自定义注释生成器 Created by macro on 2018/4/26.
 */
public class CommentGenerator extends DefaultCommentGenerator {
  private boolean addRemarkComments=false;
  private static final String EXAMPLE_SUFFIX="Example";
  private static final String MAPPER_SUFFIX="Mapper";
  private static final String API_MODEL_PROPERTY_FULL_CLASS_NAME="io.swagger.annotations.ApiModelProperty";
  /** 
 * 设置用户配置的参数
 */
  @Override public void addConfigurationProperties(  Properties properties){
    super.addConfigurationProperties(properties);
    this.addRemarkComments=StringUtility.isTrue(properties.getProperty("addRemarkComments"));
  }
  /** 
 * 给字段添加注释
 */
  @Override public void addFieldComment(  Field field,  IntrospectedTable introspectedTable,  IntrospectedColumn introspectedColumn){
    String remarks=introspectedColumn.getRemarks();
    if (addRemarkComments && StringUtility.stringHasValue(remarks)) {
      if (remarks.contains("\"")) {
        remarks=remarks.replace("\"","'");
      }
      field.addJavaDocLine("@ApiModelProperty(value = \"" + remarks + "\")");
    }
  }
  /** 
 * 给model的字段添加注释
 */
  private void addFieldJavaDoc(  Field field,  String remarks){
    field.addJavaDocLine("/**");
    String[] remarkLines=remarks.split(System.getProperty("line.separator"));
    for (    String remarkLine : remarkLines) {
      field.addJavaDocLine(" * " + remarkLine);
    }
    addJavadocTag(field,false);
    field.addJavaDocLine(" */");
  }
  @Override public void addJavaFileComment(  CompilationUnit compilationUnit){
    super.addJavaFileComment(compilationUnit);
    if (!compilationUnit.getType().getFullyQualifiedName().contains(MAPPER_SUFFIX) && !compilationUnit.getType().getFullyQualifiedName().contains(EXAMPLE_SUFFIX)) {
      compilationUnit.addImportedType(new FullyQualifiedJavaType(API_MODEL_PROPERTY_FULL_CLASS_NAME));
    }
  }
}
