@Override public void run(){
  try {
    String mysqldump="?mysqldump -h? -P? -u? -p?  ? ? --single-transaction -q --default-character-set=utf8mb4 --hex-blob --where=\"?\" --master-data=1  -T  \"?\"  --fields-enclosed-by=\\\" --fields-terminated-by=, --lines-terminated-by=\\n  --fields-escaped-by=\\\\ ";
    PhysicalDBPool dbPool=MycatServer.getInstance().getConfig().getDataNodes().get(task.getFrom()).getDbPool();
    PhysicalDatasource datasource=dbPool.getSources()[dbPool.getActivedIndex()];
    DBHostConfig config=datasource.getConfig();
    File file=null;
    String spath=querySecurePath(config);
    if (Strings.isNullOrEmpty(spath) || "NULL".equalsIgnoreCase(spath) || "empty".equalsIgnoreCase(spath)) {
      file=new File(SystemConfig.getHomePath() + File.separator + "temp","dump" + File.separator + task.getFrom()+ "_"+ task.getTo());
    }
 else {
      spath+=Thread.currentThread().getId() + System.currentTimeMillis();
      file=new File(spath);
    }
    file.mkdirs();
    String encose=OperatingSystem.isWindows() ? "\\" : "";
    String finalCmd=DataMigratorUtil.paramsAssignment(mysqldump,"?","",config.getIp(),String.valueOf(config.getPort()),config.getUser(),config.getPassword(),MigrateUtils.getDatabaseFromDataNode(task.getFrom()),task.getTable(),makeWhere(task),file.getPath());
    List<String> args=Arrays.asList("mysqldump","-h" + config.getIp(),"-P" + String.valueOf(config.getPort()),"-u" + config.getUser(),!StringUtil.isEmpty(config.getPassword()) ? "-p" + config.getPassword() : "",MigrateUtils.getDatabaseFromDataNode(task.getFrom()),task.getTable(),"--single-transaction","-q","--default-character-set=utf8mb4","--hex-blob","--where=" + makeWhere(task),"--master-data=1","-T" + file.getPath(),"--fields-enclosed-by=" + encose + "\"","--fields-terminated-by=,","--lines-terminated-by=\\n","--fields-escaped-by=\\\\");
    LOGGER.info("migrate 中 mysqldump准备执行命令,如果超长时间没有响应则可能出错");
    LOGGER.info(args.toString());
    String result=ProcessUtil.execReturnString(args);
    int logIndex=result.indexOf("MASTER_LOG_FILE='");
    int logPosIndex=result.indexOf("MASTER_LOG_POS=");
    String logFile=result.substring(logIndex + 17,logIndex + 17 + result.substring(logIndex + 17).indexOf("'"));
    String logPos=result.substring(logPosIndex + 15,logPosIndex + 15 + result.substring(logPosIndex + 15).indexOf(";"));
    task.setBinlogFile(logFile);
    task.setPos(Integer.parseInt(logPos));
    File dataFile=new File(file,task.getTable() + ".txt");
    File sqlFile=new File(file,task.getTable() + ".sql");
    if (!sqlFile.exists()) {
      LOGGER.debug(sqlFile.getAbsolutePath() + "not  exists");
    }
    List<String> createTable=Files.readLines(sqlFile,Charset.forName("UTF-8"));
    LOGGER.info("migrate 中 准备自动创建新的table:" + createTable);
    exeCreateTableToDn(extractCreateSql(createTable),task.getTo(),task.getTable());
    if (dataFile.length() > 0) {
      loaddataToDn(dataFile,task.getTo(),task.getTable());
    }
    pushMsgToZK(task.getZkpath(),task.getFrom() + "-" + task.getTo(),1,"sucess",logFile,logPos);
    DataMigratorUtil.deleteDir(file);
    sucessTask.getAndIncrement();
  }
 catch (  Exception e) {
    try {
      pushMsgToZK(task.getZkpath(),task.getFrom() + "-" + task.getTo(),0,e.getLocalizedMessage(),"","");
    }
 catch (    Exception e1) {
    }
    LOGGER.error("error:",e);
  }
 finally {
    latch.countDown();
  }
}
