/** 
 * Simple test to measure server performance.
 * @author Gaston Dombiak
 */
public class FloodTest extends SmackTestCase {
  public FloodTest(  String arg0){
    super(arg0);
  }
  public void testMessageFlood(){
    try {
      Chat chat11=getConnection(0).getChatManager().createChat(getBareJID(1),null);
      StanzaCollector chat12=getConnection(1).createStanzaCollector(new ThreadFilter(chat11.getThreadID()));
      Chat chat21=getConnection(0).getChatManager().createChat(getBareJID(2),null);
      StanzaCollector chat22=getConnection(2).createStanzaCollector(new ThreadFilter(chat21.getThreadID()));
      Chat chat31=getConnection(0).getChatManager().createChat(getBareJID(3),null);
      StanzaCollector chat32=getConnection(3).createStanzaCollector(new ThreadFilter(chat31.getThreadID()));
      for (int i=0; i < 500; i++) {
        chat11.sendMessage("Hello_1" + i);
        chat21.sendMessage("Hello_2" + i);
        chat31.sendMessage("Hello_3" + i);
      }
      for (int i=0; i < 500; i++) {
        assertNotNull("Some message was lost (" + i + ")",chat12.nextResult(1000));
        assertNotNull("Some message was lost (" + i + ")",chat22.nextResult(1000));
        assertNotNull("Some message was lost (" + i + ")",chat32.nextResult(1000));
      }
    }
 catch (    Exception e) {
      e.printStackTrace();
      fail(e.getMessage());
    }
  }
  protected int getMaxConnections(){
    return 4;
  }
}
