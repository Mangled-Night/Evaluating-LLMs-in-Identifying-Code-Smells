public ByteBuffer checkWriteBuffer(ByteBuffer buffer,int capacity,boolean writeSocketIfFull){
  if (capacity > buffer.remaining()) {
    if (writeSocketIfFull) {
      writeNotSend(buffer);
      return processor.getBufferPool().allocate(capacity);
    }
 else {
      buffer.flip();
      ByteBuffer newBuf=processor.getBufferPool().allocate(capacity + buffer.limit() + 1);
      newBuf.put(buffer);
      this.recycle(buffer);
      return newBuf;
    }
  }
 else {
    return buffer;
  }
}
