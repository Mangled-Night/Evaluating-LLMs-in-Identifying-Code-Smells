/** 
 * Returns the number of key-value mappings in this map. If the map contains more than <tt>Integer.MAX_VALUE</tt> elements, returns <tt>Integer.MAX_VALUE</tt>.
 * @return the number of key-value mappings in this map
 */
@Override public int size(){
  final Segment<K,V>[] segments=this.segments;
  long sum=0;
  long check=0;
  int[] mc=new int[segments.length];
  for (int k=0; k < RETRIES_BEFORE_LOCK; ++k) {
    check=0;
    sum=0;
    int mcsum=0;
    for (int i=0; i < segments.length; ++i) {
      sum+=segments[i].count;
      mcsum+=mc[i]=segments[i].modCount;
    }
    if (mcsum != 0) {
      for (int i=0; i < segments.length; ++i) {
        check+=segments[i].count;
        if (mc[i] != segments[i].modCount) {
          check=-1;
          break;
        }
      }
    }
    if (check == sum) {
      break;
    }
  }
  if (check != sum) {
    sum=0;
    for (    Segment<K,V> segment : segments) {
      segment.lock();
    }
    for (    Segment<K,V> segment : segments) {
      sum+=segment.count;
    }
    for (    Segment<K,V> segment : segments) {
      segment.unlock();
    }
  }
  if (sum > Integer.MAX_VALUE) {
    return Integer.MAX_VALUE;
  }
 else {
    return (int)sum;
  }
}
@Override public int size(){
  return ConcurrentWeakKeyHashMap.this.size();
}
@Override public int size(){
  return ConcurrentWeakKeyHashMap.this.size();
}
@Override public int size(){
  return ConcurrentWeakKeyHashMap.this.size();
}
