/** 
 * Fetch the bundle of a contact and build a fresh OMEMO session with the contacts device. Note that this builds a fresh session, regardless if we have had a session before or not.
 * @param connection authenticated XMPP connection
 * @param userDevice our OmemoDevice
 * @param contactsDevice OmemoDevice of a contact.
 * @throws CannotEstablishOmemoSessionException if we cannot establish a session (because of missing bundle etc.)
 * @throws SmackException.NotConnectedException if the XMPP connection is not connected.
 * @throws InterruptedException if the calling thread was interrupted.
 * @throws SmackException.NoResponseException if there was no response from the remote entity.
 * @throws CorruptedOmemoKeyException if our IdentityKeyPair is corrupted.
 */
void buildFreshSessionWithDevice(XMPPConnection connection,OmemoDevice userDevice,OmemoDevice contactsDevice) throws CannotEstablishOmemoSessionException, SmackException.NotConnectedException, InterruptedException, SmackException.NoResponseException, CorruptedOmemoKeyException {
  if (contactsDevice.equals(userDevice)) {
    return;
  }
  OmemoBundleElement bundleElement;
  try {
    bundleElement=fetchBundle(connection,contactsDevice);
  }
 catch (  XMPPException.XMPPErrorException|PubSubException.NotALeafNodeException|PubSubException.NotAPubSubNodeException e) {
    throw new CannotEstablishOmemoSessionException(contactsDevice,e);
  }
  HashMap<Integer,T_Bundle> bundlesList=getOmemoStoreBackend().keyUtil().BUNDLE.bundles(bundleElement,contactsDevice);
  int randomIndex=new Random().nextInt(bundlesList.size());
  T_Bundle randomPreKeyBundle=new ArrayList<>(bundlesList.values()).get(randomIndex);
  OmemoManager omemoManager=OmemoManager.getInstanceFor(connection,userDevice.getDeviceId());
  processBundle(omemoManager,randomPreKeyBundle,contactsDevice);
}
