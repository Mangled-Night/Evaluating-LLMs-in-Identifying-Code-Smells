private void tryRoute(SchemaConfig schema,RouteResultset rrs,LayerCachePool cachePool) throws SQLNonTransientException {
  if (rrs.isFinishedRoute()) {
    return;
  }
  if ((ctx.getTables() == null || ctx.getTables().size() == 0) && (ctx.getTableAliasMap() == null || ctx.getTableAliasMap().isEmpty())) {
    rrs=RouterUtil.routeToSingleNode(rrs,schema.getRandomDataNode(),ctx.getSql());
    rrs.setFinishedRoute(true);
    return;
  }
  SortedSet<RouteResultsetNode> nodeSet=new TreeSet<RouteResultsetNode>();
  boolean isAllGlobalTable=RouterUtil.isAllGlobalTable(ctx,schema);
  for (  RouteCalculateUnit unit : ctx.getRouteCalculateUnits()) {
    RouteResultset rrsTmp=RouterUtil.tryRouteForTables(schema,ctx,unit,rrs,true,cachePool);
    if (rrsTmp != null && rrsTmp.getNodes() != null) {
      for (      RouteResultsetNode node : rrsTmp.getNodes()) {
        nodeSet.add(node);
      }
    }
    if (isAllGlobalTable) {
      break;
    }
  }
  if (nodeSet.size() == 0) {
    Collection<String> stringCollection=ctx.getTableAliasMap().values();
    for (    String table : stringCollection) {
      if (table != null && table.toLowerCase().contains("information_schema.")) {
        rrs=RouterUtil.routeToSingleNode(rrs,schema.getRandomDataNode(),ctx.getSql());
        rrs.setFinishedRoute(true);
        return;
      }
    }
    if (ctx.getTableAliasMap().size() > 0) {
      for (      String key : ctx.getTableAliasMap().keySet()) {
        TableConfig tb_config=schema.getTables().get(key.toUpperCase());
        if (tb_config != null) {
          String table_name=ctx.getTableAliasMap().get(key);
          for (          String dataNode : tb_config.getDataNodes()) {
            if (tb_config.getDataNodes().size() == 1 || table_name.startsWith(dataNode + '.')) {
              rrs=RouterUtil.routeToSingleNode(rrs,dataNode,ctx.getSql());
              rrs.setFinishedRoute(true);
              return;
            }
          }
        }
      }
    }
    String msg=" find no Route:" + ctx.getSql();
    LOGGER.warn(msg);
    throw new SQLNonTransientException(msg);
  }
  RouteResultsetNode[] nodes=new RouteResultsetNode[nodeSet.size()];
  int i=0;
  for (Iterator<RouteResultsetNode> iterator=nodeSet.iterator(); iterator.hasNext(); ) {
    nodes[i]=(RouteResultsetNode)iterator.next();
    i++;
  }
  rrs.setNodes(nodes);
  rrs.setFinishedRoute(true);
}
