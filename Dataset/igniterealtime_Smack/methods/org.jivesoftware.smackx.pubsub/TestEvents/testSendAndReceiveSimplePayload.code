public void testSendAndReceiveSimplePayload() throws Exception {
  String nodeId="TestNode" + System.currentTimeMillis();
  PubSubManager creatorMgr=new PubSubManager(getConnection(0),getService());
  LeafNode creatorNode=getPubnode(creatorMgr,nodeId,true,true);
  BlockingQueue<ItemEventCoordinator<PayloadItem<SimplePayload>>> queue=new ArrayBlockingQueue<ItemEventCoordinator<PayloadItem<SimplePayload>>>(3);
  PubSubManager subMgr=new PubSubManager(getConnection(1),getService());
  LeafNode subNode=(LeafNode)subMgr.getNode(nodeId);
  ItemEventCoordinator<PayloadItem<SimplePayload>> sub1Handler=new ItemEventCoordinator<PayloadItem<SimplePayload>>(queue,"sub1");
  subNode.addItemEventListener(sub1Handler);
  Subscription sub1=subNode.subscribe(getConnection(1).getUser());
  String itemId=String.valueOf(System.currentTimeMillis());
  String payloadString="<book xmlns=\"pubsub:test:book\"><author>Sir Arthur Conan Doyle</author></book>";
  creatorNode.send(new PayloadItem<SimplePayload>(itemId,new SimplePayload("book","pubsub:test:book",payloadString)));
  ItemEventCoordinator<PayloadItem<SimplePayload>> coord=queue.poll(5,TimeUnit.SECONDS);
  assertEquals(1,coord.events.getItems().size());
  PayloadItem<SimplePayload> item=coord.events.getItems().get(0);
  assertEquals(itemId,item.getId());
  assertTrue(item.getPayload() instanceof SimplePayload);
  assertEquals(payloadString,item.getPayload().toXML());
  assertEquals("book",item.getPayload().getElementName());
}
