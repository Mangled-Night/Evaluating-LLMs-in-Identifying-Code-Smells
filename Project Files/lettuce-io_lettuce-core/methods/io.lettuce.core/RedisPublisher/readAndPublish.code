/** 
 * Reads and publishes data from the input. Continues until either there is no more demand, or until there is no more data to be read.
 */
void readAndPublish(){
  while (hasDemand()) {
    T data=read();
    if (data == null) {
      return;
    }
    DEMAND.decrementAndGet(this);
    this.subscriber.onNext(data);
  }
}
