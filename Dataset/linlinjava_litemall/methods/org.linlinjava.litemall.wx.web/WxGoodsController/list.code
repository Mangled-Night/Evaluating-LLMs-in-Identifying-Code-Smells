/** 
 * 根据条件搜素商品 <p> 1. 这里的前五个参数都是可选的，甚至都是空 2. 用户是可选登录，如果登录，则记录用户的搜索关键字
 * @param categoryId 分类类目ID，可选
 * @param brandId    品牌商ID，可选
 * @param keyword    关键字，可选
 * @param isNew      是否新品，可选
 * @param isHot      是否热买，可选
 * @param userId     用户ID
 * @param page       分页页数
 * @param limit       分页大小
 * @param sort       排序方式，支持"add_time", "retail_price"或"name"
 * @param order      排序类型，顺序或者降序
 * @return 根据条件搜素的商品详情
 */
@GetMapping("list") public Object list(Integer categoryId,Integer brandId,String keyword,Boolean isNew,Boolean isHot,@LoginUser Integer userId,@RequestParam(defaultValue="1") Integer page,@RequestParam(defaultValue="10") Integer limit,@Sort(accepts={"add_time","retail_price","name"}) @RequestParam(defaultValue="add_time") String sort,@Order @RequestParam(defaultValue="desc") String order){
  if (userId != null && !StringUtils.isEmpty(keyword)) {
    LitemallSearchHistory searchHistoryVo=new LitemallSearchHistory();
    searchHistoryVo.setKeyword(keyword);
    searchHistoryVo.setUserId(userId);
    searchHistoryVo.setFrom("wx");
    searchHistoryService.save(searchHistoryVo);
  }
  List<LitemallGoods> goodsList=goodsService.querySelective(categoryId,brandId,keyword,isHot,isNew,page,limit,sort,order);
  List<Integer> goodsCatIds=goodsService.getCatIds(brandId,keyword,isHot,isNew);
  List<LitemallCategory> categoryList=null;
  if (goodsCatIds.size() != 0) {
    categoryList=categoryService.queryL2ByIds(goodsCatIds);
  }
 else {
    categoryList=new ArrayList<>(0);
  }
  PageInfo<LitemallGoods> pagedList=PageInfo.of(goodsList);
  Map<String,Object> entity=new HashMap<>();
  entity.put("list",goodsList);
  entity.put("total",pagedList.getTotal());
  entity.put("page",pagedList.getPageNum());
  entity.put("limit",pagedList.getPageSize());
  entity.put("pages",pagedList.getPages());
  entity.put("filterCategoryList",categoryList);
  return ResponseUtil.ok(entity);
}
