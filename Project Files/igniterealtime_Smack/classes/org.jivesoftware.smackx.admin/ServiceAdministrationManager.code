public class ServiceAdministrationManager extends Manager {
  public static final String COMMAND_NODE="http://jabber.org/protocol/admin";
  private static final String COMMAND_NODE_HASHSIGN=COMMAND_NODE + '#';
  private static final Map<XMPPConnection,ServiceAdministrationManager> INSTANCES=new WeakHashMap<>();
  public static synchronized ServiceAdministrationManager getInstanceFor(  XMPPConnection connection){
    ServiceAdministrationManager serviceAdministrationManager=INSTANCES.get(connection);
    if (serviceAdministrationManager == null) {
      serviceAdministrationManager=new ServiceAdministrationManager(connection);
      INSTANCES.put(connection,serviceAdministrationManager);
    }
    return serviceAdministrationManager;
  }
  private final AdHocCommandManager adHocCommandManager;
  public ServiceAdministrationManager(  XMPPConnection connection){
    super(connection);
    adHocCommandManager=AdHocCommandManager.getAddHocCommandsManager(connection);
  }
  public RemoteCommand addUser(){
    return addUser(connection().getXMPPServiceDomain());
  }
  public RemoteCommand addUser(  Jid service){
    return adHocCommandManager.getRemoteCommand(service,COMMAND_NODE_HASHSIGN + "add-user");
  }
  public void addUser(  final EntityBareJid userJid,  final String password) throws NoResponseException, XMPPErrorException, NotConnectedException, InterruptedException {
    RemoteCommand command=addUser();
    command.execute();
    FillableForm answerForm=new FillableForm(command.getForm());
    answerForm.setAnswer("accountjid",userJid);
    answerForm.setAnswer("password",password);
    answerForm.setAnswer("password-verify",password);
    command.execute(answerForm);
    assert command.isCompleted();
  }
  public RemoteCommand deleteUser(){
    return deleteUser(connection().getXMPPServiceDomain());
  }
  public RemoteCommand deleteUser(  Jid service){
    return adHocCommandManager.getRemoteCommand(service,COMMAND_NODE_HASHSIGN + "delete-user");
  }
  public void deleteUser(  EntityBareJid userJidToDelete) throws NoResponseException, XMPPErrorException, NotConnectedException, InterruptedException {
    Set<EntityBareJid> userJidsToDelete=Collections.singleton(userJidToDelete);
    deleteUser(userJidsToDelete);
  }
  public void deleteUser(  Set<EntityBareJid> jidsToDelete) throws NoResponseException, XMPPErrorException, NotConnectedException, InterruptedException {
    RemoteCommand command=deleteUser();
    command.execute();
    FillableForm answerForm=new FillableForm(command.getForm());
    answerForm.setAnswer("accountjids",jidsToDelete);
    command.execute(answerForm);
    assert command.isCompleted();
  }
}
