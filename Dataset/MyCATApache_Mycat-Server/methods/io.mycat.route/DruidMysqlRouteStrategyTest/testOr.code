/** 
 * 测试or语句的路由
 * @throws Exception
 */
@Test public void testOr() throws Exception {
  SchemaConfig schema=schemaMap.get("TESTDB");
  String sql="select * from customer where sharding_id=10000 or 1=1;";
  RouteResultset rrs=routeStrategy.route(new SystemConfig(),schema,ServerParse.SELECT,sql,null,null,cachePool);
  Assert.assertTrue(rrs.getNodes().length == 2);
  Assert.assertTrue(rrs.getNodes()[0].getName().equals("dn1"));
  Assert.assertTrue(rrs.getNodes()[1].getName().equals("dn2"));
  sql="select * from customer where sharding_id = 10000 or sharding_id = 10010";
  rrs=routeStrategy.route(new SystemConfig(),schema,ServerParse.SELECT,sql,null,null,cachePool);
  Assert.assertTrue(rrs.getNodes()[0].getName().equals("dn1"));
  Assert.assertTrue(rrs.getNodes()[1].getName().equals("dn2"));
  sql="select * from customer where sharding_id = 10000 or user_id = 'wangwu'";
  rrs=routeStrategy.route(new SystemConfig(),schema,ServerParse.SELECT,sql,null,null,cachePool);
  Assert.assertTrue(rrs.getNodes()[0].getName().equals("dn1"));
  Assert.assertTrue(rrs.getNodes()[1].getName().equals("dn2"));
  sql="select * from customer where sharding_id = 10000 and (user_id = 'zhangsan' or user_id='lisi')";
  rrs=routeStrategy.route(new SystemConfig(),schema,ServerParse.SELECT,sql,null,null,cachePool);
  Assert.assertTrue(rrs.getNodes()[0].getName().equals("dn1"));
  sql="select * from customer where (user_id = 'zhangsan' or user_id='lisi') and sharding_id = 10000";
  RouteResultset rrs2=routeStrategy.route(new SystemConfig(),schema,ServerParse.SELECT,sql,null,null,cachePool);
  Assert.assertTrue(rrs2.getNodes()[0].getName().equals(rrs.getNodes()[0].getName()));
}
