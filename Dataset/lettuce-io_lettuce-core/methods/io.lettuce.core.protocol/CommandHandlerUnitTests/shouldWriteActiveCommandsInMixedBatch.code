@Test @SuppressWarnings("unchecked") void shouldWriteActiveCommandsInMixedBatch() throws Exception {
  Command<String,String,String> command2=new Command<>(CommandType.APPEND,new StatusOutput<>(StringCodec.UTF8),null);
  command.cancel();
  when(promise.isVoid()).thenReturn(true);
  sut.write(context,Arrays.asList(command,command2),promise);
  ArgumentCaptor<Collection> captor=ArgumentCaptor.forClass(Collection.class);
  verify(context).write(captor.capture(),any());
  assertThat(captor.getValue()).containsOnly(command2);
  assertThat(stack).hasSize(1).allMatch(o -> o instanceof LatencyMeteredCommand).allMatch(o -> CommandWrapper.unwrap((RedisCommand)o) == command2);
}
