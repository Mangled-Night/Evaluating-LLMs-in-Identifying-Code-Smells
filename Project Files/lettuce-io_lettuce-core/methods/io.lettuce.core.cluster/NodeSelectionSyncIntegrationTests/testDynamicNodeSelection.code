@Test void testDynamicNodeSelection(){
  Partitions partitions=commands.getStatefulConnection().getPartitions();
  partitions.forEach(redisClusterNode -> redisClusterNode.setFlags(Collections.singleton(RedisClusterNode.NodeFlag.UPSTREAM)));
  NodeSelection<String,String> selection=commands.nodes(redisClusterNode -> redisClusterNode.getFlags().contains(RedisClusterNode.NodeFlag.MYSELF),true);
  assertThat(selection.asMap()).hasSize(0);
  partitions.getPartition(0).setFlags(LettuceSets.unmodifiableSet(RedisClusterNode.NodeFlag.MYSELF,RedisClusterNode.NodeFlag.UPSTREAM));
  assertThat(selection.asMap()).hasSize(1);
  partitions.getPartition(1).setFlags(LettuceSets.unmodifiableSet(RedisClusterNode.NodeFlag.MYSELF,RedisClusterNode.NodeFlag.UPSTREAM));
  assertThat(selection.asMap()).hasSize(2);
  clusterClient.reloadPartitions();
}
