public class LoginIntegrationTest extends AbstractSmackLowLevelIntegrationTest {
  public LoginIntegrationTest(  SmackIntegrationTestEnvironment environment){
    super(environment);
  }
  /** 
 * Check that the server is returning the correct error when trying to login using an invalid (i.e. non-existent) user.
 * @throws InterruptedException if the calling thread was interrupted.
 * @throws XMPPException if an XMPP protocol error was received.
 * @throws IOException if an I/O error occurred.
 * @throws SmackException if Smack detected an exceptional situation.
 * @throws NoSuchAlgorithmException if no such algorithm is available.
 * @throws KeyManagementException if there was a key mangement error.
 */
  @SmackIntegrationTest public void testInvalidLogin() throws SmackException, IOException, XMPPException, InterruptedException, KeyManagementException, NoSuchAlgorithmException {
    final String nonExistentUserString=StringUtils.insecureRandomString(24);
    final String invalidPassword="invalidPassword";
    AbstractXMPPConnection connection=getUnconnectedConnection();
    connection.connect();
    try {
      SASLErrorException saslErrorException=assertThrows(SASLErrorException.class,() -> connection.login(nonExistentUserString,invalidPassword));
      SaslNonza.SASLFailure saslFailure=saslErrorException.getSASLFailure();
      assertEquals(SASLError.not_authorized,saslFailure.getSASLError());
    }
  finally {
      connection.disconnect();
    }
  }
}
