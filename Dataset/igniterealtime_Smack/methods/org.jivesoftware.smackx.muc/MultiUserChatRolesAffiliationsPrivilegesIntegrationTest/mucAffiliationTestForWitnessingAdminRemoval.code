/** 
 * Asserts that a user who is present when another user undergoes an affiliation change receives that change as a presence update <p>From XEP-0045 ยง 5.2.2:</p> <blockquote> ...a MUC service implementation MUST change the user's affiliation to reflect the change and communicate that to all occupants... </blockquote> <p>From XEP-0045 ยง 10.7:</p> <blockquote> If the user is in the room, the service MUST then send updated presence from this individual to all occupants, indicating the loss of admin status by sending a presence element... </blockquote>
 * @throws Exception when errors occur
 */
@SmackIntegrationTest public void mucAffiliationTestForWitnessingAdminRemoval() throws Exception {
  EntityBareJid mucAddress=getRandomRoom("smack-inttest");
  MultiUserChat mucAsSeenByOne=mucManagerOne.getMultiUserChat(mucAddress);
  MultiUserChat mucAsSeenByTwo=mucManagerTwo.getMultiUserChat(mucAddress);
  MultiUserChat mucAsSeenByThree=mucManagerThree.getMultiUserChat(mucAddress);
  final ResultSyncPoint<String,Exception> resultSyncPoint=new ResultSyncPoint<>();
  mucAsSeenByThree.addParticipantStatusListener(new ParticipantStatusListener(){
    @Override public void adminRevoked(    EntityFullJid participant){
      resultSyncPoint.signal("done");
    }
  }
);
  createMuc(mucAsSeenByOne,"one-" + randomString);
  try {
    final Resourcepart nicknameTwo=Resourcepart.from("two-" + randomString);
    final Resourcepart nicknameThree=Resourcepart.from("three-" + randomString);
    mucAsSeenByTwo.join(nicknameTwo);
    mucAsSeenByThree.join(nicknameThree);
    mucAsSeenByOne.grantAdmin(conTwo.getUser().asBareJid());
    mucAsSeenByOne.revokeAdmin(conTwo.getUser().asEntityBareJid());
    resultSyncPoint.waitForResult(timeout);
  }
  finally {
    tryDestroy(mucAsSeenByOne);
  }
}
