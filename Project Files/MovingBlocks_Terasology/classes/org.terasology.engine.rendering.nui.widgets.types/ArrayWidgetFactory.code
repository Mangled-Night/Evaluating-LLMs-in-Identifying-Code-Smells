public class ArrayWidgetFactory implements TypeWidgetFactory {
  private ConstructorLibrary constructorLibrary;
  public ArrayWidgetFactory(  ConstructorLibrary constructorLibrary){
    this.constructorLibrary=constructorLibrary;
  }
  @Override public <T>Optional<TypeWidgetBuilder<T>> create(  TypeInfo<T> type,  TypeWidgetLibrary library){
    Class<T> rawType=type.getRawType();
    if (!rawType.isArray()) {
      return Optional.empty();
    }
    TypeInfo<Object[]> arrayType=(TypeInfo<Object[]>)type;
    TypeWidgetBuilder<Object[]> widget=new GrowableListArrayWidgetBuilder<>(arrayType,library,constructorLibrary.get(arrayType));
    return Optional.of((TypeWidgetBuilder<T>)widget);
  }
private static class GrowableListArrayWidgetBuilder<E> extends GrowableListWidgetBuilder<E[],E> {
    GrowableListArrayWidgetBuilder(    TypeInfo<E[]> type,    TypeWidgetLibrary library,    ObjectConstructor<E[]> constructor){
      super(type,ReflectionUtil.getComponentType(type),library,constructor);
    }
    @Override protected void updateBindingWithElements(    Binding<E[]> binding,    List<E> elements){
      binding.set(Iterables.toArray(elements,elementType.getRawType()));
    }
    @Override protected Stream<E> getBindingStream(    Binding<E[]> binding){
      return Arrays.stream(binding.get());
    }
  }
}
