@Override public boolean checkDmlPrivilege(String user,String schema,String sql){
  if (schema == null) {
    return true;
  }
  boolean isPassed=false;
  MycatConfig conf=MycatServer.getInstance().getConfig();
  UserConfig userConfig=conf.getUsers().get(user);
  if (userConfig != null) {
    UserPrivilegesConfig userPrivilege=userConfig.getPrivilegesConfig();
    if (userPrivilege != null && userPrivilege.isCheck()) {
      UserPrivilegesConfig.SchemaPrivilege schemaPrivilege=userPrivilege.getSchemaPrivilege(schema);
      if (schemaPrivilege != null) {
        String tableName=null;
        int index=-1;
        if (sql != null && sql.length() == 5 && sql.equalsIgnoreCase("begin")) {
          return true;
        }
        SQLStatementParser parser=new MycatStatementParser(sql);
        SQLStatement stmt=parser.parseStatement();
        if (stmt instanceof SQLReplaceStatement || stmt instanceof SQLInsertStatement) {
          index=0;
        }
 else         if (stmt instanceof SQLUpdateStatement) {
          index=1;
        }
 else         if (stmt instanceof SQLSelectStatement) {
          index=2;
        }
 else         if (stmt instanceof SQLDeleteStatement) {
          index=3;
        }
        if (index > -1) {
          MycatSchemaStatVisitor schemaStatVisitor=new MycatSchemaStatVisitor();
          stmt.accept(schemaStatVisitor);
          String key=schemaStatVisitor.getCurrentTable();
          if (key != null) {
            if (key.contains("`")) {
              key=key.replaceAll("`","");
            }
            int dotIndex=key.indexOf(".");
            if (dotIndex > 0) {
              tableName=key.substring(dotIndex + 1);
            }
 else {
              tableName=key;
            }
            UserPrivilegesConfig.TablePrivilege tablePrivilege=schemaPrivilege.getTablePrivilege(tableName);
            if (tablePrivilege.getDml()[index] > 0) {
              isPassed=true;
            }
          }
 else {
            isPassed=true;
          }
        }
 else {
          isPassed=true;
        }
      }
 else {
        isPassed=true;
      }
    }
 else {
      isPassed=true;
    }
  }
 else {
    isPassed=true;
  }
  if (!isPassed) {
    ALARM.error(new StringBuilder().append(Alarms.DML_ATTACK).append("[sql=").append(sql).append(",user=").append(user).append(']').toString());
  }
  return isPassed;
}
