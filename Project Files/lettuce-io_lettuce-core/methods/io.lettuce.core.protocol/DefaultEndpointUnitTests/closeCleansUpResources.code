@Test void closeCleansUpResources(){
  ChannelFuture future=mock(ChannelFuture.class);
  when(future.isSuccess()).thenReturn(true);
  when(channel.close()).thenReturn(future);
  sut.notifyChannelActive(channel);
  sut.registerConnectionWatchdog(connectionWatchdog);
  sut.close();
  verify(channel).close();
  verify(connectionWatchdog).prepareClose();
}
