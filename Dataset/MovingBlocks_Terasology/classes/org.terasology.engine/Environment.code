/** 
 * Set up an empty Terasology environment. <p> Not for use outside  {@code engine-tests}. Modules should use ModuleTestingEnvironment.
 */
class Environment {
  private static final Logger logger=LoggerFactory.getLogger(Environment.class);
  protected Context context;
  /** 
 * Default setup order
 * @param moduleNames a list of module names
 */
  Environment(  Name... moduleNames){
    try {
      reset(Sets.newHashSet(moduleNames));
    }
 catch (    Exception e) {
      if (e instanceof RuntimeException) {
        throw (RuntimeException)e;
      }
 else {
        throw new RuntimeException(e);
      }
    }
  }
  protected void reset(  Set<Name> moduleNames) throws Exception {
    this.context=new ContextImpl();
    RecordAndReplayCurrentStatus recordAndReplayCurrentStatus=new RecordAndReplayCurrentStatus();
    context.put(RecordAndReplayCurrentStatus.class,recordAndReplayCurrentStatus);
    CoreRegistry.setContext(context);
    setupPathManager();
    Bullet.init(true,false);
    setupConfig();
    setupModuleManager(moduleNames);
    setupDisplay();
    setupAudio();
    AssetManager assetManager=setupAssetManager();
    setupBlockManager(assetManager);
    setupExtraDataManager(context);
    setupCollisionManager();
    setupNetwork();
    setupEntitySystem();
    setupStorageManager();
    setupComponentManager();
    setupWorldProvider();
    setupCelestialSystem();
    loadPrefabs();
  }
  protected void loadPrefabs(){
  }
  protected void setupComponentManager(){
  }
  protected void setupPathManager() throws IOException {
    PathManager.getInstance();
  }
  protected void setupModuleManager(  Set<Name> moduleNames) throws Exception {
  }
  protected void setupDisplay(){
  }
  protected void setupConfig(){
  }
  protected void setupAudio(){
  }
  protected AssetManager setupAssetManager(){
    return null;
  }
  protected AssetManager setupEmptyAssetManager(){
    return null;
  }
  protected void setupBlockManager(  AssetManager assetManager){
  }
  protected void setupExtraDataManager(  Context context){
  }
  protected void setupCollisionManager(){
  }
  protected void setupEntitySystem(){
  }
  protected void setupNetwork(){
  }
  protected void setupStorageManager() throws IOException {
  }
  protected void setupWorldProvider(){
  }
  protected void setupCelestialSystem(){
  }
  /** 
 * Cleans up all resources (similar to AutoCloseable)
 * @throws Exception if something goes wrong
 */
  public void close() throws Exception {
    CoreRegistry.setContext(null);
    context=null;
  }
  public Context getContext(){
    return context;
  }
}
