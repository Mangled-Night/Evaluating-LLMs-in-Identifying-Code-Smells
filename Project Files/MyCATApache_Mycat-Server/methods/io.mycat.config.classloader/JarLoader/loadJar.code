public static Class<?> loadJar(String fileName,String mainJavaclass) throws Exception {
  File file=new File(fileName);
  String mainClassName=null;
  JarFile jarFile;
  try {
    jarFile=new JarFile(fileName);
  }
 catch (  IOException io) {
    throw new IOException("Error opening jar: " + fileName);
  }
  Manifest manifest=jarFile.getManifest();
  if (manifest != null) {
    mainClassName=manifest.getMainAttributes().getValue("Main-Class");
  }
  jarFile.close();
  if (mainClassName == null) {
    mainClassName=mainJavaclass;
  }
  mainClassName=mainClassName.replaceAll("/",".");
  File tmpDir=new File(System.getProperty("java.io.tmpdir"));
  tmpDir.mkdirs();
  if (!tmpDir.isDirectory()) {
    System.out.println("Mkdirs failed to create " + tmpDir);
  }
  final File workDir=File.createTempFile("unjar","",tmpDir);
  workDir.delete();
  workDir.mkdirs();
  if (!workDir.isDirectory()) {
    System.out.println("Mkdirs failed to create " + workDir);
  }
  Runtime.getRuntime().addShutdownHook(new Thread(){
    public void run(){
      try {
        fullyDelete(workDir);
      }
 catch (      IOException e) {
      }
    }
  }
);
  unJar(file,workDir);
  ArrayList<URL> classPath=new ArrayList<URL>();
  classPath.add(new File(workDir + "/").toURL());
  classPath.add(file.toURL());
  classPath.add(new File(workDir,"classes/").toURL());
  File[] libs=new File(workDir,"lib").listFiles();
  if (libs != null) {
    for (int i=0; i < libs.length; i++) {
      classPath.add(libs[i].toURL());
    }
  }
  ClassLoader loader=new URLClassLoader(classPath.toArray(new URL[0]));
  Thread.currentThread().setContextClassLoader(loader);
  Class<?> mainClass=Class.forName(mainClassName,true,loader);
  return mainClass;
}
