protected final void sendStreamOpen() throws NotConnectedException, InterruptedException {
  DomainBareJid to=getXMPPServiceDomain();
  CharSequence from=null;
  CharSequence localpart=config.getUsername();
  if (localpart != null) {
    from=XmppStringUtils.completeJidFrom(localpart,to);
  }
  String id=getStreamId();
  String lang=config.getXmlLang();
  AbstractStreamOpen streamOpen=getStreamOpen(to,from,id,lang);
  sendNonza(streamOpen);
  updateOutgoingStreamXmlEnvironmentOnStreamOpen(streamOpen);
}
