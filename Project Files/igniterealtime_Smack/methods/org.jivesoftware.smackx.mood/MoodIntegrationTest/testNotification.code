/** 
 * Verifies that a notification is sent when a publication is received, assuming that notification filtering has been adjusted to allow for the notification to be delivered.
 * @throws Exception if the test fails
 */
@SmackIntegrationTest public void testNotification() throws Exception {
  Mood data=Mood.satisfied;
  IntegrationTestRosterUtil.ensureBothAccountsAreSubscribedToEachOther(conOne,conTwo,timeout);
  final SimpleResultSyncPoint moodReceived=new SimpleResultSyncPoint();
  final PepEventListener<MoodElement> moodListener=(jid,moodElement,id,message) -> {
    if (moodElement.getMood().equals(data)) {
      moodReceived.signal();
    }
  }
;
  try {
    registerListenerAndWait(mm2,ServiceDiscoveryManager.getInstanceFor(conTwo),moodListener);
    mm1.setMood(data);
    try {
      moodReceived.waitForResult(timeout);
    }
 catch (    TimeoutException e) {
      Assertions.fail("Expected to receive a PEP notification, but did not.");
    }
  }
  finally {
    unregisterListener(mm2,moodListener);
  }
}
