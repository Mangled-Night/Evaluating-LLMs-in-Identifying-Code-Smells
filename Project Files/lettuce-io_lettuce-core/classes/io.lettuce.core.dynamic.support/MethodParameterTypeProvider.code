/** 
 * {@link TypeProvider} for {@link Type}s obtained from a  {@link MethodParameter}.
 */
@SuppressWarnings("serial") static class MethodParameterTypeProvider implements TypeProvider {
  private final String methodName;
  private final Class<?>[] parameterTypes;
  private final Class<?> declaringClass;
  private final int parameterIndex;
  private transient MethodParameter methodParameter;
  public MethodParameterTypeProvider(  MethodParameter methodParameter){
    if (methodParameter.getMethod() != null) {
      this.methodName=methodParameter.getMethod().getName();
      this.parameterTypes=methodParameter.getMethod().getParameterTypes();
    }
 else {
      this.methodName=null;
      this.parameterTypes=methodParameter.getConstructor().getParameterTypes();
    }
    this.declaringClass=methodParameter.getDeclaringClass();
    this.parameterIndex=methodParameter.getParameterIndex();
    this.methodParameter=methodParameter;
  }
  @Override public Type getType(){
    return this.methodParameter.getGenericParameterType();
  }
  @Override public Object getSource(){
    return this.methodParameter;
  }
  private void readObject(  ObjectInputStream inputStream) throws IOException, ClassNotFoundException {
    inputStream.defaultReadObject();
    try {
      if (this.methodName != null) {
        this.methodParameter=new MethodParameter(this.declaringClass.getDeclaredMethod(this.methodName,this.parameterTypes),this.parameterIndex);
      }
 else {
        this.methodParameter=new MethodParameter(this.declaringClass.getDeclaredConstructor(this.parameterTypes),this.parameterIndex);
      }
    }
 catch (    Throwable ex) {
      throw new IllegalStateException("Could not find original class structure",ex);
    }
  }
}
