/** 
 * Parses an <b>item</b> element as is defined in both the  {@link PubSubNamespace#basic} and{@link PubSubNamespace#event} namespaces. To parse the item contents, it will use whatever{@link ExtensionElementProvider} is registered in <b>smack.providers</b> for its element name and namespace. If noprovider is registered, it will return a  {@link SimplePayload}.
 * @author Robin Collier
 */
public class ItemProvider extends ExtensionElementProvider<Item> {
  @Override public Item parse(  XmlPullParser parser,  int initialDepth,  XmlEnvironment xmlEnvironment) throws XmlPullParserException, IOException, SmackParsingException {
    String id=parser.getAttributeValue(null,"id");
    String node=parser.getAttributeValue(null,"node");
    String xmlns=parser.getNamespace();
    ItemNamespace itemNamespace=ItemNamespace.fromXmlns(xmlns);
    XmlPullParser.TagEvent event=parser.nextTag();
switch (event) {
case START_ELEMENT:
      String payloadElemName=parser.getName();
    String payloadNS=parser.getNamespace();
  final ExtensionElementProvider<ExtensionElement> extensionProvider=ProviderManager.getExtensionProvider(payloadElemName,payloadNS);
if (extensionProvider == null) {
  CharSequence payloadText=PacketParserUtils.parseElement(parser,true);
  return new PayloadItem<>(itemNamespace,id,node,new SimplePayload(payloadText.toString()));
}
 else {
  return new PayloadItem<>(itemNamespace,id,node,extensionProvider.parse(parser));
}
case END_ELEMENT:
return new Item(itemNamespace,id,node);
default :
throw new AssertionError("unknown: " + event);
}
}
}
