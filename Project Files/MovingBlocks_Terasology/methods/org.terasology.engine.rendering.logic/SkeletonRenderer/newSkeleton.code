@ReceiveEvent(components={SkeletalMeshComponent.class,LocationComponent.class}) public void newSkeleton(OnActivatedComponent event,EntityRef entity){
  SkeletalMeshComponent skeleton=entity.getComponent(SkeletalMeshComponent.class);
  if (skeleton.mesh == null) {
    return;
  }
  if (skeleton.boneEntities == null) {
    skeleton.boneEntities=Maps.newHashMap();
    for (    Bone bone : skeleton.mesh.getBones()) {
      LocationComponent loc=new LocationComponent();
      EntityRef boneEntity=entityManager.create(loc);
      skeleton.boneEntities.put(bone.getName(),boneEntity);
    }
  }
  for (  Bone bone : skeleton.mesh.getBones()) {
    EntityRef boneEntity=skeleton.boneEntities.get(bone.getName());
    EntityRef parent=(bone.getParent() != null) ? skeleton.boneEntities.get(bone.getParent().getName()) : entity;
    Location.attachChild(parent,boneEntity);
  }
  for (  Bone bone : skeleton.mesh.getBones()) {
    EntityRef boneEntity=skeleton.boneEntities.get(bone.getName());
    LocationComponent loc=boneEntity.getComponent(LocationComponent.class);
    loc.setLocalPosition(bone.getLocalPosition());
    loc.setLocalRotation(bone.getLocalRotation());
    loc.setLocalScale(bone.getLocalScale().x);
    boneEntity.saveComponent(loc);
    if (bone.getParent() == null) {
      skeleton.rootBone=boneEntity;
    }
  }
  entity.saveComponent(skeleton);
}
