/** 
 * @param node A node in an asset tree.
 * @param nuiManager The {@link NUIManager} to be used for widget type resolution.
 * @return The info about this node's type.
 */
public static NodeInfo getNodeInfo(JsonTree node,NUIManager nuiManager){
  Deque<JsonTree> pathToRoot=getPathToRoot(node);
  Class<?> currentClass=null;
  Class<?> activeLayoutClass=null;
  Function<String,Class<? extends UIWidget>> resolve=(  String type) -> verifyNotNull(nuiManager.getWidgetMetadataLibrary().resolve(type,ModuleContext.getContext()),"Failed to resolve widget %s in %s",type,ModuleContext.getContext()).getType();
  for (  JsonTree n : pathToRoot) {
    if (n.isRoot()) {
      String type=(String)n.getChildWithKey("type").getValue().getValue();
      currentClass=resolve.apply(type);
    }
 else {
      if (List.class.isAssignableFrom(currentClass) && n.getValue().getKey() == null && "contents".equals(n.getParent().getValue().getKey())) {
        currentClass=UIWidget.class;
      }
 else {
        if (currentClass == UIWidget.class && n.hasSiblingWithKey("type")) {
          String type=(String)n.getSiblingWithKey("type").getValue().getValue();
          currentClass=resolve.apply(type);
        }
        Class<?> layoutClass=null;
        if (UILayout.class.isAssignableFrom(currentClass)) {
          layoutClass=currentClass;
        }
        if (UILayout.class.isAssignableFrom(currentClass) && "contents".equals(n.getValue().getKey())) {
          currentClass=List.class;
        }
 else         if (UIWidget.class.isAssignableFrom(currentClass) && "layoutInfo".equals(n.getValue().getKey())) {
          currentClass=(Class<?>)ReflectionUtil.getTypeParameter(activeLayoutClass.getGenericSuperclass(),0);
        }
 else {
          String value=n.getValue().toString();
          Set<Field> fields=ReflectionUtils.getAllFields(currentClass);
          Optional<Field> newField=fields.stream().filter(f -> f.getName().equalsIgnoreCase(value)).findFirst();
          if (newField.isPresent()) {
            currentClass=newField.get().getType();
          }
 else {
            Optional<Field> serializedNameField=fields.stream().filter(f -> f.isAnnotationPresent(SerializedName.class) && f.getAnnotation(SerializedName.class).value().equals(value)).findFirst();
            if (serializedNameField.isPresent()) {
              currentClass=serializedNameField.get().getType();
            }
 else {
              return null;
            }
          }
        }
        if (layoutClass != null) {
          activeLayoutClass=layoutClass;
        }
      }
    }
  }
  if (currentClass == UIWidget.class && node.hasChildWithKey("type")) {
    String type=(String)node.getChildWithKey("type").getValue().getValue();
    currentClass=resolve.apply(type);
  }
  return new NodeInfo(currentClass,activeLayoutClass);
}
