/** 
 * <pre> From server to client, in response to prepared statement initialization packet.  It is made up of:  1.a PREPARE_OK packet 2.if "number of parameters" > 0  (field packets) as in a Result Set Header Packet  (EOF packet) 3.if "number of columns" > 0  (field packets) as in a Result Set Header Packet  (EOF packet) ----------------------------------------------------------------------------------------- Bytes              Name -----              ---- 1                  0 - marker for OK packet 4                  statement_handler_id 2                  number of columns in result set 2                  number of parameters in query 1                  filler (always 0) 2                  warning count
 * @see http://dev.mysql.com/doc/internals/en/prepared-statement-initialization-packet.html</pre>
 * @author mycat
 */
public class PreparedOkPacket extends MySQLPacket {
  public static int PACKET_SIZE=12;
  public byte flag;
  public long statementId;
  public int columnsNumber;
  public int parametersNumber;
  public byte filler;
  public int warningCount;
  public PreparedOkPacket(){
    this.flag=0;
    this.filler=0;
  }
  public void read(  byte[] data){
    MySQLMessage mm=new MySQLMessage(data);
    packetLength=mm.readUB3();
    packetId=mm.read();
    flag=mm.read();
    statementId=mm.readUB4();
    columnsNumber=mm.readUB2();
    parametersNumber=mm.readUB2();
    warningCount=mm.read();
  }
  @Override public ByteBuffer write(  ByteBuffer buffer,  FrontendConnection c,  boolean writeSocketIfFull){
    int size=calcPacketSize();
    buffer=c.checkWriteBuffer(buffer,c.getPacketHeaderSize() + size,writeSocketIfFull);
    BufferUtil.writeUB3(buffer,size);
    buffer.put(packetId);
    buffer.put(flag);
    BufferUtil.writeUB4(buffer,statementId);
    BufferUtil.writeUB2(buffer,columnsNumber);
    BufferUtil.writeUB2(buffer,parametersNumber);
    buffer.put(filler);
    BufferUtil.writeUB2(buffer,warningCount);
    return buffer;
  }
  @Override public int calcPacketSize(){
    return PACKET_SIZE;
  }
  @Override protected String getPacketInfo(){
    return "MySQL PreparedOk Packet";
  }
}
