/** 
 * 防火墙白名单处理，根据防火墙配置，判断目前主机是否可以通过某用户登陆 白名单配置请参考：
 * @see XMLServerLoader
 * @see FirewallConfig
 * @modification 修改增加网段白名单识别配置
 * @date 2016/12/8
 * @modifiedBy Hash Zhang
 */
@Override public boolean checkFirewallWhiteHostPolicy(String user,String host){
  MycatConfig mycatConfig=MycatServer.getInstance().getConfig();
  FirewallConfig firewallConfig=mycatConfig.getFirewall();
  boolean isPassed=false;
  Map<String,List<UserConfig>> whitehost=firewallConfig.getWhitehost();
  Map<Pattern,List<UserConfig>> whitehostMask=firewallConfig.getWhitehostMask();
  if ((whitehost == null || whitehost.size() == 0) && (whitehostMask == null || whitehostMask.size() == 0)) {
    Map<String,UserConfig> users=mycatConfig.getUsers();
    isPassed=users.containsKey(user);
  }
 else {
    List<UserConfig> list=whitehost.get(host);
    Set<Pattern> patterns=whitehostMask.keySet();
    if (patterns != null && patterns.size() > 0) {
      for (      Pattern pattern : patterns) {
        if (pattern.matcher(host).find()) {
          isPassed=true;
          break;
        }
      }
    }
    if (list != null) {
      for (      UserConfig userConfig : list) {
        if (userConfig.getName().equals(user)) {
          isPassed=true;
          break;
        }
      }
    }
  }
  if (!isPassed) {
    ALARM.error(new StringBuilder().append(Alarms.FIREWALL_ATTACK).append("[host=").append(host).append(",user=").append(user).append(']').toString());
    return false;
  }
  return true;
}
