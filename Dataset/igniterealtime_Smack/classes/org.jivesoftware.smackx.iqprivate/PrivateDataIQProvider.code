/** 
 * An IQ provider to parse IQ results containing private data.
 */
public static class PrivateDataIQProvider extends IqProvider<PrivateDataIQ> {
  @Override public PrivateDataIQ parse(  XmlPullParser parser,  int initialDepth,  IqData iqData,  XmlEnvironment xmlEnvironment) throws XmlPullParserException, IOException {
    PrivateData privateData=null;
    boolean done=false;
    while (!done) {
      XmlPullParser.Event eventType=parser.next();
      if (eventType == XmlPullParser.Event.START_ELEMENT) {
        String elementName=parser.getName();
        String namespace=parser.getNamespace();
        PrivateDataProvider provider=getPrivateDataProvider(elementName,namespace);
        if (provider != null) {
          privateData=provider.parsePrivateData(parser);
        }
 else {
          DefaultPrivateData data=new DefaultPrivateData(elementName,namespace);
          boolean finished=false;
          while (!finished) {
            XmlPullParser.Event event=parser.next();
            if (event == XmlPullParser.Event.START_ELEMENT) {
              String name=parser.getName();
              event=parser.next();
              if (event == XmlPullParser.Event.TEXT_CHARACTERS) {
                String value=parser.getText();
                data.setValue(name,value);
              }
 else               if (event == XmlPullParser.Event.END_ELEMENT) {
                data.setValue(name,"");
              }
            }
 else             if (event == XmlPullParser.Event.END_ELEMENT) {
              if (parser.getName().equals(elementName)) {
                finished=true;
              }
            }
          }
          privateData=data;
        }
      }
 else       if (eventType == XmlPullParser.Event.END_ELEMENT) {
        if (parser.getName().equals("query")) {
          done=true;
        }
      }
    }
    return new PrivateDataIQ(privateData);
  }
}
