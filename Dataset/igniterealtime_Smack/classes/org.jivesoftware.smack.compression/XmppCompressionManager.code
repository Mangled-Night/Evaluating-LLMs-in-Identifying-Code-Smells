public class XmppCompressionManager {
  private static final List<XmppCompressionFactory> xmppCompressionFactories=new ArrayList<>(4);
  public static XmppCompressionFactory registerXmppCompressionFactory(  XmppCompressionFactory xmppCompressionFactory){
    final String method=xmppCompressionFactory.getCompressionMethod();
    XmppCompressionFactory previousFactory=null;
synchronized (xmppCompressionFactories) {
      for (Iterator<XmppCompressionFactory> it=xmppCompressionFactories.iterator(); it.hasNext(); ) {
        XmppCompressionFactory factory=it.next();
        if (factory.getCompressionMethod().equals(method)) {
          it.remove();
          previousFactory=factory;
          break;
        }
      }
      xmppCompressionFactories.add(xmppCompressionFactory);
      Collections.sort(xmppCompressionFactories);
    }
    return previousFactory;
  }
  public static XmppCompressionFactory getBestFactory(  Compress.Feature compressFeature){
    List<String> announcedMethods=compressFeature.getMethods();
synchronized (xmppCompressionFactories) {
      for (      XmppCompressionFactory factory : xmppCompressionFactories) {
        if (announcedMethods.contains(factory.getCompressionMethod())) {
          return factory;
        }
      }
    }
    return null;
  }
}
