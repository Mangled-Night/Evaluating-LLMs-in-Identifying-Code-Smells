/** 
 * Return the ip address. <p>Must hold  {@code <uses-permission android:name="android.permission.INTERNET" />}</p>
 * @param useIPv4 True to use ipv4, false otherwise.
 * @return the ip address
 */
@RequiresPermission(INTERNET) public static String getIPAddress(final boolean useIPv4){
  try {
    Enumeration<NetworkInterface> nis=NetworkInterface.getNetworkInterfaces();
    LinkedList<InetAddress> adds=new LinkedList<>();
    while (nis.hasMoreElements()) {
      NetworkInterface ni=nis.nextElement();
      if (!ni.isUp() || ni.isLoopback())       continue;
      Enumeration<InetAddress> addresses=ni.getInetAddresses();
      while (addresses.hasMoreElements()) {
        adds.addFirst(addresses.nextElement());
      }
    }
    for (    InetAddress add : adds) {
      if (!add.isLoopbackAddress()) {
        String hostAddress=add.getHostAddress();
        boolean isIPv4=hostAddress.indexOf(':') < 0;
        if (useIPv4) {
          if (isIPv4)           return hostAddress;
        }
 else {
          if (!isIPv4) {
            int index=hostAddress.indexOf('%');
            return index < 0 ? hostAddress.toUpperCase() : hostAddress.substring(0,index).toUpperCase();
          }
        }
      }
    }
  }
 catch (  SocketException e) {
    e.printStackTrace();
  }
  return "";
}
