/** 
 * Asserts that a user who is present when another user gets kicked receives that change as a presence update <p>From XEP-0045 ยง 8.2:</p> <blockquote> ...the service MUST then inform all of the remaining occupants that the kicked occupant is no longer in the room by sending presence stanzas of type "unavailable" from the individual's roomnick (&lt;room@service/nick&gt;) to all the remaining occupants (just as it does when occupants exit the room of their own volition), including the status code and optionally the reason and actor. </blockquote>
 * @throws Exception when errors occur
 */
@SmackIntegrationTest public void mucPresenceTestForWitnessingKick() throws Exception {
  EntityBareJid mucAddress=getRandomRoom("smack-inttest");
  MultiUserChat mucAsSeenByOne=mucManagerOne.getMultiUserChat(mucAddress);
  MultiUserChat mucAsSeenByTwo=mucManagerTwo.getMultiUserChat(mucAddress);
  MultiUserChat mucAsSeenByThree=mucManagerThree.getMultiUserChat(mucAddress);
  createMuc(mucAsSeenByOne,"one-" + randomString);
  try {
    final Resourcepart nicknameTwo=Resourcepart.from("two-" + randomString);
    final Resourcepart nicknameThree=Resourcepart.from("three-" + randomString);
    mucAsSeenByTwo.join(nicknameTwo);
    mucAsSeenByThree.join(nicknameThree);
    final ResultSyncPoint<Presence,Exception> resultSyncPoint=new ResultSyncPoint<>();
    mucAsSeenByThree.addParticipantListener(kickPresence -> resultSyncPoint.signal(kickPresence));
    mucAsSeenByOne.kickParticipant(nicknameTwo,"Nothing personal. Just a test.");
    Presence kickPresence=resultSyncPoint.waitForResult(timeout);
    MUCUser mucUser=MUCUser.from(kickPresence);
    assertNotNull(mucUser);
    assertAll(() -> assertFalse(mucUser.getStatus().contains(MUCUser.Status.PRESENCE_TO_SELF_110),"Incorrect self-presence status code in kick presence"),() -> assertTrue(mucUser.getStatus().contains(MUCUser.Status.KICKED_307),"Missing kick status code in kick presence"),() -> assertEquals(MUCRole.none,mucUser.getItem().getRole(),"Role other than 'none' in kick presence"));
    Jid itemJid=mucUser.getItem().getJid();
    if (itemJid != null) {
      assertEquals(conTwo.getUser().asEntityFullJidIfPossible(),itemJid,"Incorrect kicked user in kick presence");
    }
  }
  finally {
    tryDestroy(mucAsSeenByOne);
  }
}
