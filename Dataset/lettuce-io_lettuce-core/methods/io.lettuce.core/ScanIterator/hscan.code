/** 
 * Sequentially iterate over entries in a hash identified by  {@code key}. This method uses  {@code HSCAN} to perform aniterative scan.
 * @param commands the commands interface, must not be {@code null}.
 * @param key the hash to scan.
 * @param < K > Key type.
 * @param < V > Value type.
 * @return a new {@link ScanIterator}.
 */
public static <K,V>ScanIterator<KeyValue<K,V>> hscan(RedisHashCommands<K,V> commands,K key){
  return hscan(commands,key,Optional.empty());
}
/** 
 * Sequentially iterate over entries in a hash identified by  {@code key}. This method uses  {@code HSCAN} to perform aniterative scan.
 * @param commands the commands interface, must not be {@code null}.
 * @param key the hash to scan.
 * @param scanArgs the scan arguments, must not be {@code null}.
 * @param < K > Key type.
 * @param < V > Value type.
 * @return a new {@link ScanIterator}.
 */
public static <K,V>ScanIterator<KeyValue<K,V>> hscan(RedisHashCommands<K,V> commands,K key,ScanArgs scanArgs){
  LettuceAssert.notNull(scanArgs,"ScanArgs must not be null");
  return hscan(commands,key,Optional.of(scanArgs));
}
private static <K,V>ScanIterator<KeyValue<K,V>> hscan(RedisHashCommands<K,V> commands,K key,Optional<ScanArgs> scanArgs){
  LettuceAssert.notNull(commands,"RedisKeyCommands must not be null");
  LettuceAssert.notNull(key,"Key must not be null");
  return new SyncScanIterator<KeyValue<K,V>>(){
    @Override protected ScanCursor nextScanCursor(    ScanCursor scanCursor){
      MapScanCursor<K,V> cursor=getNextScanCursor(scanCursor);
      chunk=cursor.getMap().keySet().stream().map(k -> KeyValue.fromNullable(k,cursor.getMap().get(k))).iterator();
      return cursor;
    }
    private MapScanCursor<K,V> getNextScanCursor(    ScanCursor scanCursor){
      if (scanCursor == null) {
        return scanArgs.map(scanArgs -> commands.hscan(key,scanArgs)).orElseGet(() -> commands.hscan(key));
      }
      return scanArgs.map((scanArgs) -> commands.hscan(key,scanCursor,scanArgs)).orElseGet(() -> commands.hscan(key,scanCursor));
    }
  }
;
}
