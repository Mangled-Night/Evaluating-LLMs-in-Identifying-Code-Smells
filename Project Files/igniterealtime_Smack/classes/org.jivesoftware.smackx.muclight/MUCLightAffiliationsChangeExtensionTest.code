public class MUCLightAffiliationsChangeExtensionTest {
  private static final String exampleMessageStanza="<message xmlns='jabber:client' to='coven@muclight.shakespeare.lit' id='member1' type='groupchat'>" + "<x xmlns='urn:xmpp:muclight:0#affiliations'>" + "<user affiliation='owner'>sarasa2@shakespeare.lit</user>"+ "<user affiliation='member'>sarasa1@shakespeare.lit</user>"+ "<user affiliation='none'>sarasa3@shakespeare.lit</user>"+ "</x>"+ "</message>";
  private static final String exampleMessageStanzaWithVersion="<message xmlns='jabber:client' " + "to='coven@muclight.shakespeare.lit' id='member1' type='groupchat'>" + "<x xmlns='urn:xmpp:muclight:0#affiliations'>"+ "<version>qwerty</version>"+ "<user affiliation='member'>sarasa1@shakespeare.lit</user>"+ "<user affiliation='none'>sarasa3@shakespeare.lit</user>"+ "</x>"+ "<body></body>"+ "</message>";
  private static final String exampleMessageStanzaWithPrevVersion="<message xmlns='jabber:client' " + "to='coven@muclight.shakespeare.lit' id='member1' type='groupchat'>" + "<x xmlns='urn:xmpp:muclight:0#affiliations'>"+ "<prev-version>njiokm</prev-version>"+ "<version>qwerty</version>"+ "<user affiliation='owner'>sarasa2@shakespeare.lit</user>"+ "<user affiliation='member'>sarasa1@shakespeare.lit</user>"+ "</x>"+ "<body></body>"+ "</message>";
  @Test public void checkAffiliationsChangeExtension() throws Exception {
    Message changeAffiliationsMessage=PacketParserUtils.parseStanza(exampleMessageStanza);
    AffiliationsChangeExtension affiliationsChangeExtension=AffiliationsChangeExtension.from(changeAffiliationsMessage);
    HashMap<Jid,MUCLightAffiliation> affiliations=affiliationsChangeExtension.getAffiliations();
    assertEquals(affiliations.size(),3);
    assertEquals(affiliations.get(JidCreate.from("sarasa2@shakespeare.lit")),MUCLightAffiliation.owner);
    assertEquals(affiliations.get(JidCreate.from("sarasa1@shakespeare.lit")),MUCLightAffiliation.member);
    assertEquals(affiliations.get(JidCreate.from("sarasa3@shakespeare.lit")),MUCLightAffiliation.none);
  }
  @Test public void checkAffiliationsChangeExtensionWithVersion() throws Exception {
    Message changeAffiliationsMessage=PacketParserUtils.parseStanza(exampleMessageStanzaWithVersion);
    AffiliationsChangeExtension affiliationsChangeExtension=AffiliationsChangeExtension.from(changeAffiliationsMessage);
    HashMap<Jid,MUCLightAffiliation> affiliations=affiliationsChangeExtension.getAffiliations();
    assertEquals(affiliations.size(),2);
    assertEquals(affiliations.get(JidCreate.from("sarasa1@shakespeare.lit")),MUCLightAffiliation.member);
    assertEquals(affiliations.get(JidCreate.from("sarasa3@shakespeare.lit")),MUCLightAffiliation.none);
    assertEquals(affiliationsChangeExtension.getVersion(),"qwerty");
  }
  @Test public void checkAffiliationsChangeExtensionWithPrevVersion() throws Exception {
    Message changeAffiliationsMessage=PacketParserUtils.parseStanza(exampleMessageStanzaWithPrevVersion);
    AffiliationsChangeExtension affiliationsChangeExtension=AffiliationsChangeExtension.from(changeAffiliationsMessage);
    HashMap<Jid,MUCLightAffiliation> affiliations=affiliationsChangeExtension.getAffiliations();
    assertEquals(affiliations.size(),2);
    assertEquals(affiliations.get(JidCreate.from("sarasa2@shakespeare.lit")),MUCLightAffiliation.owner);
    assertEquals(affiliations.get(JidCreate.from("sarasa1@shakespeare.lit")),MUCLightAffiliation.member);
    assertEquals(affiliationsChangeExtension.getPrevVersion(),"njiokm");
    assertEquals(affiliationsChangeExtension.getVersion(),"qwerty");
  }
}
