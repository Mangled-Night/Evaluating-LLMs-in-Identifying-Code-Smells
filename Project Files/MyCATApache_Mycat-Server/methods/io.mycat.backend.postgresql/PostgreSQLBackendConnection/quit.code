@Override public void quit(){
  if (isQuit.compareAndSet(false,true) && !isClosed()) {
    if (state == BackendConnectionState.connected) {
      Terminate terminate=new Terminate();
      ByteBuffer buf=this.allocate();
      terminate.write(buf);
      write(buf);
    }
 else {
      close("normal");
    }
  }
}
