public void testVoice(){
  final String[] answer=new String[4];
  try {
    makeRoomModerated();
    MultiUserChat muc2=new MultiUserChat(getConnection(1),room);
    muc2.join("testbot2");
    muc2.addUserStatusListener(new DefaultUserStatusListener(){
      public void voiceGranted(){
        super.voiceGranted();
        answer[0]="canSpeak";
      }
      public void voiceRevoked(){
        super.voiceRevoked();
        answer[1]="cannot speak";
      }
    }
);
    MultiUserChat muc3=new MultiUserChat(getConnection(2),room);
    muc3.join("testbot3");
    muc3.addParticipantStatusListener(new DefaultParticipantStatusListener(){
      public void voiceGranted(      String participant){
        super.voiceGranted(participant);
        answer[2]=participant;
      }
      public void voiceRevoked(      String participant){
        super.voiceRevoked(participant);
        answer[3]=participant;
      }
    }
);
    try {
      muc2.grantVoice("testbot3");
      fail("User2 was able to grant voice");
    }
 catch (    XMPPException e) {
      XMPPError xmppError=e.getStanzaError();
      assertNotNull("No XMPPError was received granting voice",xmppError);
      assertEquals("A visitor was able to grant voice to another visitor",403,xmppError.getCode());
    }
    muc.grantVoice("testbot2");
    Thread.sleep(300);
    assertEquals("User2 didn't receive the grant voice notification","canSpeak",answer[0]);
    assertEquals("User3 didn't receive user2's grant voice notification",room + "/testbot2",answer[2]);
    muc.revokeVoice("testbot2");
    Thread.sleep(300);
    assertEquals("User2 didn't receive the revoke voice notification","cannot speak",answer[1]);
    assertEquals("User3 didn't receive user2's revoke voice notification",room + "/testbot2",answer[3]);
    muc2.leave();
    muc3.leave();
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail(e.getMessage());
  }
}
