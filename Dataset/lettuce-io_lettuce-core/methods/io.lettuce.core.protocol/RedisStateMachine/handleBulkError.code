static State.Result handleBulkError(RedisStateMachine rsm,State state,ByteBuf buffer,CommandOutput<?,?,?> output,Consumer<Exception> errorHandler){
  int length;
  int end;
  if ((end=rsm.findLineEnd(buffer)) == NOT_FOUND) {
    return State.Result.BREAK_LOOP;
  }
  length=(int)rsm.readLong(buffer,buffer.readerIndex(),end);
  if (length == NOT_FOUND) {
    rsm.safeSetError(output,null,errorHandler);
  }
 else {
    state.type=BYTES;
    state.count=length + TERMINATOR_LENGTH;
    buffer.markReaderIndex();
    return State.Result.CONTINUE_LOOP;
  }
  return State.Result.NORMAL_END;
}
