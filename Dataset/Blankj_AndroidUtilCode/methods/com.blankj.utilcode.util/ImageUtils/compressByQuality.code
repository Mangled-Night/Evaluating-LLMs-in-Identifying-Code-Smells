/** 
 * Return the compressed data using quality.
 * @param src     The source of bitmap.
 * @param quality The quality.
 * @return the compressed data using quality
 */
public static byte[] compressByQuality(final Bitmap src,@IntRange(from=0,to=100) final int quality){
  return compressByQuality(src,quality,false);
}
/** 
 * Return the compressed data using quality.
 * @param src     The source of bitmap.
 * @param quality The quality.
 * @param recycle True to recycle the source of bitmap, false otherwise.
 * @return the compressed data using quality
 */
public static byte[] compressByQuality(final Bitmap src,@IntRange(from=0,to=100) final int quality,final boolean recycle){
  if (isEmptyBitmap(src))   return null;
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  src.compress(Bitmap.CompressFormat.JPEG,quality,baos);
  byte[] bytes=baos.toByteArray();
  if (recycle && !src.isRecycled())   src.recycle();
  return bytes;
}
/** 
 * Return the compressed data using quality.
 * @param src         The source of bitmap.
 * @param maxByteSize The maximum size of byte.
 * @return the compressed data using quality
 */
public static byte[] compressByQuality(final Bitmap src,final long maxByteSize){
  return compressByQuality(src,maxByteSize,false);
}
/** 
 * Return the compressed data using quality.
 * @param src         The source of bitmap.
 * @param maxByteSize The maximum size of byte.
 * @param recycle     True to recycle the source of bitmap, false otherwise.
 * @return the compressed data using quality
 */
public static byte[] compressByQuality(final Bitmap src,final long maxByteSize,final boolean recycle){
  if (isEmptyBitmap(src) || maxByteSize <= 0)   return new byte[0];
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  src.compress(CompressFormat.JPEG,100,baos);
  byte[] bytes;
  if (baos.size() <= maxByteSize) {
    bytes=baos.toByteArray();
  }
 else {
    baos.reset();
    src.compress(CompressFormat.JPEG,0,baos);
    if (baos.size() >= maxByteSize) {
      bytes=baos.toByteArray();
    }
 else {
      int st=0;
      int end=100;
      int mid=0;
      while (st < end) {
        mid=(st + end) / 2;
        baos.reset();
        src.compress(CompressFormat.JPEG,mid,baos);
        int len=baos.size();
        if (len == maxByteSize) {
          break;
        }
 else         if (len > maxByteSize) {
          end=mid - 1;
        }
 else {
          st=mid + 1;
        }
      }
      if (end == mid - 1) {
        baos.reset();
        src.compress(CompressFormat.JPEG,st,baos);
      }
      bytes=baos.toByteArray();
    }
  }
  if (recycle && !src.isRecycled())   src.recycle();
  return bytes;
}
