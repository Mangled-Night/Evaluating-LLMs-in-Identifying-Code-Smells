@BeforeEach void before(){
  io.netty.util.Timer timer=mock(io.netty.util.Timer.class);
  when(timer.newTimeout(any(),anyLong(),any())).thenReturn(mock(Timeout.class));
  when(clientResources.timer()).thenReturn(timer);
  when(clientResources.socketAddressResolver()).thenReturn(SocketAddressResolver.create(DnsResolver.unresolved()));
  when(clientResources.eventExecutorGroup()).thenReturn(eventExecutors);
  doAnswer(invocation -> {
    ((Runnable)invocation.getArgument(0)).run();
    return null;
  }
).when(eventExecutors).execute(any(Runnable.class));
  when(connection1.async()).thenReturn(asyncCommands1);
  when(connection2.async()).thenReturn(asyncCommands2);
  when(connection1.closeAsync()).thenReturn(CompletableFuture.completedFuture(null));
  when(connection2.closeAsync()).thenReturn(CompletableFuture.completedFuture(null));
  when(connection1.dispatch(any(RedisCommand.class))).thenAnswer(invocation -> {
    TimedAsyncCommand command=(TimedAsyncCommand)invocation.getArguments()[0];
    if (command.getType() == CommandType.CLUSTER) {
      command.getOutput().set(ByteBuffer.wrap(NODE_1_VIEW.getBytes()));
      command.complete();
    }
    if (command.getType() == CommandType.CLIENT) {
      command.getOutput().set(ByteBuffer.wrap("c1\nc2\n".getBytes()));
      command.complete();
    }
    if (command.getType() == CommandType.INFO) {
      command.getOutput().set(ByteBuffer.wrap("# Clients\nconnected_clients:2\nclient_longest_output_list:0\nclient_biggest_input_buf:0\nblocked_clients:0".getBytes()));
      command.complete();
    }
    command.encodedAtNs=10;
    command.completedAtNs=50;
    return command;
  }
);
  when(connection2.dispatch(any(RedisCommand.class))).thenAnswer(invocation -> {
    TimedAsyncCommand command=(TimedAsyncCommand)invocation.getArguments()[0];
    if (command.getType() == CommandType.CLUSTER) {
      command.getOutput().set(ByteBuffer.wrap(NODE_2_VIEW.getBytes()));
      command.complete();
    }
    if (command.getType() == CommandType.CLIENT) {
      command.getOutput().set(ByteBuffer.wrap("".getBytes()));
      command.complete();
    }
    if (command.getType() == CommandType.INFO) {
      command.getOutput().set(ByteBuffer.wrap("# Clients\nconnected_clients:2\nclient_longest_output_list:0\nclient_biggest_input_buf:0\nblocked_clients:0".getBytes()));
      command.complete();
    }
    command.encodedAtNs=10;
    command.completedAtNs=20;
    return command;
  }
);
  sut=new DefaultClusterTopologyRefresh(nodeConnectionFactory,clientResources);
}
