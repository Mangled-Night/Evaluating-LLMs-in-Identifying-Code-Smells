private String createProcessor(){
  if (locator == null)   return "Locator is null";
  DataSource ds;
  try {
    ds=javax.media.Manager.createDataSource(locator);
  }
 catch (  Exception e) {
    try {
      ds=javax.media.Manager.createDataSource(new MediaLocator("javasound://"));
    }
 catch (    Exception ee) {
      return "Couldn't create DataSource";
    }
  }
  try {
    processor=javax.media.Manager.createProcessor(ds);
  }
 catch (  NoProcessorException npe) {
    LOGGER.log(Level.WARNING,"exception",npe);
    return "Couldn't create processor";
  }
catch (  IOException ioe) {
    LOGGER.log(Level.WARNING,"exception",ioe);
    return "IOException creating processor";
  }
  boolean result=waitForState(processor,Processor.Configured);
  if (!result) {
    return "Couldn't configure processor";
  }
  TrackControl[] tracks=processor.getTrackControls();
  if (tracks == null || tracks.length < 1) {
    return "Couldn't find tracks in processor";
  }
  ContentDescriptor cd=new ContentDescriptor(ContentDescriptor.RAW_RTP);
  processor.setContentDescriptor(cd);
  Format[] supported;
  Format chosen=null;
  boolean atLeastOneTrack=false;
  for (int i=0; i < tracks.length; i++) {
    if (tracks[i].isEnabled()) {
      supported=tracks[i].getSupportedFormats();
      if (supported.length > 0) {
        for (        Format format : supported) {
          if (format instanceof AudioFormat) {
            if (this.format.matches(format))             chosen=format;
          }
        }
        if (chosen != null) {
          tracks[i].setFormat(chosen);
          LOGGER.severe("Track " + i + " is set to transmit as: "+ chosen);
          if (tracks[i].getFormat() instanceof AudioFormat) {
            int packetRate=20;
            PacketSizeControl pktCtrl=(PacketSizeControl)processor.getControl(PacketSizeControl.class.getName());
            if (pktCtrl != null) {
              try {
                pktCtrl.setPacketSize(getPacketSize(tracks[i].getFormat(),packetRate));
              }
 catch (              IllegalArgumentException e) {
                pktCtrl.setPacketSize(80);
              }
            }
            if (tracks[i].getFormat().getEncoding().equals(AudioFormat.ULAW_RTP)) {
              Codec[] codec=new Codec[3];
              codec[0]=new com.ibm.media.codec.audio.rc.RCModule();
              codec[1]=new com.ibm.media.codec.audio.ulaw.JavaEncoder();
              codec[2]=new com.sun.media.codec.audio.ulaw.Packetizer();
              ((com.sun.media.codec.audio.ulaw.Packetizer)codec[2]).setPacketSize(160);
              try {
                tracks[i].setCodecChain(codec);
              }
 catch (              UnsupportedPlugInException e) {
                LOGGER.log(Level.WARNING,"exception",e);
              }
            }
          }
          atLeastOneTrack=true;
        }
 else         tracks[i].setEnabled(false);
      }
 else       tracks[i].setEnabled(false);
    }
  }
  if (!atLeastOneTrack)   return "Couldn't set any of the tracks to a valid RTP format";
  result=waitForState(processor,Controller.Realized);
  if (!result)   return "Couldn't realize processor";
  dataOutput=processor.getDataOutput();
  return null;
}
