@SuppressWarnings("unchecked") private void handleOutput(ByteBuffer bytes){
switch (type) {
case pmessage:
    if (pattern == null) {
      pattern=codec.decodeKey(bytes);
      break;
    }
case message:
  if (channel == null) {
    channel=codec.decodeKey(bytes);
    break;
  }
output=codec.decodeValue(bytes);
completed=true;
break;
case psubscribe:
case punsubscribe:
pattern=codec.decodeKey(bytes);
break;
case subscribe:
case unsubscribe:
channel=codec.decodeKey(bytes);
break;
default :
throw new UnsupportedOperationException("Operation " + type + " not supported");
}
}
