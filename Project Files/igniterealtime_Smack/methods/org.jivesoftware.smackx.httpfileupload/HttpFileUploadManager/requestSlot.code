/** 
 * Request a new upload slot from default upload service (if discovered). When you get slot you should upload file to PUT URL and share GET URL. Note that this is a synchronous call -- Smack must wait for the server response.
 * @param filename name of file to be uploaded
 * @param fileSize file size in bytes.
 * @return file upload Slot in case of success
 * @throws IllegalArgumentException if fileSize is less than or equal to zero or greater than the maximum sizesupported by the service.
 * @throws InterruptedException if the calling thread was interrupted.
 * @throws XMPPException.XMPPErrorException if there was an XMPP error returned.
 * @throws SmackException if smack exception.
 */
public Slot requestSlot(String filename,long fileSize) throws InterruptedException, XMPPException.XMPPErrorException, SmackException {
  return requestSlot(filename,fileSize,null,null);
}
/** 
 * Request a new upload slot with optional content type from default upload service (if discovered). When you get slot you should upload file to PUT URL and share GET URL. Note that this is a synchronous call -- Smack must wait for the server response.
 * @param filename name of file to be uploaded
 * @param fileSize file size in bytes.
 * @param contentType file content-type or null
 * @return file upload Slot in case of success
 * @throws IllegalArgumentException if fileSize is less than or equal to zero or greater than the maximum sizesupported by the service.
 * @throws SmackException.NotConnectedException if the XMPP connection is not connected.
 * @throws InterruptedException if the calling thread was interrupted.
 * @throws XMPPException.XMPPErrorException if there was an XMPP error returned.
 * @throws SmackException if smack exception.
 */
public Slot requestSlot(String filename,long fileSize,String contentType) throws SmackException, InterruptedException, XMPPException.XMPPErrorException {
  return requestSlot(filename,fileSize,contentType,null);
}
/** 
 * Request a new upload slot with optional content type from custom upload service. When you get slot you should upload file to PUT URL and share GET URL. Note that this is a synchronous call -- Smack must wait for the server response.
 * @param filename name of file to be uploaded
 * @param fileSize file size in bytes.
 * @param contentType file content-type or null
 * @param uploadServiceAddress the address of the upload service to use or null for default one
 * @return file upload Slot in case of success
 * @throws IllegalArgumentException if fileSize is less than or equal to zero or greater than the maximum sizesupported by the service.
 * @throws SmackException if Smack detected an exceptional situation.
 * @throws InterruptedException if the calling thread was interrupted.
 * @throws XMPPException.XMPPErrorException if there was an XMPP error returned.
 */
public Slot requestSlot(String filename,long fileSize,String contentType,DomainBareJid uploadServiceAddress) throws SmackException, InterruptedException, XMPPException.XMPPErrorException {
  final XMPPConnection connection=connection();
  final UploadService defaultUploadService=this.defaultUploadService;
  UploadService uploadService;
  if (uploadServiceAddress == null) {
    uploadService=defaultUploadService;
  }
 else {
    if (defaultUploadService != null && defaultUploadService.getAddress().equals(uploadServiceAddress)) {
      uploadService=defaultUploadService;
    }
 else {
      DiscoverInfo discoverInfo=ServiceDiscoveryManager.getInstanceFor(connection).discoverInfo(uploadServiceAddress);
      if (!containsHttpFileUploadNamespace(discoverInfo)) {
        throw new IllegalArgumentException("There is no HTTP upload service running at the given address '" + uploadServiceAddress + '\'');
      }
      uploadService=uploadServiceFrom(discoverInfo);
    }
  }
  if (uploadService == null) {
    throw new SmackException.SmackMessageException("No upload service specified and also none discovered.");
  }
  if (!uploadService.acceptsFileOfSize(fileSize)) {
    throw new IllegalArgumentException("Requested file size " + fileSize + " is greater than max allowed size "+ uploadService.getMaxFileSize());
  }
  SlotRequest slotRequest;
switch (uploadService.getVersion()) {
case v0_3:
    slotRequest=new SlotRequest(uploadService.getAddress(),filename,fileSize,contentType);
  break;
case v0_2:
slotRequest=new SlotRequest_V0_2(uploadService.getAddress(),filename,fileSize,contentType);
break;
default :
throw new AssertionError();
}
return connection.sendIqRequestAndWaitForResponse(slotRequest);
}
