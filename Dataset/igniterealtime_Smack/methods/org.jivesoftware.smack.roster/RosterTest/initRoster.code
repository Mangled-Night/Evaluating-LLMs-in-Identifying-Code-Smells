/** 
 * Initialize the roster according to the example in <a href="http://xmpp.org/rfcs/rfc3921.html#roster-login" >RFC3921: Retrieving One's Roster on Login</a>.
 * @throws SmackException if Smack detected an exceptional situation.
 * @throws XmppStringprepException if the provided string is invalid.
 */
private void initRoster() throws InterruptedException, SmackException, XmppStringprepException {
  roster.reload();
  while (true) {
    final Stanza sentPacket=connection.getSentPacket();
    if (sentPacket instanceof RosterPacket && ((IQ)sentPacket).getType() == IQ.Type.get) {
      final RosterPacket rosterRequest=(RosterPacket)sentPacket;
      assertSame("The <query/> element MUST NOT contain any <item/> child elements!",0,rosterRequest.getRosterItemCount());
      final RosterPacket rosterResult=new RosterPacket();
      rosterResult.setTo(connection.getUser());
      rosterResult.setType(IQ.Type.result);
      rosterResult.setStanzaId(rosterRequest.getStanzaId());
      final Item romeo=new Item(JidCreate.entityBareFrom("romeo@example.net"),"Romeo");
      romeo.addGroupName("Friends");
      romeo.setItemType(ItemType.both);
      rosterResult.addRosterItem(romeo);
      final Item mercutio=new Item(JidCreate.entityBareFrom("mercutio@example.com"),"Mercutio");
      mercutio.setItemType(ItemType.from);
      rosterResult.addRosterItem(mercutio);
      final Item benvolio=new Item(JidCreate.entityBareFrom("benvolio@example.net"),"Benvolio");
      benvolio.setItemType(ItemType.both);
      rosterResult.addRosterItem(benvolio);
      connection.processStanza(rosterResult);
      break;
    }
  }
  roster.waitUntilLoaded();
  rosterListener.waitUntilInvocationOrTimeout();
}
