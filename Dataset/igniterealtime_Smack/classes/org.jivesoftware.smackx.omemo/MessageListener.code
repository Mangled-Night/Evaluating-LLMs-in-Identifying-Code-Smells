static class MessageListener extends SyncPointListener {
  protected final String expectedMessage;
  MessageListener(  String expectedMessage,  SimpleResultSyncPoint syncPoint){
    super(syncPoint);
    this.expectedMessage=expectedMessage;
  }
  MessageListener(  String expectedMessage){
    this(expectedMessage,new SimpleResultSyncPoint());
  }
  @Override public void onOmemoMessageReceived(  Stanza stanza,  OmemoMessage.Received received){
    SimpleResultSyncPoint srp=(SimpleResultSyncPoint)syncPoint;
    if (received.isKeyTransportMessage()) {
      return;
    }
    if (received.getBody().equals(expectedMessage)) {
      srp.signal();
    }
 else {
      srp.signalFailure("Received decrypted message was not equal to sent message.");
    }
  }
}
