/** 
 * SystemContextJsonProvider provides system context information to  {@link org.terasology.engine.telemetry.logstash.TelemetryLogstashAppender}. These information will then send to the server. You can find all the fields that will be sent in  {@link org.terasology.engine.telemetry.metrics.SystemContextMetric}The fieldName can be reset in logback.xml.
 */
public class SystemContextJsonProvider extends AbstractFieldJsonProvider<ILoggingEvent> implements FieldNamesAware<LogstashFieldNames> {
  public static final String FIELD_SYSTEM_CONTEXT="system_context";
  public SystemContextJsonProvider(){
    setFieldName(FIELD_SYSTEM_CONTEXT);
  }
  public void writeTo(  JsonGenerator generator,  ILoggingEvent event) throws IOException {
    TelemetryLogstashAppender appender=TelemetryUtils.fetchTelemetryLogstashAppender();
    Context context=appender.getGameContext();
    if (context != null) {
      Metrics metrics=context.get(Metrics.class);
      Optional<Metric> optional=metrics.getMetric(SystemContextMetric.class);
      if (optional.isPresent()) {
        Metric systemContextMetric=optional.get();
        Map<String,?> map=systemContextMetric.createTelemetryFieldToValue();
        Map<String,String> stringMap=TelemetryUtils.toStringMap(map);
        JsonWritingUtils.writeMapStringFields(generator,getFieldName(),stringMap);
      }
    }
  }
  public void setFieldNames(  LogstashFieldNames fieldNames){
    setFieldName(fieldNames.getMessage());
  }
}
