public ShellImpl(ShellServer server,Term term,InternalCommandManager commandManager,Instrumentation instrumentation,long pid,JobControllerImpl jobController){
  if (term instanceof TermImpl) {
    TermImpl termImpl=(TermImpl)term;
    TtyConnection conn=termImpl.getConn();
    if (conn instanceof TelnetTtyConnection) {
      TelnetConnection telnetConnection=((TelnetTtyConnection)conn).getTelnetConnection();
      if (telnetConnection instanceof NettyTelnetConnection) {
        ChannelHandlerContext handlerContext=((NettyTelnetConnection)telnetConnection).channelHandlerContext();
        Principal principal=AuthUtils.localPrincipal(handlerContext);
        if (principal != null) {
          try {
            Subject subject=securityAuthenticator.login(principal);
            if (subject != null) {
              session.put(ArthasConstants.SUBJECT_KEY,subject);
            }
          }
 catch (          LoginException e) {
            logger.error("local connection auth error",e);
          }
        }
      }
    }
    if (conn instanceof ExtHttpTtyConnection) {
      ExtHttpTtyConnection extConn=(ExtHttpTtyConnection)conn;
      Map<String,Object> extSessions=extConn.extSessions();
      for (      Entry<String,Object> entry : extSessions.entrySet()) {
        session.put(entry.getKey(),entry.getValue());
      }
    }
  }
  session.put(Session.COMMAND_MANAGER,commandManager);
  session.put(Session.INSTRUMENTATION,instrumentation);
  session.put(Session.PID,pid);
  session.put(Session.SERVER,server);
  session.put(Session.TTY,term);
  this.id=UUID.randomUUID().toString();
  session.put(Session.ID,id);
  this.commandManager=commandManager;
  this.closedFuture=Future.future();
  this.term=term;
  this.jobController=jobController;
  if (term != null) {
    term.setSession(session);
  }
  this.setPrompt();
}
