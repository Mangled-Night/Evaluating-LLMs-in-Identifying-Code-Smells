public class WebSocketConnectionTest {
static {
    SmackConfiguration.DEBUG=true;
  }
  public static void main(  String[] args) throws URISyntaxException, SmackException, IOException, XMPPException, InterruptedException {
    String jid, password, websocketEndpoint, messageTo=null;
    if (args.length < 3 || args.length > 4) {
      throw new IllegalArgumentException();
    }
    jid=args[0];
    password=args[1];
    websocketEndpoint=args[2];
    if (args.length >= 4) {
      messageTo=args[3];
    }
    testWebSocketConnection(jid,password,websocketEndpoint,messageTo);
  }
  public static void testWebSocketConnection(  String jid,  String password,  String websocketEndpoint) throws URISyntaxException, SmackException, IOException, XMPPException, InterruptedException {
    testWebSocketConnection(jid,password,websocketEndpoint,null);
  }
  public static void testWebSocketConnection(  String jid,  String password,  String websocketEndpoint,  String messageTo) throws URISyntaxException, SmackException, IOException, XMPPException, InterruptedException {
    ModularXmppClientToServerConnectionConfiguration.Builder builder=ModularXmppClientToServerConnectionConfiguration.builder();
    builder.removeAllModules().setXmppAddressAndPassword(jid,password).setDebuggerFactory(ConsoleDebugger.Factory.INSTANCE);
    XmppWebSocketTransportModuleDescriptor.Builder websocketBuilder=XmppWebSocketTransportModuleDescriptor.getBuilder(builder);
    websocketBuilder.explicitlySetWebSocketEndpointAndDiscovery(websocketEndpoint,false);
    builder.addModule(websocketBuilder.build());
    ModularXmppClientToServerConnectionConfiguration config=builder.build();
    ModularXmppClientToServerConnection connection=new ModularXmppClientToServerConnection(config);
    connection.setReplyTimeout(5 * 60 * 1000);
    connection.addConnectionStateMachineListener((event,c) -> {
      Logger.getAnonymousLogger().info("Connection event: " + event);
    }
);
    connection.connect();
    connection.login();
    if (messageTo != null) {
      Message message=connection.getStanzaFactory().buildMessageStanza().to(messageTo).setBody("It is alive! " + XmppDateTime.formatXEP0082Date(new Date())).build();
      connection.sendStanza(message);
    }
    Thread.sleep(1000);
    connection.disconnect();
    ModularXmppClientToServerConnection.Stats connectionStats=connection.getStats();
    ServiceDiscoveryManager.Stats serviceDiscoveryManagerStats=ServiceDiscoveryManager.getInstanceFor(connection).getStats();
    System.out.println("WebSocket successfully finished, yeah!\n" + connectionStats + '\n'+ serviceDiscoveryManagerStats);
  }
}
