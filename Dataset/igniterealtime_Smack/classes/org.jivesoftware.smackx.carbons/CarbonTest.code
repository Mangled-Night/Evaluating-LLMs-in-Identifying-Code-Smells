public class CarbonTest extends ExperimentalInitializerTest {
  private static Properties outputProperties=new Properties();
static {
    outputProperties.put(javax.xml.transform.OutputKeys.OMIT_XML_DECLARATION,"yes");
  }
  @Test public void carbonSentTest() throws Exception {
    XmlPullParser parser;
    String control;
    CarbonExtension cc;
    Forwarded<Message> fwd;
    control=XMLBuilder.create("sent").e("forwarded").a("xmlns","urn:xmpp:forwarded:0").e("message").a("from","romeo@montague.com").asString(outputProperties);
    parser=PacketParserUtils.getParserFor(control);
    cc=new CarbonManagerProvider().parse(parser);
    fwd=cc.getForwarded();
    assertEquals(CarbonExtension.Direction.sent,cc.getDirection());
    assertEquals(null,fwd.getDelayInformation());
    assertEquals("romeo@montague.com",fwd.getForwardedStanza().getFrom().toString());
    assertEquals(XmlPullParser.Event.END_ELEMENT,parser.getEventType());
    assertEquals("sent",parser.getName());
  }
  @Test public void carbonReceivedTest() throws Exception {
    XmlPullParser parser;
    String control;
    CarbonExtension cc;
    control=XMLBuilder.create("received").e("forwarded").a("xmlns","urn:xmpp:forwarded:0").e("message").a("from","romeo@montague.com").asString(outputProperties);
    parser=PacketParserUtils.getParserFor(control);
    cc=new CarbonManagerProvider().parse(parser);
    assertEquals(CarbonExtension.Direction.received,cc.getDirection());
    assertEquals(XmlPullParser.Event.END_ELEMENT,parser.getEventType());
    assertEquals("received",parser.getName());
  }
  @ParameterizedTest @EnumSource(SmackTestUtil.XmlPullParserKind.class) public void carbonEmptyTest(  SmackTestUtil.XmlPullParserKind parserKind) throws Exception {
    String control;
    control=XMLBuilder.create("sent").a("xmlns","urn:xmpp:forwarded:0").asString(outputProperties);
    assertThrows(SmackParsingException.class,() -> SmackTestUtil.parse(control,CarbonManagerProvider.class,parserKind));
  }
}
