public class XmppTools {
  public static void main(  String[] args) throws SmackException, IOException, XMPPException, InterruptedException, KeyManagementException, NoSuchAlgorithmException {
    boolean one=createAccount("xmpp.foobar.io","smack1","smack1");
    boolean two=createAccount("xmpp.foobar.io","smack2","smack2");
    System.out.println("Account created: " + one + ' '+ two);
  }
  public static boolean supportsIbr(  String xmppDomain) throws SmackException, IOException, XMPPException, InterruptedException, KeyManagementException, NoSuchAlgorithmException {
    DomainBareJid xmppDomainJid=JidCreate.domainBareFrom(xmppDomain);
    return supportsIbr(xmppDomainJid);
  }
  public static boolean supportsIbr(  DomainBareJid xmppDomain) throws SmackException, IOException, XMPPException, InterruptedException, KeyManagementException, NoSuchAlgorithmException {
    XMPPTCPConnectionConfiguration.Builder configBuilder=XMPPTCPConnectionConfiguration.builder().setXmppDomain(xmppDomain);
    TLSUtils.acceptAllCertificates(configBuilder);
    XMPPTCPConnectionConfiguration config=configBuilder.build();
    XMPPTCPConnection connection=new XMPPTCPConnection(config);
    connection.connect();
    try {
      return supportsIbr(connection);
    }
  finally {
      connection.disconnect();
    }
  }
  public static boolean supportsIbr(  XMPPConnection connection) throws NoResponseException, XMPPErrorException, NotConnectedException, InterruptedException {
    AccountManager accountManager=AccountManager.getInstance(connection);
    return accountManager.supportsAccountCreation();
  }
  public static boolean createAccount(  String xmppDomain,  String username,  String password) throws KeyManagementException, NoSuchAlgorithmException, SmackException, IOException, XMPPException, InterruptedException {
    DomainBareJid xmppDomainJid=JidCreate.domainBareFrom(xmppDomain);
    Localpart localpart=Localpart.from(username);
    return createAccount(xmppDomainJid,localpart,password);
  }
  public static boolean createAccount(  DomainBareJid xmppDomain,  Localpart username,  String password) throws KeyManagementException, NoSuchAlgorithmException, SmackException, IOException, XMPPException, InterruptedException {
    XMPPTCPConnectionConfiguration.Builder configBuilder=XMPPTCPConnectionConfiguration.builder().setXmppDomain(xmppDomain);
    TLSUtils.acceptAllCertificates(configBuilder);
    XMPPTCPConnectionConfiguration config=configBuilder.build();
    XMPPTCPConnection connection=new XMPPTCPConnection(config);
    connection.connect();
    try {
      if (!supportsIbr(connection))       return false;
      AccountManager accountManager=AccountManager.getInstance(connection);
      accountManager.createAccount(username,password);
      return true;
    }
  finally {
      connection.disconnect();
    }
  }
  public static void modularConnectionTest(  ModularXmppClientToServerConnection connection,  String messageTo) throws XMPPException, SmackException, IOException, InterruptedException {
    connection.addConnectionStateMachineListener((event,c) -> {
      Logger.getAnonymousLogger().info("Connection event: " + event);
    }
);
    connection.connect();
    connection.login();
    XmppTools.sendItsAlive(messageTo,connection);
    Thread.sleep(1000);
    connection.disconnect();
    ModularXmppClientToServerConnection.Stats connectionStats=connection.getStats();
    ServiceDiscoveryManager.Stats serviceDiscoveryManagerStats=ServiceDiscoveryManager.getInstanceFor(connection).getStats();
    System.out.println("NIO successfully finished, yeah!\n" + connectionStats + '\n'+ serviceDiscoveryManagerStats);
  }
  public static void sendItsAlive(  String to,  XMPPConnection connection) throws XmppStringprepException, NotConnectedException, InterruptedException {
    if (to == null) {
      return;
    }
    Message message=connection.getStanzaFactory().buildMessageStanza().to(to).setBody("It is alive! " + XmppDateTime.formatXEP0082Date(new Date())).build();
    connection.sendStanza(message);
  }
}
