/** 
 * Invoking  {@link InBandBytestreamManager#establishSession(org.jxmpp.jid.Jid)} shouldthrow an exception if the given target does not support in-band bytestream.
 * @throws SmackException if Smack detected an exceptional situation.
 * @throws XMPPException if an XMPP protocol error was received.
 * @throws InterruptedException if the calling thread was interrupted.
 */
@Test public void shouldFailIfTargetDoesNotSupportIBB() throws SmackException, XMPPException, InterruptedException {
  InBandBytestreamManager byteStreamManager=InBandBytestreamManager.getByteStreamManager(connection);
  try {
    IQ errorIQ=IBBPacketUtils.createErrorIQ(targetJID,initiatorJID,StanzaError.Condition.feature_not_implemented);
    protocol.addResponse(errorIQ);
    byteStreamManager.establishSession(targetJID);
    fail("exception should be thrown");
  }
 catch (  XMPPErrorException e) {
    assertEquals(StanzaError.Condition.feature_not_implemented,e.getStanzaError().getCondition());
  }
}
