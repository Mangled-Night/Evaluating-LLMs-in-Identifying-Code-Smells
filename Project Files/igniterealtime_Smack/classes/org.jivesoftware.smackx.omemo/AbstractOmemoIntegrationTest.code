/** 
 * Super class for OMEMO integration tests.
 */
public abstract class AbstractOmemoIntegrationTest extends AbstractSmackIntegrationTest {
  public AbstractOmemoIntegrationTest(  SmackIntegrationTestEnvironment environment) throws XMPPException.XMPPErrorException, SmackException.NotConnectedException, InterruptedException, SmackException.NoResponseException, TestNotPossibleException {
    super(environment);
    if (!OmemoManager.serverSupportsOmemo(connection,connection.getXMPPServiceDomain())) {
      throw new TestNotPossibleException("Server does not support OMEMO (PubSub)");
    }
    if (!OmemoService.isServiceRegistered()) {
      throw new TestNotPossibleException("No OmemoService registered.");
    }
    OmemoConfiguration.setCompleteSessionWithEmptyMessage(true);
    OmemoConfiguration.setRepairBrokenSessionsWithPrekeyMessages(true);
  }
}
