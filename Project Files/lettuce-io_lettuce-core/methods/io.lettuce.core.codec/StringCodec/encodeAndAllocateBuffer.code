/** 
 * Compatibility implementation.
 * @param key
 * @return
 */
private ByteBuffer encodeAndAllocateBuffer(String key){
  if (key == null) {
    return ByteBuffer.wrap(EMPTY);
  }
  ByteBuffer buffer=ByteBuffer.allocate(sizeOf(key,false));
  ByteBuf byteBuf=Unpooled.wrappedBuffer(buffer);
  byteBuf.clear();
  encode(key,byteBuf);
  buffer.limit(byteBuf.writerIndex());
  return buffer;
}
