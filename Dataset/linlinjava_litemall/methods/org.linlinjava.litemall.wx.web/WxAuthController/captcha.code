/** 
 * 请求验证码 TODO 这里需要一定机制防止短信验证码被滥用
 * @param body 手机号码 { mobile: xxx, type: xxx }
 * @return
 */
@PostMapping("captcha") public Object captcha(@LoginUser Integer userId,@RequestBody String body){
  if (userId == null) {
    return ResponseUtil.unlogin();
  }
  String phoneNumber=JacksonUtil.parseString(body,"mobile");
  String captchaType=JacksonUtil.parseString(body,"type");
  if (StringUtils.isEmpty(phoneNumber)) {
    return ResponseUtil.badArgument();
  }
  if (!RegexUtil.isMobileSimple(phoneNumber)) {
    return ResponseUtil.badArgumentValue();
  }
  if (StringUtils.isEmpty(captchaType)) {
    return ResponseUtil.badArgument();
  }
  if (!notifyService.isSmsEnable()) {
    return ResponseUtil.fail(AUTH_CAPTCHA_UNSUPPORT,"小程序后台验证码服务不支持");
  }
  String code=CharUtil.getRandomNum(6);
  boolean successful=CaptchaCodeManager.addToCache(phoneNumber,code);
  if (!successful) {
    return ResponseUtil.fail(AUTH_CAPTCHA_FREQUENCY,"验证码未超时1分钟，不能发送");
  }
  notifyService.notifySmsTemplate(phoneNumber,NotifyType.CAPTCHA,new String[]{code});
  return ResponseUtil.ok();
}
