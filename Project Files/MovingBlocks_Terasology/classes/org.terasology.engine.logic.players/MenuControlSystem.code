/** 
 * This system controls the client's in-game menus (Pause screen, Death screen, HUDs and overlays).
 */
@RegisterSystem(RegisterMode.CLIENT) public class MenuControlSystem extends BaseComponentSystem {
  @In private NUIManager nuiManager;
  @In private Time time;
  @In private NetworkSystem networkSystem;
  @Override public void initialise(){
    nuiManager.getHUD().addHUDElement("dropItemRegion");
    nuiManager.getHUD().addHUDElement("toolbar");
  }
  @ReceiveEvent(components=ClientComponent.class) public void onTogglePause(  PauseButton event,  EntityRef entity){
    if (event.getState() == ButtonState.DOWN) {
      nuiManager.toggleScreen("engine:pauseMenu");
      event.consume();
    }
    if (networkSystem.getMode() == NetworkMode.NONE) {
      if (nuiManager.isOpen("engine:pauseMenu")) {
        time.setPaused(true);
      }
 else {
        time.setPaused(false);
      }
    }
  }
  @ReceiveEvent(components=ClientComponent.class) public void onScreenshotCapture(  ScreenshotButton event,  EntityRef entity){
    if (event.getState() == ButtonState.DOWN) {
      CoreRegistry.get(ScreenGrabber.class).takeScreenshot();
      CoreRegistry.get(AudioManager.class).playSound(Assets.getSound("engine:camera").get());
      event.consume();
    }
  }
  @ReceiveEvent(components=CharacterComponent.class) public void onPlayerDeath(  PlayerDeathEvent event,  EntityRef character){
    EntityRef client=character.getComponent(CharacterComponent.class).controller;
    if (client.getComponent(ClientComponent.class).local) {
      nuiManager.removeOverlay("engine:onlinePlayersOverlay");
      nuiManager.pushScreen("engine:deathScreen");
      if (event.damageTypeName != null) {
        ((DeathScreen)nuiManager.getScreen("engine:deathScreen")).setDeathDetails(event.instigatorName,event.damageTypeName);
      }
    }
  }
  @ReceiveEvent(components=ClientComponent.class) public void onShowOnlinePlayers(  OnlinePlayersButton event,  EntityRef entity){
    boolean show=event.isDown();
    String onlinePlayersOverlay="engine:onlinePlayersOverlay";
    if (show) {
      nuiManager.addOverlay(onlinePlayersOverlay,OnlinePlayersOverlay.class);
    }
 else {
      nuiManager.removeOverlay(onlinePlayersOverlay);
    }
    event.consume();
  }
}
