/** 
 * If the data stanza has a sequence that is already used an 'unexpected-request' error should be returned. See XEP-0047 Section 2.2.
 * @throws Exception should not happen
 */
@Test public void shouldReplyWithErrorIfAlreadyUsedSequenceIsReceived() throws Exception {
  protocol.addResponse(null,Verification.requestTypeRESULT);
  protocol.addResponse(null,Verification.requestTypeERROR,new Verification<IQ,IQ>(){
    @Override public void verify(    IQ request,    IQ response){
      assertEquals(StanzaError.Condition.unexpected_request,request.getError().getCondition());
    }
  }
);
  InBandBytestreamSession session=new InBandBytestreamSession(connection,initBytestream,initiatorJID);
  InputStream inputStream=session.getInputStream();
  StanzaListener listener=Whitebox.getInternalState(inputStream,"dataPacketListener",StanzaListener.class);
  String base64Data=Base64.encode("Data");
  DataPacketExtension dpe=new DataPacketExtension(sessionID,0,base64Data);
  Data data1=new Data(dpe);
  Data data2=new Data(dpe);
  listener.processStanza(data1);
  listener.processStanza(data2);
  protocol.verifyAll();
}
