/** 
 * SpringSecurity相关配置 Created by macro on 2018/4/26.
 */
@Configuration @EnableWebSecurity public class SecurityConfig extends WebSecurityConfigurerAdapter {
  @Autowired private UmsAdminMapper umsAdminMapper;
  @Override protected void configure(  HttpSecurity http) throws Exception {
    http.authorizeRequests().antMatchers("/**").permitAll().and().httpBasic().realmName("/").and().formLogin().loginPage("/login").failureUrl("/login?error=true").and().logout().logoutSuccessUrl("/").and().csrf().disable().headers().frameOptions().disable();
  }
  @Override protected void configure(  AuthenticationManagerBuilder auth) throws Exception {
    auth.userDetailsService(userDetailsService()).passwordEncoder(new BCryptPasswordEncoder());
  }
  @Bean public UserDetailsService userDetailsService(){
    return new UserDetailsService(){
      @Override public UserDetails loadUserByUsername(      String username) throws UsernameNotFoundException {
        UmsAdminExample example=new UmsAdminExample();
        example.createCriteria().andUsernameEqualTo(username);
        List<UmsAdmin> umsAdminList=umsAdminMapper.selectByExample(example);
        if (umsAdminList != null && umsAdminList.size() > 0) {
          return new AdminUserDetails(umsAdminList.get(0));
        }
        throw new UsernameNotFoundException("用户名或密码错误");
      }
    }
;
  }
}
