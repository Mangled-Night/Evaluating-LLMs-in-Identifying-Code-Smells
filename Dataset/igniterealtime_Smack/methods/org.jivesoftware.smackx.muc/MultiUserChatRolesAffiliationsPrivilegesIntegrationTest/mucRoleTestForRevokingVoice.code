/** 
 * Asserts that a user in an unmoderated room who undergoes an afilliation change receives that change as a presence update <p>From XEP-0045 ยง 5.1.3:</p> <blockquote> ...a MUC service implementation MUST change the occupant's role to reflect the change and communicate the change to all occupants... </blockquote> <p>From XEP-0045 ยง 8.4:</p> <blockquote> The service MUST then send updated presence from this individual to all occupants, indicating the removal of voice privileges... </blockquote>
 * @throws Exception when errors occur
 */
@SmackIntegrationTest public void mucRoleTestForRevokingVoice() throws Exception {
  EntityBareJid mucAddress=getRandomRoom("smack-inttest");
  MultiUserChat mucAsSeenByOne=mucManagerOne.getMultiUserChat(mucAddress);
  MultiUserChat mucAsSeenByTwo=mucManagerTwo.getMultiUserChat(mucAddress);
  final ResultSyncPoint<String,Exception> resultSyncPoint=new ResultSyncPoint<>();
  mucAsSeenByTwo.addUserStatusListener(new UserStatusListener(){
    @Override public void voiceRevoked(){
      resultSyncPoint.signal("done");
    }
  }
);
  createMuc(mucAsSeenByOne,"one-" + randomString);
  try {
    final Resourcepart nicknameTwo=Resourcepart.from("two-" + randomString);
    mucAsSeenByTwo.join(nicknameTwo);
    mucAsSeenByOne.revokeVoice(nicknameTwo);
    resultSyncPoint.waitForResult(timeout);
  }
  finally {
    tryDestroy(mucAsSeenByOne);
  }
}
