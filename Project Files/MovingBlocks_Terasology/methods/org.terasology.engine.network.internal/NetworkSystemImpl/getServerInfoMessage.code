NetData.ServerInfoMessage getServerInfoMessage(){
  return getServerInfoMessage(null);
}
private NetData.ServerInfoMessage getServerInfoMessage(String errorMessage){
  NetData.ServerInfoMessage.Builder serverInfoMessageBuilder=NetData.ServerInfoMessage.newBuilder();
  serverInfoMessageBuilder.setTime(time.getGameTimeInMs());
  if (config.getServerMOTD() != null) {
    serverInfoMessageBuilder.setMOTD(config.getServerMOTD());
  }
  serverInfoMessageBuilder.setOnlinePlayersAmount(clientList.size());
  WorldProvider worldProvider=context.get(WorldProvider.class);
  if (worldProvider != null) {
    NetData.WorldInfo.Builder worldInfoBuilder=NetData.WorldInfo.newBuilder();
    worldInfoBuilder.setTime(worldProvider.getTime().getMilliseconds());
    worldInfoBuilder.setTitle(worldProvider.getTitle());
    serverInfoMessageBuilder.addWorldInfo(worldInfoBuilder);
  }
  WorldGenerator worldGen=context.get(WorldGenerator.class);
  if (worldGen != null) {
    serverInfoMessageBuilder.setReflectionHeight(worldGen.getWorld().getSeaLevel() + 0.5f);
  }
  for (  Module module : context.get(ModuleManager.class).getEnvironment()) {
    if (!StandardModuleExtension.isServerSideOnly(module)) {
      serverInfoMessageBuilder.addModule(NetData.ModuleInfo.newBuilder().setModuleId(module.getId().toString()).setModuleVersion(module.getVersion().toString()).build());
    }
  }
  for (  Map.Entry<String,Short> blockMapping : blockManager.getBlockIdMap().entrySet()) {
    serverInfoMessageBuilder.addBlockId(blockMapping.getValue());
    serverInfoMessageBuilder.addBlockName(blockMapping.getKey());
  }
  for (  BlockFamily registeredBlockFamily : blockManager.listRegisteredBlockFamilies()) {
    serverInfoMessageBuilder.addRegisterBlockFamily(registeredBlockFamily.getURI().toString());
  }
  if (errorMessage != null && !errorMessage.isEmpty()) {
    serverInfoMessageBuilder.setErrorMessage(errorMessage);
  }
  serializeComponentInfo(serverInfoMessageBuilder);
  serializeEventInfo(serverInfoMessageBuilder);
  return serverInfoMessageBuilder.build();
}
