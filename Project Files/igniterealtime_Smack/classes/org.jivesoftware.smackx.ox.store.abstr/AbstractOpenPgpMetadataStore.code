public abstract class AbstractOpenPgpMetadataStore implements OpenPgpMetadataStore {
  private final Map<BareJid,Map<OpenPgpV4Fingerprint,Date>> announcedFingerprints=new HashMap<>();
  @Override public Map<OpenPgpV4Fingerprint,Date> getAnnouncedFingerprintsOf(  BareJid contact) throws IOException {
    Map<OpenPgpV4Fingerprint,Date> fingerprints=announcedFingerprints.get(contact);
    if (fingerprints == null) {
      fingerprints=readAnnouncedFingerprintsOf(contact);
      announcedFingerprints.put(contact,fingerprints);
    }
    return fingerprints;
  }
  @Override public void setAnnouncedFingerprintsOf(  BareJid contact,  Map<OpenPgpV4Fingerprint,Date> data) throws IOException {
    announcedFingerprints.put(contact,data);
    writeAnnouncedFingerprintsOf(contact,data);
  }
  /** 
 * Read the fingerprints and modification dates of announced keys of a user from local storage.
 * @param contact contact
 * @return contacts announced key fingerprints and latest modification dates
 * @throws IOException IO is dangerous
 */
  protected abstract Map<OpenPgpV4Fingerprint,Date> readAnnouncedFingerprintsOf(  BareJid contact) throws IOException ;
  /** 
 * Write the fingerprints and modification dates of announced keys of a user to local storage.
 * @param contact contact
 * @param metadata announced key fingerprints and latest modification dates
 * @throws IOException IO is dangerous
 */
  protected abstract void writeAnnouncedFingerprintsOf(  BareJid contact,  Map<OpenPgpV4Fingerprint,Date> metadata) throws IOException ;
}
