/** 
 * Reads the next byte of data from this input stream. The value byte is returned as an int in the range 0 to 255. If no byte is available because the end of the stream has been reached, the value -1 is returned. This method blocks until input data is available, the end of the stream is detected, or an exception is thrown.
 * @return the next byte of data, or -1 if the end of the stream is reached.
 */
@Override public int read() throws IOException {
  int retVal=read(readDummy,0,1);
  return (retVal == -1 ? -1 : readDummy[0]);
}
/** 
 * Reads up to len bytes of data from the input stream into an array of bytes.
 * @param b   the buffer into which the data is read.
 * @param off the start offset of the data.
 * @param len the maximum number of bytes read.
 * @return the total number of bytes read into the buffer, or -1 if there isno more data because the end of the stream has been reached.
 */
@Override public int read(byte[] b,int off,int len) throws IOException {
  if (eos) {
    return -1;
  }
  int bytesRead=0;
  int bytesRemaining=len;
  int offset=off;
  while (!eos && (bytesRemaining > 0)) {
    fillConvbuffer();
    if (!eos) {
      int bytesToCopy=Math.min(bytesRemaining,convbufferSize - convbufferOff);
      System.arraycopy(convbuffer,convbufferOff,b,offset,bytesToCopy);
      convbufferOff+=bytesToCopy;
      bytesRead+=bytesToCopy;
      bytesRemaining-=bytesToCopy;
      offset+=bytesToCopy;
    }
  }
  return bytesRead;
}
/** 
 * Reads up to len bytes of data from the input stream into a ByteBuffer.
 * @param b   the buffer into which the data is read.
 * @param off the start offset of the data.
 * @param len the maximum number of bytes read.
 * @return the total number of bytes read into the buffer, or -1 if there isno more data because the end of the stream has been reached.
 */
public int read(ByteBuffer b,int off,int len) throws IOException {
  if (eos) {
    return -1;
  }
  b.position(off);
  int bytesRead=0;
  int bytesRemaining=len;
  while (!eos && (bytesRemaining > 0)) {
    fillConvbuffer();
    if (!eos) {
      int bytesToCopy=Math.min(bytesRemaining,convbufferSize - convbufferOff);
      b.put(convbuffer,convbufferOff,bytesToCopy);
      convbufferOff+=bytesToCopy;
      bytesRead+=bytesToCopy;
      bytesRemaining-=bytesToCopy;
    }
  }
  return bytesRead;
}
