@SuppressWarnings("unchecked") @Override void encode(ByteBuf target){
  if (codec instanceof ToByteBufEncoder) {
    ToByteBufEncoder<K,V> toByteBufEncoder=(ToByteBufEncoder<K,V>)codec;
    ByteBuf temporaryBuffer=target.alloc().buffer(toByteBufEncoder.estimateSize(val) + 6);
    try {
      toByteBufEncoder.encodeValue(val,temporaryBuffer);
      ByteBufferArgument.writeByteBuf(target,temporaryBuffer);
    }
  finally {
      temporaryBuffer.release();
    }
    return;
  }
  ByteBufferArgument.writeByteBuffer(target,codec.encodeValue(val));
}
