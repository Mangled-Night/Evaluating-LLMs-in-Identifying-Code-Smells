@Override public CompletableFuture<StatefulRedisConnection<K,V>> getConnectionAsync(ConnectionIntent connectionIntent,int slot){
  if (debugEnabled) {
    logger.debug("getConnection(" + connectionIntent + ", "+ slot+ ")");
  }
  if (connectionIntent == ConnectionIntent.READ && readFrom != null && readFrom != ReadFrom.UPSTREAM) {
    return getReadConnection(slot);
  }
  return getWriteConnection(slot).toCompletableFuture();
}
@Override public CompletableFuture<StatefulRedisConnection<K,V>> getConnectionAsync(ConnectionIntent connectionIntent,String nodeId){
  if (debugEnabled) {
    logger.debug("getConnection(" + connectionIntent + ", "+ nodeId+ ")");
  }
  return getConnectionAsync(new ConnectionKey(connectionIntent,nodeId)).toCompletableFuture();
}
protected ConnectionFuture<StatefulRedisConnection<K,V>> getConnectionAsync(ConnectionKey key){
  ConnectionFuture<StatefulRedisConnection<K,V>> connectionFuture=connectionProvider.getConnection(key);
  CompletableFuture<StatefulRedisConnection<K,V>> result=new CompletableFuture<>();
  connectionFuture.handle((connection,throwable) -> {
    if (throwable != null) {
      result.completeExceptionally(RedisConnectionException.create(connectionFuture.getRemoteAddress(),Exceptions.bubble(throwable)));
    }
 else {
      result.complete(connection);
    }
    return null;
  }
);
  return ConnectionFuture.from(connectionFuture.getRemoteAddress(),result);
}
@Override public CompletableFuture<StatefulRedisConnection<K,V>> getConnectionAsync(ConnectionIntent connectionIntent,String host,int port){
  try {
    beforeGetConnection(connectionIntent,host,port);
    return connectionProvider.getConnection(new ConnectionKey(connectionIntent,host,port)).toCompletableFuture();
  }
 catch (  RedisException e) {
    throw e;
  }
catch (  RuntimeException e) {
    throw new RedisException(e);
  }
}
