@Test public void testComponentWithDoNotPersistIsNotPersisted(){
  componentLibrary.register(new ResourceUrn("test","nonpersisted"),NonpersistedComponent.class);
  EntityRef entity=entityManager.create();
  entity.addComponent(new NonpersistedComponent());
  entitySerializer.setComponentSerializeCheck(new PersistenceComponentSerializeCheck());
  EntityData.Entity entityData=entitySerializer.serialize(entity);
  long nextId=entityManager.getNextId();
  entityManager.clear();
  entityManager.setNextId(nextId);
  EntityRef loadedEntity=entitySerializer.deserialize(entityData);
  assertTrue(loadedEntity.exists());
  assertFalse(loadedEntity.hasComponent(NonpersistedComponent.class));
}
