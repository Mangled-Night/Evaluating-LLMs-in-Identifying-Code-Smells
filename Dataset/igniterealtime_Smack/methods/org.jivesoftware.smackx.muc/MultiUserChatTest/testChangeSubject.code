public void testChangeSubject(){
  final String[] answer=new String[2];
  try {
    muc.changeSubject("Initial Subject");
    MultiUserChat muc2=new MultiUserChat(getConnection(1),room);
    muc2.join("testbot2");
    MultiUserChat muc3=new MultiUserChat(getConnection(2),room);
    muc3.join("testbot3");
    muc3.addSubjectUpdatedListener(new SubjectUpdatedListener(){
      public void subjectUpdated(      String subject,      String from){
        answer[0]=subject;
        answer[1]=from;
      }
    }
);
    try {
      muc2.changeSubject("New Subject2");
      fail("User2 was allowed to change the room's subject");
    }
 catch (    XMPPException e) {
      XMPPError xmppError=e.getStanzaError();
      assertNotNull("No XMPPError was received when changing the room's subject",xmppError);
      assertEquals("Different error code was received while changing the room's subject",403,xmppError.getCode());
    }
    muc.changeSubject("New Subject1");
    Thread.sleep(300);
    assertEquals("User2 didn't receive the subject notification","New Subject1",muc2.getSubject());
    assertEquals("User3 didn't receive the subject notification","New Subject1",answer[0]);
    assertEquals("User3 didn't receive the correct user that changed the subject",room + "/testbot",answer[1]);
    muc2.leave();
    muc3.leave();
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail(e.getMessage());
  }
}
