@Test void testClusterListener() throws Exception {
  BlockingQueue<RedisClusterNode> nodes=new LinkedBlockingQueue<>();
  pubSubConnection.setNodeMessagePropagation(true);
  pubSubConnection.addListener(connectionListener);
  pubSubConnection.addListener(new RedisClusterPubSubAdapter<String,String>(){
    @Override public void message(    RedisClusterNode node,    String pattern,    String channel,    String message){
      nodes.add(node);
    }
  }
);
  PubSubNodeSelection<String,String> masters=pubSubConnection.sync().masters();
  NodeSelectionPubSubCommands<String,String> commands=masters.commands();
  commands.psubscribe("chann*");
  pubSubConnection2.sync().publish("channel","message");
  assertThat(masters.size()).isEqualTo(2);
  assertThat(connectionListener.getMessages().take()).isEqualTo("message");
  assertThat(connectionListener.getMessages().take()).isEqualTo("message");
  assertThat(connectionListener.getMessages().poll()).isNull();
  assertThat(nodes.take()).isNotNull();
  assertThat(nodes.take()).isNotNull();
  assertThat(nodes.poll()).isNull();
}
