@Override public void generateChunkMesh(ChunkView view,ChunkMesh chunkMesh,int x,int y,int z){
  final BlockAppearance blockAppearance=block.getPrimaryAppearance();
  if (!blockAppearance.hasAppearance()) {
    return;
  }
  Color colorCache=new Color();
  Block[] adjacentBlocks=new Block[Side.allSides().size()];
  for (  Side side : Side.allSides()) {
    Vector3ic offset=side.direction();
    Block blockToCheck=view.getBlock(x + offset.x(),y + offset.y(),z + offset.z());
    adjacentBlocks[side.ordinal()]=blockToCheck;
  }
  final ChunkMesh.RenderType renderType=getRenderType(block);
  final ChunkVertexFlag vertexFlag=getChunkVertexFlag(view,x,y,z,block);
  boolean isRendered=false;
  for (  final Side side : Side.allSides()) {
    if (isSideVisibleForBlockTypes(adjacentBlocks[side.ordinal()],block,side)) {
      isRendered=true;
      BlockMeshPart blockMeshPart=blockAppearance.getPart(BlockPart.fromSide(side));
      if (block.isLiquid()) {
        final Block topBlock=adjacentBlocks[Side.TOP.ordinal()];
        if (topBlock.isLiquid() && Side.horizontalSides().contains(side)) {
          final Vector3ic offset=side.direction();
          final Block adjacentAbove=view.getBlock(x + offset.x(),y + 1,z + offset.z());
          final Block adjacent=adjacentBlocks[side.ordinal()];
          if (adjacent.isLiquid() && !adjacentAbove.isLiquid()) {
            blockMeshPart=block.getTopLiquidMesh(side);
          }
        }
 else {
          if (blockMeshPart != null) {
            blockMeshPart=block.getLowLiquidMesh(side);
          }
        }
      }
      if (blockMeshPart != null) {
        ChunkVertexFlag sideVertexFlag=vertexFlag;
        if (block.isGrass() && side != Side.TOP && side != Side.BOTTOM) {
          sideVertexFlag=ChunkVertexFlag.COLOR_MASK;
        }
        Colorc colorOffset=block.getColorOffset(BlockPart.fromSide(side));
        Colorc colorSource=block.getColorSource(BlockPart.fromSide(side)).calcColor(view,x,y,z);
        colorCache.setRed(colorSource.rf() * colorOffset.rf()).setGreen(colorSource.gf() * colorOffset.gf()).setBlue(colorSource.bf() * colorOffset.bf()).setAlpha(colorSource.af() * colorOffset.af());
        blockMeshPart.appendTo(chunkMesh,view,x,y,z,renderType,colorCache,sideVertexFlag);
      }
    }
  }
  if (isRendered && blockAppearance.getPart(BlockPart.CENTER) != null) {
    Colorc colorOffset=block.getColorOffset(BlockPart.CENTER);
    Colorc colorSource=block.getColorSource(BlockPart.CENTER).calcColor(view,x,y,z);
    colorCache.setRed(colorSource.rf() * colorOffset.rf()).setGreen(colorSource.gf() * colorOffset.gf()).setBlue(colorSource.bf() * colorOffset.bf()).setAlpha(colorSource.af() * colorOffset.af());
    blockAppearance.getPart(BlockPart.CENTER).appendTo(chunkMesh,view,x,y,z,renderType,colorCache,vertexFlag);
  }
}
