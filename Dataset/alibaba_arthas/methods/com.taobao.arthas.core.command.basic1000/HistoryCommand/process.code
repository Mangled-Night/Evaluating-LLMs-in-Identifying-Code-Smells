@Override public void process(CommandProcess process){
  Session session=process.session();
  Object termObject=session.get(Session.TTY);
  if (termObject instanceof TermImpl) {
    TermImpl term=(TermImpl)termObject;
    Readline readline=term.getReadline();
    List<int[]> history=readline.getHistory();
    if (clear) {
      readline.setHistory(new ArrayList<int[]>());
    }
 else {
      StringBuilder sb=new StringBuilder();
      int size=history.size();
      if (n < 0 || n > size) {
        n=size;
      }
      for (int i=0; i < n; ++i) {
        int[] line=history.get(n - i - 1);
        sb.append(String.format("%5s  ",size - (n - i - 1)));
        Helper.appendCodePoints(line,sb);
        sb.append('\n');
      }
      process.write(sb.toString());
    }
  }
 else {
    HistoryManager historyManager=ArthasBootstrap.getInstance().getHistoryManager();
    if (clear) {
      historyManager.clearHistory();
    }
 else {
      List<String> history=historyManager.getHistory();
      process.appendResult(new HistoryModel(new ArrayList<String>(history)));
    }
  }
  process.end();
}
