/** 
 * CloseListener handles all In-Band Bytestream close requests. <p> If a close request is received it looks if a stored In-Band Bytestream session exists and closes it. If no session with the given session ID exists an &lt;item-not-found/&gt; error is returned to the sender.
 * @author Henning Staib
 */
class CloseListener extends AbstractIqRequestHandler {
  private final InBandBytestreamManager manager;
  /** 
 * Constructor.
 * @param manager the In-Band Bytestream manager
 */
  protected CloseListener(  InBandBytestreamManager manager){
    super(Close.ELEMENT,Close.NAMESPACE,IQ.Type.set,Mode.async);
    this.manager=manager;
  }
  @Override public IQ handleIQRequest(  IQ iqRequest){
    Close closeRequest=(Close)iqRequest;
    InBandBytestreamSession ibbSession=this.manager.getSessions().get(closeRequest.getSessionID());
    if (ibbSession == null) {
      try {
        this.manager.replyItemNotFoundPacket(closeRequest);
      }
 catch (      InterruptedException|NotConnectedException e) {
        return null;
      }
    }
 else {
      try {
        ibbSession.closeByPeer(closeRequest);
      }
 catch (      InterruptedException|NotConnectedException e) {
        return null;
      }
      this.manager.getSessions().remove(closeRequest.getSessionID());
    }
    return null;
  }
}
