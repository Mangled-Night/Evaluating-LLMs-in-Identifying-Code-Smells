/** 
 * Inject values from this context to annotated fields. <p> The injector looks for fields annotated with  {@link In @In} and tries to set them bygetting a value by looking up the field's type in the  {@code context}. <p> If there is no matching value in the context, the field is silently skipped and left with its previous value.
 * @return the input {@code object}, now with fields set
 */
public static <T>T inject(final T object,Context context){
  AccessController.doPrivileged((PrivilegedAction<Void>)() -> {
    for (    Field field : ReflectionUtils.getAllFields(object.getClass(),ReflectionUtils.withAnnotation(In.class))) {
      Object value=context.get(field.getType());
      if (value != null) {
        try {
          field.setAccessible(true);
          field.set(object,value);
        }
 catch (        IllegalAccessException e) {
          logger.error("Failed to inject value {} into field {} of {}",value,field,object,e);
        }
      }
    }
    return null;
  }
);
  return object;
}
/** 
 * Inject values from CoreRegistry to annotated fields.
 * @deprecated CoreRegistry-based methods are deprecated in favor of the more thread-safe Context.
 * @see #inject(Object,Context)
 */
@Deprecated(since="5.3.0",forRemoval=true) public static void inject(final Object object){
  AccessController.doPrivileged((PrivilegedAction<Object>)() -> {
    for (    Field field : ReflectionUtils.getAllFields(object.getClass(),ReflectionUtils.withAnnotation(In.class))) {
      Object value=CoreRegistry.get(field.getType());
      if (value != null) {
        try {
          field.setAccessible(true);
          field.set(object,value);
        }
 catch (        IllegalAccessException e) {
          logger.error("Failed to inject value {} into field {} of {}",value,field,object,e);
        }
      }
 else {
        logger.warn("{} wanted {} injected but CoreRegistry has none.",object.getClass().getSimpleName(),field.getType().getSimpleName());
      }
    }
    return null;
  }
);
}
public static <T>void inject(final Object object,final Class<? extends Annotation> annotation,final Map<Class<? extends T>,T> source){
  AccessController.doPrivileged((PrivilegedAction<Object>)() -> {
    for (    Field field : ReflectionUtils.getAllFields(object.getClass(),ReflectionUtils.withAnnotation(annotation))) {
      Object value=source.get(field.getType());
      if (value != null) {
        try {
          field.setAccessible(true);
          field.set(object,value);
        }
 catch (        IllegalAccessException e) {
          logger.error("Failed to inject value {} into field {}",value,field,e);
        }
      }
 else {
        logger.error("Failed to inject into field {}, nothing to inject",field);
      }
    }
    return null;
  }
);
}
