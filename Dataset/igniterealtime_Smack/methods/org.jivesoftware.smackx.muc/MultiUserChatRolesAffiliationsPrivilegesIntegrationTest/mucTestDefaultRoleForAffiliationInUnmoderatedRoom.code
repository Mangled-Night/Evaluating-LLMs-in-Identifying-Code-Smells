/** 
 * Asserts that an unmoderated room assigns the correct default roles for a given affiliation <p>From XEP-0045 ยง 5.1.2:</p> <blockquote> ...the initial default roles that a service SHOULD set based on the user's affiliation... </blockquote>
 * @throws Exception when errors occur
 */
@SmackIntegrationTest public void mucTestDefaultRoleForAffiliationInUnmoderatedRoom() throws Exception {
  EntityBareJid mucAddress=getRandomRoom("smack-inttest-unmoderatedroles");
  MultiUserChat mucAsSeenByOne=mucManagerOne.getMultiUserChat(mucAddress);
  MultiUserChat mucAsSeenByTwo=mucManagerTwo.getMultiUserChat(mucAddress);
  MultiUserChat mucAsSeenByThree=mucManagerThree.getMultiUserChat(mucAddress);
  final Resourcepart nicknameOne=Resourcepart.from("one-" + randomString);
  final Resourcepart nicknameTwo=Resourcepart.from("two-" + randomString);
  final Resourcepart nicknameThree=Resourcepart.from("three-" + randomString);
  createMuc(mucAsSeenByOne,nicknameOne);
  try {
    mucAsSeenByTwo.join(nicknameTwo);
    mucAsSeenByThree.join(nicknameThree);
    final ResultSyncPoint<String,Exception> resultSyncPoint=new ResultSyncPoint<>();
    mucAsSeenByOne.addParticipantStatusListener(new ParticipantStatusListener(){
      @Override public void adminGranted(      EntityFullJid participant){
        resultSyncPoint.signal("done");
      }
    }
);
    mucAsSeenByOne.grantAdmin(conTwo.getUser().asBareJid());
    resultSyncPoint.waitForResult(timeout);
    assertEquals(mucAsSeenByOne.getOccupantsCount(),3);
    assertEquals(MUCRole.moderator,mucAsSeenByOne.getOccupant(JidCreate.entityFullFrom(mucAddress,nicknameOne)).getRole());
    assertEquals(MUCRole.moderator,mucAsSeenByOne.getOccupant(JidCreate.entityFullFrom(mucAddress,nicknameTwo)).getRole());
    assertEquals(MUCRole.participant,mucAsSeenByOne.getOccupant(JidCreate.entityFullFrom(mucAddress,nicknameThree)).getRole());
  }
  finally {
    tryDestroy(mucAsSeenByOne);
  }
}
