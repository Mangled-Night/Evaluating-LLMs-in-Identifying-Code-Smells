@ReceiveEvent(components={CharacterMovementComponent.class,LocationComponent.class,AliveCharacterComponent.class}) public void onTeleport(CharacterTeleportEvent event,EntityRef entity){
  CircularBuffer<CharacterStateEvent> stateBuffer=characterStates.get(entity);
  CharacterStateEvent lastState=stateBuffer.getLast();
  CharacterStateEvent newState=new CharacterStateEvent(lastState);
  newState.setPosition(new Vector3f(event.getTargetPosition()));
  newState.setTime(time.getGameTimeInMs());
  stateBuffer.add(newState);
  characterMovementSystemUtility.setToState(entity,newState);
}
