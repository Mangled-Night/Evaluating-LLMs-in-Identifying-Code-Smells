private static final class SortComparator implements Comparator<RecordPointerAndKeyPrefix> {
  private final RecordComparator recordComparator;
  private final PrefixComparator prefixComparator;
  private final DataNodeMemoryManager memoryManager;
  SortComparator(  RecordComparator recordComparator,  PrefixComparator prefixComparator,  DataNodeMemoryManager memoryManager){
    this.recordComparator=recordComparator;
    this.prefixComparator=prefixComparator;
    this.memoryManager=memoryManager;
  }
  @Override public int compare(  RecordPointerAndKeyPrefix r1,  RecordPointerAndKeyPrefix r2){
    final int prefixComparisonResult=prefixComparator.compare(r1.keyPrefix,r2.keyPrefix);
    if (prefixComparisonResult == 0) {
      final Object baseObject1=memoryManager.getPage(r1.recordPointer);
      final long baseOffset1=memoryManager.getOffsetInPage(r1.recordPointer) + 4;
      final Object baseObject2=memoryManager.getPage(r2.recordPointer);
      final long baseOffset2=memoryManager.getOffsetInPage(r2.recordPointer) + 4;
      return recordComparator.compare(baseObject1,baseOffset1,baseObject2,baseOffset2);
    }
 else {
      return prefixComparisonResult;
    }
  }
}
