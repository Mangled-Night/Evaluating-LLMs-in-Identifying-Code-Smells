/** 
 * 获得下一个ID (该方法是线程安全的)
 * @return SnowflakeId
 */
public synchronized long nextId(){
  long timestamp=timeGen();
  if (timestamp < lastTimestamp) {
    throw new RuntimeException(String.format("Clock moved backwards.  Refusing to generate id for %d milliseconds",lastTimestamp - timestamp));
  }
  if (lastTimestamp == timestamp) {
    sequence=(sequence + 1) & sequenceMask;
    if (sequence == 0) {
      timestamp=tilNextMillis(lastTimestamp);
    }
  }
 else {
    sequence=0L;
  }
  lastTimestamp=timestamp;
  return ((timestamp - twepoch) << timestampLeftShift) | (datacenterId << datacenterIdShift) | (workerId << workerIdShift)| sequence;
}
