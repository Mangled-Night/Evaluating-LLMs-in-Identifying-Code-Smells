public class GsonPersistedDataWriter implements PersistedDataWriter<GsonPersistedData> {
  private final Gson gson;
  private final Charset charset;
  public GsonPersistedDataWriter(  Gson gson,  Charset charset){
    this.gson=gson;
    this.charset=charset;
  }
  public GsonPersistedDataWriter(  Gson gson){
    this(gson,StandardCharsets.UTF_8);
  }
  @Override public byte[] writeBytes(  GsonPersistedData data){
    return gson.toJson(data.getElement()).getBytes(charset);
  }
  @Override public void writeTo(  GsonPersistedData data,  OutputStream outputStream) throws IOException {
    try (JsonWriter writer=new JsonWriter(new OutputStreamWriter(outputStream))){
      gson.toJson(data.getElement(),writer);
    }
   }
}
