private Mono<StatefulRedisMasterReplicaConnection<K,V>> initializeConnection(RedisCodec<K,V> codec,SentinelTopologyRefresh sentinelTopologyRefresh,MasterReplicaConnectionProvider<K,V> connectionProvider,Runnable runnable,List<RedisNodeDescription> nodes){
  connectionProvider.setKnownNodes(nodes);
  MasterReplicaChannelWriter channelWriter=new MasterReplicaChannelWriter(connectionProvider,redisClient.getResources()){
    @Override public CompletableFuture<Void> closeAsync(){
      return CompletableFuture.allOf(super.closeAsync(),sentinelTopologyRefresh.closeAsync());
    }
  }
;
  StatefulRedisMasterReplicaConnectionImpl<K,V> connection=new StatefulRedisMasterReplicaConnectionImpl<>(channelWriter,codec,redisURI.getTimeout());
  connection.setOptions(redisClient.getOptions());
  CompletionStage<Void> bind=sentinelTopologyRefresh.bind(runnable);
  return Mono.fromCompletionStage(bind).onErrorResume(t -> {
    return ResumeAfter.close(connection).thenError(t);
  }
).then(Mono.just(connection));
}
