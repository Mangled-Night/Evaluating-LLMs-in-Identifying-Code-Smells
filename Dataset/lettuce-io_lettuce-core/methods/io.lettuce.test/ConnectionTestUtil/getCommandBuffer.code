/** 
 * Extract the command buffer from a  {@link StatefulConnection}.
 * @param connection the connection
 * @return the command buffer
 */
public static Queue<Object> getCommandBuffer(StatefulConnection<?,?> connection){
  RedisChannelWriter channelWriter=ConnectionTestUtil.getChannelWriter(connection);
  if (channelWriter instanceof DefaultEndpoint) {
    return (Queue)ReflectionTestUtils.getField(channelWriter,"commandBuffer");
  }
  throw new IllegalArgumentException("Cannot obtain command buffer from " + channelWriter);
}
