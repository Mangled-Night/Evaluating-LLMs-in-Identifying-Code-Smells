/** 
 * OMEMO encrypt a cleartext message for a single recipient. Note that this method does NOT set the 'to' attribute of the message.
 * @param recipient recipients bareJid
 * @param message text to encrypt
 * @return encrypted message
 * @throws CryptoFailedException                when something crypto related fails
 * @throws UndecidedOmemoIdentityException      When there are undecided devices
 * @throws InterruptedException if the calling thread was interrupted.
 * @throws SmackException.NotConnectedException if the XMPP connection is not connected.
 * @throws SmackException.NoResponseException if there was no response from the remote entity.
 * @throws SmackException.NotLoggedInException if the XMPP connection is not authenticated.
 * @throws IOException if an I/O error occurred.
 */
public OmemoMessage.Sent encrypt(BareJid recipient,String message) throws CryptoFailedException, UndecidedOmemoIdentityException, InterruptedException, SmackException.NotConnectedException, SmackException.NoResponseException, SmackException.NotLoggedInException, IOException {
  Set<BareJid> recipients=new HashSet<>();
  recipients.add(recipient);
  return encrypt(recipients,message);
}
/** 
 * OMEMO encrypt a cleartext message for multiple recipients.
 * @param recipients recipients barejids
 * @param message text to encrypt
 * @return encrypted message.
 * @throws CryptoFailedException    When something crypto related fails
 * @throws UndecidedOmemoIdentityException  When there are undecided devices.
 * @throws InterruptedException if the calling thread was interrupted.
 * @throws SmackException.NotConnectedException if the XMPP connection is not connected.
 * @throws SmackException.NoResponseException if there was no response from the remote entity.
 * @throws SmackException.NotLoggedInException if the XMPP connection is not authenticated.
 * @throws IOException if an I/O error occurred.
 */
public synchronized OmemoMessage.Sent encrypt(Set<BareJid> recipients,String message) throws CryptoFailedException, UndecidedOmemoIdentityException, InterruptedException, SmackException.NotConnectedException, SmackException.NoResponseException, SmackException.NotLoggedInException, IOException {
  LoggedInOmemoManager guard=new LoggedInOmemoManager(this);
  Set<OmemoDevice> devices=getDevicesOf(getOwnJid());
  for (  BareJid recipient : recipients) {
    devices.addAll(getDevicesOf(recipient));
  }
  return service.createOmemoMessage(guard,devices,message);
}
/** 
 * Encrypt a message for all recipients in the MultiUserChat.
 * @param muc multiUserChat
 * @param message message to send
 * @return encrypted message
 * @throws UndecidedOmemoIdentityException when there are undecided devices.
 * @throws CryptoFailedException if the OMEMO cryptography failed.
 * @throws XMPPException.XMPPErrorException if there was an XMPP error returned.
 * @throws SmackException.NotConnectedException if the XMPP connection is not connected.
 * @throws InterruptedException if the calling thread was interrupted.
 * @throws SmackException.NoResponseException if there was no response from the remote entity.
 * @throws NoOmemoSupportException When the muc doesn't support OMEMO.
 * @throws SmackException.NotLoggedInException if the XMPP connection is not authenticated.
 * @throws IOException if an I/O error occurred.
 */
public synchronized OmemoMessage.Sent encrypt(MultiUserChat muc,String message) throws UndecidedOmemoIdentityException, CryptoFailedException, XMPPException.XMPPErrorException, SmackException.NotConnectedException, InterruptedException, SmackException.NoResponseException, NoOmemoSupportException, SmackException.NotLoggedInException, IOException {
  if (!multiUserChatSupportsOmemo(muc)) {
    throw new NoOmemoSupportException();
  }
  Set<BareJid> recipients=new HashSet<>();
  for (  EntityFullJid e : muc.getOccupants()) {
    recipients.add(muc.getOccupant(e).getJid().asBareJid());
  }
  return encrypt(recipients,message);
}
