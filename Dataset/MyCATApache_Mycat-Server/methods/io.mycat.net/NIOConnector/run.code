@Override public void run(){
  int invalidSelectCount=0;
  for (; ; ) {
    try {
      final Selector tSelector=this.selector;
      ++connectCount;
      long start=System.nanoTime();
      tSelector.select(1000L);
      long end=System.nanoTime();
      connect(tSelector);
      Set<SelectionKey> keys=tSelector.selectedKeys();
      if (keys.size() == 0 && (end - start) < SelectorUtil.MIN_SELECT_TIME_IN_NANO_SECONDS) {
        invalidSelectCount++;
      }
 else {
        try {
          for (          SelectionKey key : keys) {
            Object att=key.attachment();
            if (att != null && key.isValid() && key.isConnectable()) {
              finishConnect(key,att);
            }
 else {
              key.cancel();
            }
          }
        }
  finally {
          invalidSelectCount=0;
          keys.clear();
        }
      }
      if (invalidSelectCount > SelectorUtil.REBUILD_COUNT_THRESHOLD) {
        final Selector rebuildSelector=SelectorUtil.rebuildSelector(this.selector);
        if (rebuildSelector != null) {
          this.selector=rebuildSelector;
        }
        invalidSelectCount=0;
      }
    }
 catch (    Exception e) {
      LOGGER.warn(name,e);
    }
catch (    final Throwable e) {
      LOGGER.warn("caught Throwable err: ",e);
    }
  }
}
