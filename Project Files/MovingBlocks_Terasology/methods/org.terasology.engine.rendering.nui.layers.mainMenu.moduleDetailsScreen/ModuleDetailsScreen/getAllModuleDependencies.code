private Set<Module> getAllModuleDependencies(final Collection<Module> modules){
  return modules.stream().filter(Objects::nonNull).map(Module::getMetadata).map(ModuleMetadata::getDependencies).flatMap(Collection::stream).filter(dep -> Objects.nonNull(dep.getId())).map(dep -> moduleManager.getRegistry().getLatestModuleVersion(dep.getId())).filter(Objects::nonNull).collect(Collectors.toSet());
}
