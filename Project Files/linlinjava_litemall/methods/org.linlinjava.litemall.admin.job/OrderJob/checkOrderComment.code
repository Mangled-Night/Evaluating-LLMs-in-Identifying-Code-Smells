/** 
 * 可评价订单商品超期 <p> 定时检查订单商品评价情况，如果确认商品超时 LITEMALL_ORDER_COMMENT 天则取消可评价状态 定时时间是每天凌晨4点。 <p> TODO 注意，因为是相隔一天检查，因此导致订单真正超时时间是 [LITEMALL_ORDER_COMMENT, 1 + LITEMALL_ORDER_COMMENT]
 */
@Scheduled(cron="0 0 4 * * ?") public void checkOrderComment(){
  logger.info("系统开启任务检查订单是否已经超期未评价");
  List<LitemallOrder> orderList=orderService.queryComment(SystemConfig.getOrderComment());
  for (  LitemallOrder order : orderList) {
    order.setComments((short)0);
    orderService.updateWithOptimisticLocker(order);
    List<LitemallOrderGoods> orderGoodsList=orderGoodsService.queryByOid(order.getId());
    for (    LitemallOrderGoods orderGoods : orderGoodsList) {
      orderGoods.setComment(-1);
      orderGoodsService.updateById(orderGoods);
    }
  }
  logger.info("系统结束任务检查订单是否已经超期未评价");
}
