/** 
 * Get the current items stored in the node.
 * @param < T > type of the items.
 * @return List of {@link Item} in the node
 * @throws XMPPErrorException if there was an XMPP error returned.
 * @throws NoResponseException if there was no response from the server.
 * @throws NotConnectedException if the XMPP connection is not connected.
 * @throws InterruptedException if the calling thread was interrupted.
 */
public <T extends Item>List<T> getItems() throws NoResponseException, XMPPErrorException, NotConnectedException, InterruptedException {
  return getItems((List<XmlElement>)null,null);
}
/** 
 * Get the current items stored in the node based on the subscription associated with the provided subscription id.
 * @param subscriptionId -  The subscription id for theassociated subscription.
 * @param < T > type of the items.
 * @return List of {@link Item} in the node
 * @throws XMPPErrorException if there was an XMPP error returned.
 * @throws NoResponseException if there was no response from the server.
 * @throws NotConnectedException if the XMPP connection is not connected.
 * @throws InterruptedException if the calling thread was interrupted.
 */
public <T extends Item>List<T> getItems(String subscriptionId) throws NoResponseException, XMPPErrorException, NotConnectedException, InterruptedException {
  PubSub request=createPubsubPacket(IQ.Type.get,new GetItemsRequest(getId(),subscriptionId));
  return getItems(request);
}
/** 
 * Get the items specified from the node.  This would typically be used when the server does not return the payload due to size constraints.  The user would be required to retrieve the payload after the items have been retrieved via  {@link #getItems()} or anevent, that did not include the payload.
 * @param ids Item ids of the items to retrieve
 * @param < T > type of the items.
 * @return The list of {@link Item} with payload
 * @throws XMPPErrorException if there was an XMPP error returned.
 * @throws NoResponseException if there was no response from the server.
 * @throws NotConnectedException if the XMPP connection is not connected.
 * @throws InterruptedException if the calling thread was interrupted.
 */
public <T extends Item>List<T> getItems(Collection<String> ids) throws NoResponseException, XMPPErrorException, NotConnectedException, InterruptedException {
  List<Item> itemList=new ArrayList<>(ids.size());
  for (  String id : ids) {
    itemList.add(new Item(id));
  }
  PubSub request=createPubsubPacket(IQ.Type.get,new ItemsExtension(ItemsExtension.ItemsElementType.items,getId(),itemList));
  return getItems(request);
}
/** 
 * Get items persisted on the node, limited to the specified number.
 * @param maxItems Maximum number of items to return
 * @param < T > type of the items.
 * @return List of {@link Item}
 * @throws XMPPErrorException if there was an XMPP error returned.
 * @throws NoResponseException if there was no response from the server.
 * @throws NotConnectedException if the XMPP connection is not connected.
 * @throws InterruptedException if the calling thread was interrupted.
 */
public <T extends Item>List<T> getItems(int maxItems) throws NoResponseException, XMPPErrorException, NotConnectedException, InterruptedException {
  PubSub request=createPubsubPacket(IQ.Type.get,new GetItemsRequest(getId(),maxItems));
  return getItems(request);
}
/** 
 * Get items persisted on the node, limited to the specified number based on the subscription associated with the provided subscriptionId.
 * @param maxItems Maximum number of items to return
 * @param subscriptionId The subscription which the retrieval is basedon.
 * @return List of {@link Item}
 * @param < T > type of the items.
 * @throws XMPPErrorException if there was an XMPP error returned.
 * @throws NoResponseException if there was no response from the server.
 * @throws NotConnectedException if the XMPP connection is not connected.
 * @throws InterruptedException if the calling thread was interrupted.
 */
public <T extends Item>List<T> getItems(int maxItems,String subscriptionId) throws NoResponseException, XMPPErrorException, NotConnectedException, InterruptedException {
  PubSub request=createPubsubPacket(IQ.Type.get,new GetItemsRequest(getId(),subscriptionId,maxItems));
  return getItems(request);
}
/** 
 * Get items persisted on the node. <p> {@code additionalExtensions} can be used e.g. to add a "Result Set Management" extension.{@code returnedExtensions} will be filled with the stanza extensions found in the answer.</p>
 * @param additionalExtensions additional {@code PacketExtensions} to be added to the request.This is an optional argument, if provided as null no extensions will be added.
 * @param returnedExtensions a collection that will be filled with the returned packetextensions. This is an optional argument, if provided as null it won't be populated.
 * @param < T > type of the items.
 * @return List of {@link Item}
 * @throws NoResponseException if there was no response from the remote entity.
 * @throws XMPPErrorException if there was an XMPP error returned.
 * @throws NotConnectedException if the XMPP connection is not connected.
 * @throws InterruptedException if the calling thread was interrupted.
 */
public <T extends Item>List<T> getItems(List<XmlElement> additionalExtensions,List<XmlElement> returnedExtensions) throws NoResponseException, XMPPErrorException, NotConnectedException, InterruptedException {
  PubSub request=createPubsubPacket(IQ.Type.get,new GetItemsRequest(getId()));
  request.addExtensions(additionalExtensions);
  return getItems(request,returnedExtensions);
}
private <T extends Item>List<T> getItems(PubSub request) throws NoResponseException, XMPPErrorException, NotConnectedException, InterruptedException {
  return getItems(request,null);
}
@SuppressWarnings("unchecked") private <T extends Item>List<T> getItems(PubSub request,List<XmlElement> returnedExtensions) throws NoResponseException, XMPPErrorException, NotConnectedException, InterruptedException {
  PubSub result=pubSubManager.getConnection().sendIqRequestAndWaitForResponse(request);
  ItemsExtension itemsElem=result.getExtension(PubSubElementType.ITEMS);
  if (returnedExtensions != null) {
    returnedExtensions.addAll(result.getExtensions());
  }
  return (List<T>)itemsElem.getItems();
}
