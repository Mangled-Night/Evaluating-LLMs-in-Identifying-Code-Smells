public class ModuleInstallManager {
  private ModuleManager moduleManager;
  private ModuleRegistry remoteRegistry;
  private ModuleListDownloader remoteRegistryUpdater;
  private ModuleDownloadListGenerator downloadListGenerator;
  ModuleInstallManager(  ModuleManager moduleManager,  String remoteMasterServerAddress){
    this.moduleManager=moduleManager;
    this.remoteRegistryUpdater=new ModuleListDownloader(remoteMasterServerAddress);
  }
  public Callable<Void> updateRemoteRegistry(){
    return (() -> {
      remoteRegistry=remoteRegistryUpdater.call();
      downloadListGenerator=new ModuleDownloadListGenerator(moduleManager.getRegistry(),new DependencyResolver(remoteRegistry));
      return null;
    }
);
  }
  public Collection<Module> getRemoteRegistry(){
    return Collections.unmodifiableCollection(remoteRegistry);
  }
  public Set<Module> getAllModulesToDownloadFor(  Name... modulesToInstall) throws DependencyResolutionFailedException {
    if (downloadListGenerator == null) {
      throw new DependencyResolutionFailedException("The online module list hasn't been downloaded.");
    }
    return downloadListGenerator.getAllModulesToDownloadFor(modulesToInstall);
  }
  public ModuleInstaller createInstaller(  Iterable<Module> modules,  MultiFileTransferProgressListener progressListener){
    return new ModuleInstaller(moduleManager,modules,progressListener);
  }
}
