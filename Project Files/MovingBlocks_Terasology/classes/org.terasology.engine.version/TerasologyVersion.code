public final class TerasologyVersion {
  private static final Logger logger=LoggerFactory.getLogger(TerasologyVersion.class);
  private static TerasologyVersion instance;
  private static final String VERSION_INFO_FILE="versionInfo.properties";
  private static final String BUILD_NUMBER="buildNumber";
  private static final String BUILD_ID="buildId";
  private static final String BUILD_TAG="buildTag";
  private static final String BUILD_URL="buildUrl";
  private static final String JOB_NAME="jobName";
  private static final String DATE_TIME="dateTime";
  private static final String DISPLAY_VERSION="displayVersion";
  private static final String ENGINE_VERSION="engineVersion";
  private static final String DEFAULT_VALUE="";
  private final String buildNumber;
  private final String buildId;
  private final String buildTag;
  private final String buildUrl;
  private final String jobName;
  private final String dateTime;
  private final String toString;
  private final String displayVersion;
  private final String engineVersion;
  private TerasologyVersion(){
    final Properties properties=new Properties();
    try (InputStream inStream=this.getClass().getResourceAsStream(VERSION_INFO_FILE)){
      if (inStream != null) {
        properties.load(inStream);
      }
 else {
        logger.warn("No resource found for {}",VERSION_INFO_FILE);
      }
    }
 catch (    final IOException e) {
      logger.error("Loading {} failed",VERSION_INFO_FILE,e);
    }
    buildNumber=properties.getProperty(BUILD_NUMBER,DEFAULT_VALUE);
    buildId=properties.getProperty(BUILD_ID,DEFAULT_VALUE);
    buildTag=properties.getProperty(BUILD_TAG,DEFAULT_VALUE);
    buildUrl=properties.getProperty(BUILD_URL,DEFAULT_VALUE);
    jobName=properties.getProperty(JOB_NAME,DEFAULT_VALUE);
    dateTime=properties.getProperty(DATE_TIME,DEFAULT_VALUE);
    displayVersion=properties.getProperty(DISPLAY_VERSION,DEFAULT_VALUE);
    engineVersion=properties.getProperty(ENGINE_VERSION,DEFAULT_VALUE);
    final StringBuilder toStringBuilder=new StringBuilder();
    toStringBuilder.append("[");
    toStringBuilder.append(BUILD_NUMBER);
    toStringBuilder.append("=");
    toStringBuilder.append(buildNumber);
    toStringBuilder.append(", ");
    toStringBuilder.append(BUILD_ID);
    toStringBuilder.append("=");
    toStringBuilder.append(buildId);
    toStringBuilder.append(", ");
    toStringBuilder.append(BUILD_TAG);
    toStringBuilder.append("=");
    toStringBuilder.append(buildTag);
    toStringBuilder.append(", ");
    toStringBuilder.append(BUILD_URL);
    toStringBuilder.append("=");
    toStringBuilder.append(buildUrl);
    toStringBuilder.append(", ");
    toStringBuilder.append(JOB_NAME);
    toStringBuilder.append("=");
    toStringBuilder.append(jobName);
    toStringBuilder.append(", ");
    toStringBuilder.append(DATE_TIME);
    toStringBuilder.append("=");
    toStringBuilder.append(dateTime);
    toStringBuilder.append(", ");
    toStringBuilder.append(DISPLAY_VERSION);
    toStringBuilder.append("=");
    toStringBuilder.append(displayVersion);
    toStringBuilder.append(", ");
    toStringBuilder.append(ENGINE_VERSION);
    toStringBuilder.append("=");
    toStringBuilder.append(engineVersion);
    toStringBuilder.append("]");
    toString=toStringBuilder.toString();
  }
  public static TerasologyVersion getInstance(){
    if (instance == null) {
      instance=new TerasologyVersion();
    }
    return instance;
  }
  public String getBuildNumber(){
    return buildNumber;
  }
  public String getBuildId(){
    return buildId;
  }
  public String getBuildTag(){
    return buildTag;
  }
  public String getBuildUrl(){
    return buildUrl;
  }
  public String getJobName(){
    return jobName;
  }
  public String getDateTime(){
    return dateTime;
  }
  public String getDisplayVersion(){
    return displayVersion;
  }
  public String getengineVersion(){
    return engineVersion;
  }
  /** 
 * Makes a pretty version string for displaying to human users
 * @return prettified version String
 */
  public String getHumanVersion(){
    String humanVersion="";
    TerasologyVersion ver=getInstance();
    if (!ver.getDisplayVersion().trim().equals("")) {
      humanVersion=displayVersion.toUpperCase() + " ";
    }
    String formattedDate="";
    if (ver.getDateTime().trim().length() > 10) {
      formattedDate+=ver.getDateTime().substring(0,10);
    }
    if (jobName.equals("Terasology/engine/master")) {
      humanVersion+="Release \n(engine v" + engineVersion + ", build "+ buildNumber+ ", "+ formattedDate+ ")";
    }
 else     if (jobName.equals("Terasology/engine/develop")) {
      humanVersion+="Preview \n(engine v" + engineVersion + ", dev build "+ buildNumber+ ", "+ formattedDate+ ")";
    }
 else     if (!jobName.equals("")) {
      humanVersion+="Special: " + jobName + "\n(engine v"+ engineVersion+ ", build "+ buildNumber+ ", "+ formattedDate+ ")";
    }
 else {
      humanVersion+="Custom version - running from source or hand-built";
    }
    return humanVersion;
  }
  @Override public String toString(){
    return toString;
  }
}
