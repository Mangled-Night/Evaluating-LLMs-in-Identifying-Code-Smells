public class PlayerSettingsScreen extends CoreScreenLayer {
  public static final ResourceUrn ASSET_URI=new ResourceUrn("engine:PlayerMenuScreen");
  @In private Context context;
  @In private PlayerConfig config;
  @In private SystemConfig systemConfig;
  @In private TranslationSystem translationSystem;
  @In private StorageServiceWorker storageService;
  private UILabel storageServiceStatus;
  private UIButton storageServiceAction;
  private StorageServiceWorkerStatus storageServiceWorkerStatus;
  @Override public void onOpened(){
    super.onOpened();
  }
  @Override public void initialise(){
    setAnimationSystem(MenuAnimationSystems.createDefaultSwipeAnimation());
    storageServiceStatus=find("storageServiceStatus",UILabel.class);
    storageServiceAction=find("storageServiceAction",UIButton.class);
    updateStorageServiceStatus();
    WidgetUtil.trySubscribe(this,"close",button -> triggerBackAnimation());
    IdentityIOHelper identityIOHelper=new IdentityIOHelper(context);
    WidgetUtil.trySubscribe(this,"importIdentities",button -> identityIOHelper.importIdentities());
    WidgetUtil.trySubscribe(this,"exportIdentities",button -> identityIOHelper.exportIdentities());
    WidgetUtil.trySubscribe(this,"storageServiceAction",widget -> {
      if (storageService.getStatus() == StorageServiceWorkerStatus.LOGGED_IN) {
        ThreeButtonPopup logoutPopup=getManager().pushScreen(ThreeButtonPopup.ASSET_URI,ThreeButtonPopup.class);
        logoutPopup.setMessage(translationSystem.translate("${engine:menu#storage-service-log-out}"),translationSystem.translate("${engine:menu#storage-service-log-out-popup}"));
        logoutPopup.setLeftButton(translationSystem.translate("${engine:menu#dialog-yes}"),() -> storageService.logout(true));
        logoutPopup.setCenterButton(translationSystem.translate("${engine:menu#dialog-no}"),() -> storageService.logout(false));
        logoutPopup.setRightButton(translationSystem.translate("${engine:menu#dialog-cancel}"),() -> {
        }
);
      }
 else       if (storageService.getStatus() == StorageServiceWorkerStatus.LOGGED_OUT) {
        getManager().pushScreen(StorageServiceLoginPopup.ASSET_URI,StorageServiceLoginPopup.class);
      }
    }
);
  }
  @Override public void update(  float delta){
    super.update(delta);
    if (storageService.getStatus() != storageServiceWorkerStatus) {
      updateStorageServiceStatus();
    }
  }
  private void updateStorageServiceStatus(){
    StorageServiceWorkerStatus stat=storageService.getStatus();
    storageServiceStatus.setText(getLocalizedStatusMessage(stat,translationSystem,storageService.getLoginName()));
    storageServiceAction.setText(getLocalizedButtonMessage(stat,translationSystem));
    storageServiceAction.setVisible(stat.isButtonEnabled());
    storageServiceWorkerStatus=stat;
  }
  @Override public boolean isLowerLayerVisible(){
    return false;
  }
}
