/** 
 * mall-security模块相关配置 Created by macro on 2019/11/9.
 */
@Configuration public class MallSecurityConfig {
  @Autowired private UmsAdminService adminService;
  @Autowired private UmsResourceService resourceService;
  @Bean public UserDetailsService userDetailsService(){
    return username -> adminService.loadUserByUsername(username);
  }
  @Bean public DynamicSecurityService dynamicSecurityService(){
    return new DynamicSecurityService(){
      @Override public Map<String,ConfigAttribute> loadDataSource(){
        Map<String,ConfigAttribute> map=new ConcurrentHashMap<>();
        List<UmsResource> resourceList=resourceService.listAll();
        for (        UmsResource resource : resourceList) {
          map.put(resource.getUrl(),new org.springframework.security.access.SecurityConfig(resource.getId() + ":" + resource.getName()));
        }
        return map;
      }
    }
;
  }
}
