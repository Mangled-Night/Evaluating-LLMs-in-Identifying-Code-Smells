/** 
 * A SOCKS5 client MUST close connection if server doesn't accept any of the given authentication methods. (See RFC1928 Section 3)
 * @throws Exception should not happen
 */
@Test public void shouldCloseSocketIfServerDoesNotAcceptAuthenticationMethod() throws Exception {
  Thread serverThread=new Thread(){
    @Override public void run(){
      StreamHost streamHost=new StreamHost(proxyJID,serverAddress,serverPort);
      Socks5Client socks5Client=new Socks5Client(streamHost,digest);
      try {
        socks5Client.getSocket(10000);
        fail("exception should be thrown");
      }
 catch (      SmackException e) {
        assertTrue(e.getMessage().contains("SOCKS5 negotiation failed"));
      }
catch (      Exception e) {
        fail(e.getMessage());
      }
    }
  }
;
  serverThread.start();
  Socket socket=serverSocket.accept();
  DataInputStream in=new DataInputStream(socket.getInputStream());
  DataOutputStream out=new DataOutputStream(socket.getOutputStream());
  assertEquals((byte)0x05,(byte)in.read());
  assertEquals((byte)0x01,(byte)in.read());
  assertEquals((byte)0x00,(byte)in.read());
  out.write(new byte[]{(byte)0x05,(byte)0xFF});
  out.flush();
  serverThread.join();
  assertEquals(-1,in.read());
}
