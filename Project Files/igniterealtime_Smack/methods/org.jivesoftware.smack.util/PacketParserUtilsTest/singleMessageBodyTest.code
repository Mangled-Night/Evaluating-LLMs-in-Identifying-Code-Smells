@ParameterizedTest @EnumSource(SmackTestUtil.XmlPullParserKind.class) public void singleMessageBodyTest(SmackTestUtil.XmlPullParserKind parserKind) throws Exception {
  String defaultLanguage=Stanza.getDefaultLanguage();
  String otherLanguage=determineNonDefaultLanguage();
  String control;
  control=XMLBuilder.create("message").namespace(StreamOpen.CLIENT_NAMESPACE).a("from","romeo@montague.lit/orchard").a("to","juliet@capulet.lit/balcony").a("id","zid615d9").a("type","chat").a("xml:lang",defaultLanguage).e("body").t(defaultLanguage).asString(outputProperties);
  Message message=PacketParserUtils.parseMessage(SmackTestUtil.getParserFor(control,parserKind));
  assertEquals(defaultLanguage,message.getBody());
  assertTrue(message.getBodyLanguages().isEmpty());
  assertEquals(defaultLanguage,message.getBody(defaultLanguage));
  assertNull(message.getBody(otherLanguage));
  assertXmlSimilar(control,message.toXML().toString());
  control=XMLBuilder.create("message").namespace(StreamOpen.CLIENT_NAMESPACE).a("from","romeo@montague.lit/orchard").a("to","juliet@capulet.lit/balcony").a("id","zid615d9").a("type","chat").a("xml:lang",otherLanguage).e("body").t(otherLanguage).asString(outputProperties);
  message=PacketParserUtils.parseMessage(SmackTestUtil.getParserFor(control,parserKind));
  assertEquals(otherLanguage,message.getBody());
  assertTrue(message.getBodyLanguages().isEmpty());
  assertEquals(otherLanguage,message.getBody(otherLanguage));
  assertNull(message.getBody(defaultLanguage));
  assertXmlSimilar(control,message.toXML().toString());
  control=XMLBuilder.create("message").namespace(StreamOpen.CLIENT_NAMESPACE).a("from","romeo@montague.lit/orchard").a("to","juliet@capulet.lit/balcony").a("id","zid615d9").a("type","chat").e("body").t(defaultLanguage).asString(outputProperties);
  message=PacketParserUtils.parseMessage(SmackTestUtil.getParserFor(control,parserKind));
  assertEquals(defaultLanguage,message.getBody());
  assertTrue(message.getBodyLanguages().isEmpty());
  assertEquals(defaultLanguage,message.getBody(null));
  assertNull(message.getBody(otherLanguage));
  assertXmlSimilar(control,message.toXML().toString());
  control=XMLBuilder.create("message").namespace(StreamOpen.CLIENT_NAMESPACE).a("from","romeo@montague.lit/orchard").a("to","juliet@capulet.lit/balcony").a("id","zid615d9").a("type","chat").e("body").a("xml:lang",defaultLanguage).t(defaultLanguage).asString(outputProperties);
  message=PacketParserUtils.parseMessage(SmackTestUtil.getParserFor(control,parserKind));
  assertNull(message.getBody());
  assertFalse(message.getBodyLanguages().isEmpty());
  assertEquals(defaultLanguage,message.getBody(defaultLanguage));
  assertNull(message.getBody(otherLanguage));
  assertXmlSimilar(control,message.toXML().toString());
  control=XMLBuilder.create("message").namespace(StreamOpen.CLIENT_NAMESPACE).a("from","romeo@montague.lit/orchard").a("to","juliet@capulet.lit/balcony").a("id","zid615d9").a("type","chat").e("body").a("xml:lang",otherLanguage).t(otherLanguage).asString(outputProperties);
  message=PacketParserUtils.parseMessage(SmackTestUtil.getParserFor(control,parserKind));
  assertNull(message.getBody());
  assertFalse(message.getBodyLanguages().isEmpty());
  assertTrue(message.getBodyLanguages().contains(otherLanguage));
  assertEquals(otherLanguage,message.getBody(otherLanguage));
  assertNull(message.getBody(defaultLanguage));
  assertXmlSimilar(control,message.toXML().toString());
  control=XMLBuilder.create("message").namespace(StreamOpen.CLIENT_NAMESPACE).a("from","romeo@montague.lit/orchard").a("to","juliet@capulet.lit/balcony").a("id","zid615d9").a("type","chat").a("xml:lang",defaultLanguage).e("body").a("xml:lang",otherLanguage).t(otherLanguage).asString(outputProperties);
  message=PacketParserUtils.parseMessage(SmackTestUtil.getParserFor(control,parserKind));
  assertNull(message.getBody());
  assertFalse(message.getBodyLanguages().isEmpty());
  assertTrue(message.getBodyLanguages().contains(otherLanguage));
  assertEquals(otherLanguage,message.getBody(otherLanguage));
  assertNull(message.getBody(defaultLanguage));
  assertXmlSimilar(control,message.toXML().toString());
  control=XMLBuilder.create("message").namespace(StreamOpen.CLIENT_NAMESPACE).a("from","romeo@montague.lit/orchard").a("to","juliet@capulet.lit/balcony").a("id","zid615d9").a("type","chat").a("xml:lang",otherLanguage).e("body").a("xml:lang",defaultLanguage).t(defaultLanguage).asString(outputProperties);
  message=PacketParserUtils.parseMessage(SmackTestUtil.getParserFor(control,parserKind));
  assertNull(message.getBody());
  assertFalse(message.getBodyLanguages().isEmpty());
  assertTrue(message.getBodyLanguages().contains(defaultLanguage));
  assertEquals(defaultLanguage,message.getBody(defaultLanguage));
  assertNull(message.getBody(otherLanguage));
  assertXmlSimilar(control,message.toXML().toString());
}
