/** 
 * Test the output stream flush() method.
 * @throws Exception should not happen
 */
@Test public void shouldSendThirtyDataPackets() throws Exception {
  byte[] controlData=new byte[blockSize * 3];
  InBandBytestreamSession session=new InBandBytestreamSession(connection,initBytestream,initiatorJID);
  IQ resultIQ=IBBPacketUtils.createResultIQ(initiatorJID,targetJID);
  for (int i=0; i < controlData.length; i++) {
    protocol.addResponse(resultIQ,incrementingSequence);
  }
  OutputStream outputStream=session.getOutputStream();
  for (  byte b : controlData) {
    outputStream.write(b);
    outputStream.flush();
  }
  protocol.verifyAll();
}
