private static <T>List<T> drainCommands(Queue<T> source){
  List<T> target=new ArrayList<>(source.size());
  T cmd;
  while ((cmd=source.poll()) != null) {
    target.add(cmd);
  }
  return target;
}
