/** 
 * An ObservableReader is a wrapper on a Reader that notifies to its listeners when reading character streams.
 * @author Gaston Dombiak
 */
public class ObservableReader extends Reader {
  Reader wrappedReader=null;
  final List<ReaderListener> listeners=new ArrayList<ReaderListener>();
  public ObservableReader(  Reader wrappedReader){
    this.wrappedReader=wrappedReader;
  }
  @Override public int read(  char[] cbuf,  int off,  int len) throws IOException {
    int count=wrappedReader.read(cbuf,off,len);
    if (count > 0) {
      String str=new String(cbuf,off,count);
      ReaderListener[] readerListeners=null;
synchronized (listeners) {
        readerListeners=new ReaderListener[listeners.size()];
        listeners.toArray(readerListeners);
      }
      for (int i=0; i < readerListeners.length; i++) {
        readerListeners[i].read(str);
      }
    }
    return count;
  }
  @Override public void close() throws IOException {
    wrappedReader.close();
  }
  @Override public int read() throws IOException {
    return wrappedReader.read();
  }
  @Override public int read(  char[] cbuf) throws IOException {
    return wrappedReader.read(cbuf);
  }
  @Override public long skip(  long n) throws IOException {
    return wrappedReader.skip(n);
  }
  @Override public boolean ready() throws IOException {
    return wrappedReader.ready();
  }
  @Override public boolean markSupported(){
    return wrappedReader.markSupported();
  }
  @Override public void mark(  int readAheadLimit) throws IOException {
    wrappedReader.mark(readAheadLimit);
  }
  @Override public void reset() throws IOException {
    wrappedReader.reset();
  }
  /** 
 * Adds a reader listener to this reader that will be notified when new strings are read.
 * @param readerListener a reader listener.
 */
  public void addReaderListener(  ReaderListener readerListener){
    if (readerListener == null) {
      return;
    }
synchronized (listeners) {
      if (!listeners.contains(readerListener)) {
        listeners.add(readerListener);
      }
    }
  }
  /** 
 * Removes a reader listener from this reader.
 * @param readerListener a reader listener.
 */
  public void removeReaderListener(  ReaderListener readerListener){
synchronized (listeners) {
      listeners.remove(readerListener);
    }
  }
}
