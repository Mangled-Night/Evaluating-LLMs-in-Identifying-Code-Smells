static class Handler implements JsonSerializer<BindsConfig>, JsonDeserializer<BindsConfig> {
  @Override public BindsConfig deserialize(  JsonElement json,  Type typeOfT,  JsonDeserializationContext context) throws JsonParseException {
    BindsConfig result=new BindsConfig();
    JsonObject inputObj=json.getAsJsonObject();
    for (    Map.Entry<String,JsonElement> entry : inputObj.entrySet()) {
      SetMultimap<String,Input> map=context.deserialize(entry.getValue(),SetMultimap.class);
      for (      String id : map.keySet()) {
        SimpleUri uri=new SimpleUri(new Name(entry.getKey()),id);
        result.uriBoundInputs.putAll(uri,map.get(id));
      }
    }
    return result;
  }
  @Override public JsonElement serialize(  BindsConfig bindsConfig,  Type typeOfBindsConfig,  JsonSerializationContext context){
    JsonObject result=new JsonObject();
    SetMultimap<Name,SimpleUri> bindingByModuleName=listBindingsByModuleName(bindsConfig);
    List<Name> sortedModuleNames=bindingByModuleName.keySet().stream().sorted().collect(toList());
    for (    Name moduleName : sortedModuleNames) {
      SetMultimap<String,Input> moduleBinds=HashMultimap.create();
      for (      SimpleUri bindingUri : bindingByModuleName.get(moduleName)) {
        moduleBinds.putAll(bindingUri.getObjectName().toString(),bindsConfig.uriBoundInputs.get(bindingUri));
      }
      JsonElement map=context.serialize(moduleBinds,SetMultimap.class);
      result.add(moduleName.toString(),map);
    }
    return result;
  }
  public SetMultimap<Name,SimpleUri> listBindingsByModuleName(  BindsConfig src){
    SetMultimap<Name,SimpleUri> bindingByModuleName=HashMultimap.create();
    for (    SimpleUri bindingUri : src.uriBoundInputs.keySet()) {
      bindingByModuleName.put(bindingUri.getModuleName(),bindingUri);
    }
    return bindingByModuleName;
  }
}
public static class Handler implements JsonSerializer<SecurityConfig>, JsonDeserializer<SecurityConfig> {
  public static final String SERVER_PUBLIC_CERTIFICATE="serverPublicCertificate";
  public static final String SERVER_PRIVATE_CERTIFICATE="serverPrivateCertificate";
  public static final String CLIENT_IDENTITIES="clientIdentities";
  @Override public SecurityConfig deserialize(  JsonElement json,  Type typeOfT,  JsonDeserializationContext context) throws JsonParseException {
    SecurityConfig result=new SecurityConfig();
    JsonObject jsonObject=json.getAsJsonObject();
    if (jsonObject.has(SERVER_PUBLIC_CERTIFICATE)) {
      result.serverPublicCertificate=context.deserialize(jsonObject.getAsJsonObject(SERVER_PUBLIC_CERTIFICATE),PublicIdentityCertificate.class);
    }
    if (jsonObject.has(SERVER_PRIVATE_CERTIFICATE)) {
      result.serverPrivateCertificate=context.deserialize(jsonObject.getAsJsonObject(SERVER_PRIVATE_CERTIFICATE),PrivateIdentityCertificate.class);
    }
    if (jsonObject.has(CLIENT_IDENTITIES)) {
      JsonArray clientArray=jsonObject.getAsJsonArray(CLIENT_IDENTITIES);
      for (      JsonElement jsonEntry : clientArray) {
        ClientEntry entry=context.deserialize(jsonEntry,ClientEntry.class);
        result.addIdentity(entry.server,new ClientIdentity(entry.clientPublic,entry.clientPrivate));
      }
    }
    return result;
  }
  @Override public JsonElement serialize(  SecurityConfig src,  Type typeOfSrc,  JsonSerializationContext context){
    JsonObject result=new JsonObject();
    result.add(SERVER_PUBLIC_CERTIFICATE,context.serialize(src.serverPublicCertificate));
    result.add(SERVER_PRIVATE_CERTIFICATE,context.serialize(src.serverPrivateCertificate));
    JsonArray clientArray=new JsonArray();
    for (    Map.Entry<PublicIdentityCertificate,ClientIdentity> entry : src.clientCertificates.entrySet()) {
      ClientEntry clientEntry=new ClientEntry();
      clientEntry.server=entry.getKey();
      clientEntry.clientPublic=entry.getValue().getPlayerPublicCertificate();
      clientEntry.clientPrivate=entry.getValue().getPlayerPrivateCertificate();
      clientArray.add(context.serialize(clientEntry));
    }
    result.add(CLIENT_IDENTITIES,clientArray);
    return result;
  }
}
