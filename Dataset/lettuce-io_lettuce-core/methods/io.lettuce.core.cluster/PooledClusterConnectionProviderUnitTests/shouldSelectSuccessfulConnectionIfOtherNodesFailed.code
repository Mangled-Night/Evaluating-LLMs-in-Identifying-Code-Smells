@Test void shouldSelectSuccessfulConnectionIfOtherNodesFailed(){
  CompletableFuture<StatefulRedisConnection<String,String>> failed=new CompletableFuture<>();
  failed.completeExceptionally(new IllegalStateException());
  when(clientMock.connectToNodeAsync(eq(StringCodec.UTF8),eq("localhost:1"),any(),any())).thenReturn(ConnectionFuture.from(socketAddressMock,failed));
  when(clientMock.connectToNodeAsync(eq(StringCodec.UTF8),eq("localhost:2"),any(),any())).thenReturn(ConnectionFuture.from(socketAddressMock,CompletableFuture.completedFuture(nodeConnectionMock)));
  AsyncCommand<String,String,String> async=new AsyncCommand<>(new Command<>(CommandType.READONLY,null,null));
  async.complete("OK");
  when(asyncCommandsMock.readOnly()).thenReturn(async);
  sut.setReadFrom(ReadFrom.UPSTREAM_PREFERRED);
  assertThat(sut.getConnection(ConnectionIntent.READ,1)).isNotNull().isSameAs(nodeConnectionMock);
  assertThat(sut.getConnection(ConnectionIntent.READ,1)).isNotNull().isSameAs(nodeConnectionMock);
  verify(clientMock).connectToNodeAsync(eq(StringCodec.UTF8),eq("localhost:1"),any(),any());
  verify(clientMock).connectToNodeAsync(eq(StringCodec.UTF8),eq("localhost:2"),any(),any());
}
