/** 
 * The most commonly used implementation of  {@link WorldGenerator} based on the idea of Facets
 */
public abstract class BaseFacetedWorldGenerator implements ScalableWorldGenerator {
  protected WorldBuilder worldBuilder;
  private final SimpleUri uri;
  private String worldSeed;
  private World world;
  private FacetedWorldConfigurator configurator;
  public BaseFacetedWorldGenerator(  SimpleUri uri){
    this.uri=uri;
  }
  @Override public final SimpleUri getUri(){
    return uri;
  }
  @Override public String getWorldSeed(){
    return worldSeed;
  }
  @Override public void setWorldSeed(  final String seed){
    worldSeed=seed;
    getWorldBuilder().setSeed(seed.hashCode());
    world=null;
  }
  /** 
 * @return New {@link WorldBuilder} for building the current world
 */
  protected abstract WorldBuilder createWorld();
  @Override public void initialize(){
    getWorld().initialize();
  }
  @Override public void createChunk(  Chunk chunk,  EntityBuffer buffer){
    world.rasterizeChunk(chunk,buffer);
  }
  @Override public void createChunk(  Chunk chunk,  float scale){
    world.rasterizeChunk(chunk,scale);
  }
  @Override public WorldConfigurator getConfigurator(){
    if (configurator == null) {
      configurator=getWorldBuilder().createConfigurator();
    }
    return configurator;
  }
  @Override public World getWorld(){
    if (world == null) {
      world=getWorldBuilder().build();
    }
    return world;
  }
  /** 
 * Returns current  {@link WorldBuilder} or a new one if none has been created so far
 * @return WorldBuilder used by this WorldGenerator
 */
  private WorldBuilder getWorldBuilder(){
    if (worldBuilder == null) {
      worldBuilder=createWorld();
    }
    return worldBuilder;
  }
  @Override public List<Zone> getZones(){
    return getWorldBuilder().getChildZones();
  }
  @Override public Zone getNamedZone(  String name){
    return getWorldBuilder().getChildZone(name);
  }
}
