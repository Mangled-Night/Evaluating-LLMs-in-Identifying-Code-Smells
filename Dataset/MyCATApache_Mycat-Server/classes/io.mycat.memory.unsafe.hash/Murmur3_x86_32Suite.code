/** 
 * Test file based on Guava's Murmur3Hash32Test.
 */
public class Murmur3_x86_32Suite {
  private static final Murmur3_x86_32 hasher=new Murmur3_x86_32(0);
  @Test public void testKnownIntegerInputs(){
    Assert.assertEquals(593689054,hasher.hashInt(0));
    Assert.assertEquals(-189366624,hasher.hashInt(-42));
    Assert.assertEquals(-1134849565,hasher.hashInt(42));
    Assert.assertEquals(-1718298732,hasher.hashInt(Integer.MIN_VALUE));
    Assert.assertEquals(-1653689534,hasher.hashInt(Integer.MAX_VALUE));
  }
  @Test public void testKnownLongInputs(){
    Assert.assertEquals(1669671676,hasher.hashLong(0L));
    Assert.assertEquals(-846261623,hasher.hashLong(-42L));
    Assert.assertEquals(1871679806,hasher.hashLong(42L));
    Assert.assertEquals(1366273829,hasher.hashLong(Long.MIN_VALUE));
    Assert.assertEquals(-2106506049,hasher.hashLong(Long.MAX_VALUE));
  }
  @Test public void randomizedStressTest(){
    int size=65536;
    Random rand=new Random();
    Set<Integer> hashcodes=new HashSet<Integer>();
    for (int i=0; i < size; i++) {
      int vint=rand.nextInt();
      long lint=rand.nextLong();
      Assert.assertEquals(hasher.hashInt(vint),hasher.hashInt(vint));
      Assert.assertEquals(hasher.hashLong(lint),hasher.hashLong(lint));
      hashcodes.add(hasher.hashLong(lint));
    }
    Assert.assertTrue(hashcodes.size() > size * 0.95);
  }
  @Test public void randomizedStressTestBytes(){
    int size=65536;
    Random rand=new Random();
    Set<Integer> hashcodes=new HashSet<Integer>();
    for (int i=0; i < size; i++) {
      int byteArrSize=rand.nextInt(100) * 8;
      byte[] bytes=new byte[byteArrSize];
      rand.nextBytes(bytes);
      Assert.assertEquals(hasher.hashUnsafeWords(bytes,Platform.BYTE_ARRAY_OFFSET,byteArrSize),hasher.hashUnsafeWords(bytes,Platform.BYTE_ARRAY_OFFSET,byteArrSize));
      hashcodes.add(hasher.hashUnsafeWords(bytes,Platform.BYTE_ARRAY_OFFSET,byteArrSize));
    }
    Assert.assertTrue(hashcodes.size() > size * 0.95);
  }
  @Test public void randomizedStressTestPaddedStrings(){
    int size=64000;
    Set<Integer> hashcodes=new HashSet<Integer>();
    for (int i=0; i < size; i++) {
      int byteArrSize=8;
      byte[] strBytes=String.valueOf(i).getBytes(StandardCharsets.UTF_8);
      byte[] paddedBytes=new byte[byteArrSize];
      System.arraycopy(strBytes,0,paddedBytes,0,strBytes.length);
      Assert.assertEquals(hasher.hashUnsafeWords(paddedBytes,Platform.BYTE_ARRAY_OFFSET,byteArrSize),hasher.hashUnsafeWords(paddedBytes,Platform.BYTE_ARRAY_OFFSET,byteArrSize));
      hashcodes.add(hasher.hashUnsafeWords(paddedBytes,Platform.BYTE_ARRAY_OFFSET,byteArrSize));
    }
    Assert.assertTrue(hashcodes.size() > size * 0.95);
  }
}
