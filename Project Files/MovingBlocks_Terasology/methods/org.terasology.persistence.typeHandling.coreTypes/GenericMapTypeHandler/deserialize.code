@Override public Optional<Map<K,V>> deserialize(PersistedData data){
  if (!data.isArray() || data.isValueMap()) {
    logger.warn("Incorrect map format detected: object instead of array.\n" + getUsageInfo(data));
    return Optional.empty();
  }
  Map<K,V> result=Maps.newLinkedHashMap();
  for (  PersistedData entry : data.getAsArray()) {
    PersistedDataMap kvEntry=entry.getAsValueMap();
    PersistedData rawKey=kvEntry.get(KEY);
    PersistedData rawValue=kvEntry.get(VALUE);
    if (rawKey == null || rawValue == null) {
      logger.warn("Incorrect map format detected: missing map entry with \"key\" or \"value\" key.\n" + getUsageInfo(data));
      return Optional.empty();
    }
    final Optional<K> key=keyHandler.deserialize(rawKey);
    if (key.isEmpty()) {
      logger.warn("Could not deserialize key '{}' as '{}'",rawKey,keyHandler.getClass().getSimpleName());
      return Optional.empty();
    }
    final Optional<V> value=valueHandler.deserialize(kvEntry.get(VALUE));
    if (value.isEmpty()) {
      logger.warn("Could not deserialize value '{}' as '{}'",rawValue,valueHandler.getClass().getSimpleName());
      return Optional.empty();
    }
    result.put(key.get(),value.get());
  }
  return Optional.of(result);
}
