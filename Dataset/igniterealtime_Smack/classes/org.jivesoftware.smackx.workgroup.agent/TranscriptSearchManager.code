/** 
 * A TranscriptSearchManager helps to retrieve the form to use for searching transcripts {@link #getSearchForm(DomainBareJid)} or to submit a search form and return the results ofthe search  {@link #submitSearch(DomainBareJid,FillableForm)}.
 * @author Gaston Dombiak
 */
public class TranscriptSearchManager {
  private final XMPPConnection connection;
  public TranscriptSearchManager(  XMPPConnection connection){
    this.connection=connection;
  }
  /** 
 * Returns the Form to use for searching transcripts. It is unlikely that the server will change the form (without a restart) so it is safe to keep the returned form for future submissions.
 * @param serviceJID the address of the workgroup service.
 * @return the Form to use for searching transcripts.
 * @throws XMPPErrorException if there was an XMPP error returned.
 * @throws NoResponseException if there was no response from the remote entity.
 * @throws NotConnectedException if the XMPP connection is not connected.
 * @throws InterruptedException if the calling thread was interrupted.
 */
  public Form getSearchForm(  DomainBareJid serviceJID) throws NoResponseException, XMPPErrorException, NotConnectedException, InterruptedException {
    TranscriptSearch search=new TranscriptSearch();
    search.setType(IQ.Type.get);
    search.setTo(serviceJID);
    TranscriptSearch response=connection.sendIqRequestAndWaitForResponse(search);
    return Form.from(response);
  }
  /** 
 * Submits the completed form and returns the result of the transcript search. The result will include all the data returned from the server so be careful with the amount of data that the search may return.
 * @param serviceJID    the address of the workgroup service.
 * @param completedForm the filled out search form.
 * @return the result of the transcript search.
 * @throws XMPPErrorException if there was an XMPP error returned.
 * @throws NoResponseException if there was no response from the remote entity.
 * @throws NotConnectedException if the XMPP connection is not connected.
 * @throws InterruptedException if the calling thread was interrupted.
 */
  public ReportedData submitSearch(  DomainBareJid serviceJID,  FillableForm completedForm) throws NoResponseException, XMPPErrorException, NotConnectedException, InterruptedException {
    TranscriptSearch search=new TranscriptSearch();
    search.setType(IQ.Type.get);
    search.setTo(serviceJID);
    search.addExtension(completedForm.getDataFormToSubmit());
    TranscriptSearch response=connection.sendIqRequestAndWaitForResponse(search);
    return ReportedData.getReportedDataFrom(response);
  }
}
