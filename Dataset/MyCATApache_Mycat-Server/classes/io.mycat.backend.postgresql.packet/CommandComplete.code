public class CommandComplete extends PostgreSQLPacket {
  private int length;
  /** 
 * 命令
 */
  private String commandResponse;
  public int getAffectedRows(){
    return affectedRows;
  }
  public void setAffectedRows(  int affectedRows){
    this.affectedRows=affectedRows;
  }
  public int getInsertId(){
    return insertId;
  }
  public void setInsertId(  int insertId){
    this.insertId=insertId;
  }
  private int affectedRows=0;
  private int insertId=0;
  @Override public int getLength(){
    return length;
  }
  public boolean isDDLComplete(){
    return commandResponse != null && (commandResponse.startsWith("INSERT") || commandResponse.startsWith("DELETE") || commandResponse.startsWith("UPDATE"));
  }
  public boolean isTranComplete(){
    return commandResponse != null && (commandResponse.startsWith("ROLLBACK") || commandResponse.startsWith("COMMIT"));
  }
  public boolean isSelectComplete(){
    return commandResponse != null && (commandResponse.startsWith("SELECT"));
  }
  public int getRows(){
    if (!isDDLComplete()) {
      return 0;
    }
    if (commandResponse != null) {
      String[] s=commandResponse.split(" +");
      if (s.length == 0) {
        return 0;
      }
      try {
        return Integer.valueOf(s[s.length - 1].trim());
      }
 catch (      Exception e) {
        throw new RuntimeException(e);
      }
    }
    return 0;
  }
  @Override public char getMarker(){
    return PacketMarker.B_CommandComplete.getValue();
  }
  public static CommandComplete parse(  ByteBuffer buffer,  int offset){
    if (buffer.get(offset) != PacketMarker.B_CommandComplete.getValue()) {
      throw new IllegalArgumentException("this packetData not is CommandComplete");
    }
    CommandComplete packet=new CommandComplete();
    packet.length=PIOUtils.redInteger4(buffer,offset + 1);
    packet.commandResponse=new String(PIOUtils.redByteArray(buffer,offset + 1 + 4,packet.length - 4),UTF8).trim();
    if (packet.commandResponse.startsWith("INSERT")) {
      String vs[]=packet.commandResponse.replace("INSERT","").trim().split(" +");
      packet.insertId=parseInt(vs[0]);
      packet.affectedRows=parseInt(vs[1]);
    }
 else     if (packet.commandResponse.startsWith("UPDATE")) {
      packet.affectedRows=parseInt(packet.commandResponse.replace("UPDATE","").trim());
    }
 else     if (packet.commandResponse.startsWith("DELETE")) {
      packet.affectedRows=parseInt(packet.commandResponse.replace("DELETE","").trim());
    }
    return packet;
  }
  private static int parseInt(  String value){
    try {
      return Integer.parseInt(value);
    }
 catch (    Exception e) {
      e.printStackTrace();
    }
    return 0;
  }
  public String getCommandResponse(){
    return commandResponse;
  }
}
