@Override public Map<CommandLatencyId,CommandMetrics> retrieveMetrics(){
  Map<CommandLatencyId,Latencies> latenciesMap=latencyMetricsRef.get();
  Map<CommandLatencyId,Latencies> metricsToUse;
  if (options.resetLatenciesAfterEvent()) {
    metricsToUse=latenciesMap;
    latencyMetricsRef.set(createNewLatencyMap());
    metricsToUse.values().forEach(Latencies::stop);
  }
 else {
    metricsToUse=new HashMap<>(latenciesMap);
  }
  return getMetrics(metricsToUse);
}
@Override public Map<CommandLatencyId,CommandMetrics> retrieveMetrics(){
  return Collections.emptyMap();
}
