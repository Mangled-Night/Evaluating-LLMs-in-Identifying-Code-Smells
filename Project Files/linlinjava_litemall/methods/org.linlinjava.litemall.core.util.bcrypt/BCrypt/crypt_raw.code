/** 
 * Perform the central password hashing step in the bcrypt scheme
 * @param password   the password to hash
 * @param salt       the binary salt to hash with the password
 * @param log_rounds the binary logarithm of the number of rounds of hashing to apply
 * @return an array containing the binary hashed password
 */
private byte[] crypt_raw(byte password[],byte salt[],int log_rounds){
  int cdata[]=(int[])bf_crypt_ciphertext.clone();
  int clen=cdata.length;
  byte ret[];
  long rounds=roundsForLogRounds(log_rounds);
  init_key();
  ekskey(salt,password);
  for (long i=0; i < rounds; i++) {
    key(password);
    key(salt);
  }
  for (int i=0; i < 64; i++) {
    for (int j=0; j < (clen >> 1); j++) {
      encipher(cdata,j << 1);
    }
  }
  ret=new byte[clen * 4];
  for (int i=0, j=0; i < clen; i++) {
    ret[j++]=(byte)((cdata[i] >> 24) & 0xff);
    ret[j++]=(byte)((cdata[i] >> 16) & 0xff);
    ret[j++]=(byte)((cdata[i] >> 8) & 0xff);
    ret[j++]=(byte)(cdata[i] & 0xff);
  }
  return ret;
}
