/** 
 * @author Mark Paluch
 */
@ExtendWith(LettuceExtension.class) class CustomReactiveCommandIntegrationTests extends TestSupport {
  private final RedisCommands<String,String> redis;
  @Inject CustomReactiveCommandIntegrationTests(  StatefulRedisConnection<String,String> connection){
    this.redis=connection.sync();
    this.redis.flushdb();
  }
  @Test void dispatchGetAndSet(){
    redis.set(key,value);
    RedisReactiveCommands<String,String> reactive=redis.getStatefulConnection().reactive();
    Flux<String> flux=reactive.dispatch(CommandType.GET,new ValueOutput<>(StringCodec.UTF8),new CommandArgs<>(StringCodec.UTF8).addKey(key));
    StepVerifier.create(flux).expectNext(value).verifyComplete();
  }
  @Test void dispatchList(){
    redis.rpush(key,"a","b","c");
    RedisReactiveCommands<String,String> reactive=redis.getStatefulConnection().reactive();
    Flux<String> flux=reactive.dispatch(CommandType.LRANGE,new ValueListOutput<>(StringCodec.UTF8),new CommandArgs<>(StringCodec.UTF8).addKey(key).add(0).add(-1));
    StepVerifier.create(flux).expectNext("a","b","c").verifyComplete();
  }
}
