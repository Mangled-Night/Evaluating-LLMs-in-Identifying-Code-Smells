public RouteResultset route(SystemConfig sysconf,SchemaConfig schema,int sqlType,String stmt,String charset,ServerConnection sc) throws SQLNonTransientException {
  stmt=stmt.trim();
  RouteResultset rrs=null;
  String cacheKey=null;
  if (sqlType == ServerParse.SELECT) {
    cacheKey=schema.getName() + stmt;
    rrs=(RouteResultset)sqlRouteCache.get(cacheKey);
    if (rrs != null) {
      checkMigrateRule(schema.getName(),rrs,sqlType);
      return rrs;
    }
  }
  int hintLength=RouteService.isHintSql(stmt);
  if (hintLength != -1) {
    int endPos=stmt.indexOf("*/");
    if (endPos > 0) {
      String hint=stmt.substring(hintLength,endPos).trim();
      int firstSplitPos=hint.indexOf(HINT_SPLIT);
      if (firstSplitPos > 0) {
        Map<String,String> hintMap=new HashMap<>();
        parseKeyValue(hintMap,hint);
        String hintType=(String)hintMap.get(MYCAT_HINT_TYPE);
        String hintSql=(String)hintMap.get(hintType);
        if (hintSql.length() == 0) {
          LOGGER.warn("comment int sql must meet :/*!mycat:type=value*/ or /*#mycat:type=value*/ or /*mycat:type=value*/: " + stmt);
          throw new SQLSyntaxErrorException("comment int sql must meet :/*!mycat:type=value*/ or /*#mycat:type=value*/ or /*mycat:type=value*/: " + stmt);
        }
        String realSQL=stmt.substring(endPos + "*/".length()).trim();
        HintHandler hintHandler=HintHandlerFactory.getHintHandler(hintType);
        if (hintHandler != null) {
          if (hintHandler instanceof HintSQLHandler) {
            int hintSqlType=ServerParse.parse(hintSql) & 0xff;
            rrs=hintHandler.route(sysconf,schema,sqlType,realSQL,charset,sc,tableId2DataNodeCache,hintSql,hintSqlType,hintMap);
          }
 else {
            rrs=hintHandler.route(sysconf,schema,sqlType,realSQL,charset,sc,tableId2DataNodeCache,hintSql,sqlType,hintMap);
          }
        }
 else {
          LOGGER.warn("TODO , support hint sql type : " + hintType);
        }
      }
 else {
        LOGGER.warn("comment in sql must meet :/*!mycat:type=value*/ or /*#mycat:type=value*/ or /*mycat:type=value*/: " + stmt);
        throw new SQLSyntaxErrorException("comment in sql must meet :/*!mcat:type=value*/ or /*#mycat:type=value*/ or /*mycat:type=value*/: " + stmt);
      }
    }
  }
 else {
    stmt=stmt.trim();
    rrs=RouteStrategyFactory.getRouteStrategy().route(sysconf,schema,sqlType,stmt,charset,sc,tableId2DataNodeCache);
  }
  if (rrs != null && sqlType == ServerParse.SELECT && rrs.isCacheAble()) {
    sqlRouteCache.putIfAbsent(cacheKey,rrs);
  }
  checkMigrateRule(schema.getName(),rrs,sqlType);
  return rrs;
}
