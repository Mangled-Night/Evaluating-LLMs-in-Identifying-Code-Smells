private static class StaticPubSubAsyncNodeSelection<K,V> extends AbstractNodeSelection<RedisPubSubAsyncCommands<K,V>,NodeSelectionPubSubAsyncCommands<K,V>,K,V> implements PubSubAsyncNodeSelection<K,V> {
  private final List<RedisClusterNode> redisClusterNodes;
  private final ClusterDistributionChannelWriter writer;
  @SuppressWarnings("unchecked") public StaticPubSubAsyncNodeSelection(  StatefulRedisClusterPubSubConnection<K,V> globalConnection,  Predicate<RedisClusterNode> selector){
    this.redisClusterNodes=globalConnection.getPartitions().stream().filter(selector).collect(Collectors.toList());
    writer=((StatefulRedisClusterPubSubConnectionImpl)globalConnection).getClusterDistributionChannelWriter();
  }
  @Override protected CompletableFuture<RedisPubSubAsyncCommands<K,V>> getApi(  RedisClusterNode redisClusterNode){
    return getConnection(redisClusterNode).thenApply(StatefulRedisPubSubConnection::async);
  }
  protected List<RedisClusterNode> nodes(){
    return redisClusterNodes;
  }
  @SuppressWarnings("unchecked") protected CompletableFuture<StatefulRedisPubSubConnection<K,V>> getConnection(  RedisClusterNode redisClusterNode){
    RedisURI uri=redisClusterNode.getUri();
    AsyncClusterConnectionProvider async=(AsyncClusterConnectionProvider)writer.getClusterConnectionProvider();
    return async.getConnectionAsync(ConnectionIntent.WRITE,uri.getHost(),uri.getPort()).thenApply(it -> (StatefulRedisPubSubConnection<K,V>)it);
  }
}
