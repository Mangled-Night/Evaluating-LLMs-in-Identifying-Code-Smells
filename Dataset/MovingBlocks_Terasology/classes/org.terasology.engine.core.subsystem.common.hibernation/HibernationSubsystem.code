public class HibernationSubsystem implements EngineSubsystem {
  private static final Logger logger=LoggerFactory.getLogger(HibernationSubsystem.class);
  private HibernationManager hibernationManager;
  private DisplayDevice displayDevice;
  @Override public String getName(){
    return "Hibernation";
  }
  @Override public void preInitialise(  Context rootContext){
    hibernationManager=new HibernationManager();
    rootContext.put(HibernationManager.class,hibernationManager);
  }
  @Override public void postInitialise(  Context rootContext){
    displayDevice=rootContext.get(DisplayDevice.class);
  }
  @Override public void postUpdate(  GameState currentState,  float delta){
    if (hibernationManager.isHibernating()) {
      if (!hibernationManager.isHibernationAllowed() || displayDevice.hasFocus()) {
        hibernationManager.setHibernating(false);
      }
    }
 else {
      if (hibernationManager.isHibernationAllowed() && !displayDevice.hasFocus()) {
        hibernationManager.setHibernating(true);
      }
    }
    if (hibernationManager.isHibernating()) {
      try {
        Thread.sleep(100);
      }
 catch (      InterruptedException e) {
        logger.warn("Hibernation sleep interrupted",e);
      }
    }
  }
}
