public static FileOutputStream prepareFileOutputStream(File file) throws IOException {
  if (!file.exists()) {
    File parent=file.getParentFile();
    if (!parent.exists() && !parent.mkdirs()) {
      throw new IOException("Cannot create directory " + parent.getAbsolutePath());
    }
    if (!file.createNewFile()) {
      throw new IOException("Cannot create file " + file.getAbsolutePath());
    }
  }
  if (file.isDirectory()) {
    throw new AssertionError("File " + file.getAbsolutePath() + " is not a file!");
  }
  return new FileOutputStream(file);
}
