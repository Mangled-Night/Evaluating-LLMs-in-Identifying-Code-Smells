/** 
 * Custom Entry class used by EntryIterator.next(), that relays setValue changes to the underlying map.
 */
final class WriteThroughEntry extends SimpleEntry<K,V> {
  WriteThroughEntry(  K k,  V v){
    super(k,v);
  }
  /** 
 * Set our entry's value and write through to the map. The value to return is somewhat arbitrary here. Since a WriteThroughEntry does not necessarily track asynchronous changes, the most recent "previous" value could be different from what we return (or could even have been removed in which case the put will re-establish). We do not and can not guarantee more.
 */
  @Override public V setValue(  V value){
    if (value == null) {
      throw new NullPointerException();
    }
    V v=super.setValue(value);
    put(getKey(),value);
    return v;
  }
}
