/** 
 * Enter a room, as described in XEP-45 7.2.
 * @param conf the configuration used to enter the room.
 * @return the returned presence by the service after the client send the initial presence in order to enter the room.
 * @throws NotConnectedException if the XMPP connection is not connected.
 * @throws NoResponseException if there was no response from the remote entity.
 * @throws XMPPErrorException if there was an XMPP error returned.
 * @throws InterruptedException if the calling thread was interrupted.
 * @throws NotAMucServiceException if the entity is not a MUC serivce.
 * @see <a href="http://xmpp.org/extensions/xep-0045.html#enter">XEP-45 7.2 Entering a Room</a>
 */
private Presence enter(MucEnterConfiguration conf) throws NotConnectedException, NoResponseException, XMPPErrorException, InterruptedException, NotAMucServiceException {
  final DomainBareJid mucService=room.asDomainBareJid();
  mucServiceDiscoInfo=multiUserChatManager.getMucServiceDiscoInfo(mucService);
  if (mucServiceDiscoInfo == null) {
    throw new NotAMucServiceException(this);
  }
  Presence joinPresence=conf.getJoinPresence(this);
  connection.addStanzaListener(messageListener,fromRoomGroupchatFilter);
  StanzaFilter presenceFromRoomFilter=new AndFilter(fromRoomFilter,StanzaTypeFilter.PRESENCE,PossibleFromTypeFilter.ENTITY_FULL_JID);
  connection.addStanzaListener(presenceListener,presenceFromRoomFilter);
  connection.addStanzaListener(subjectListener,new AndFilter(fromRoomFilter,MessageWithSubjectFilter.INSTANCE,new NotFilter(MessageTypeFilter.ERROR),new NotFilter(MessageWithBodiesFilter.INSTANCE),new NotFilter(MessageWithThreadFilter.INSTANCE)));
  connection.addStanzaListener(declinesListener,new AndFilter(fromRoomFilter,DECLINE_FILTER));
  messageCollector=connection.createStanzaCollector(fromRoomGroupchatFilter);
  StanzaFilter responseFilter=new AndFilter(StanzaTypeFilter.PRESENCE,new OrFilter(new AndFilter(FromMatchesFilter.createBare(getRoom()),MUCUserStatusCodeFilter.STATUS_110_PRESENCE_TO_SELF),new AndFilter(FromMatchesFilter.createFull(joinPresence.getTo()),new StanzaIdFilter(joinPresence),PresenceTypeFilter.ERROR)));
  processedReflectedSelfPresence=false;
  StanzaCollector presenceStanzaCollector=null;
  final Presence reflectedSelfPresence;
  try {
    StanzaCollector selfPresenceCollector=connection.createStanzaCollectorAndSend(responseFilter,joinPresence);
    StanzaCollector.Configuration presenceStanzaCollectorConfguration=StanzaCollector.newConfiguration().setCollectorToReset(selfPresenceCollector).setStanzaFilter(presenceFromRoomFilter);
    presenceStanzaCollector=connection.createStanzaCollector(presenceStanzaCollectorConfguration);
    reflectedSelfPresence=selfPresenceCollector.nextResultOrThrow(conf.getTimeout());
  }
 catch (  NotConnectedException|InterruptedException|NoResponseException|XMPPErrorException e) {
    removeConnectionCallbacks();
    throw e;
  }
 finally {
    if (presenceStanzaCollector != null) {
      presenceStanzaCollector.cancel();
    }
  }
synchronized (presenceListener) {
    while (!processedReflectedSelfPresence) {
      presenceListener.wait();
    }
  }
  Resourcepart receivedNickname=reflectedSelfPresence.getFrom().getResourceOrThrow();
  setNickname(receivedNickname);
  multiUserChatManager.addJoinedRoom(room);
  return reflectedSelfPresence;
}
