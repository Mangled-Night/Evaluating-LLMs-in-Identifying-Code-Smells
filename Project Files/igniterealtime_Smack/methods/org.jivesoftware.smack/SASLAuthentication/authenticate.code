/** 
 * Performs SASL authentication of the specified user. If SASL authentication was successful then resource binding and session establishment will be performed. This method will return the full JID provided by the server while binding a resource to the connection.<p> The server may assign a full JID with a username or resource different than the requested by this method.
 * @param username the username that is authenticating with the server.
 * @param password the password to send to the server.
 * @param authzid the authorization identifier (typically null).
 * @param sslSession the optional SSL/TLS session (if one was established)
 * @return the used SASLMechanism.
 * @throws XMPPErrorException if there was an XMPP error returned.
 * @throws SASLErrorException if a SASL protocol error was returned.
 * @throws IOException if an I/O error occurred.
 * @throws InterruptedException if the calling thread was interrupted.
 * @throws SmackSaslException if a SASL specific error occurred.
 * @throws NotConnectedException if the XMPP connection is not connected.
 * @throws NoResponseException if there was no response from the remote entity.
 */
SASLMechanism authenticate(String username,String password,EntityBareJid authzid,SSLSession sslSession) throws XMPPErrorException, SASLErrorException, IOException, InterruptedException, SmackSaslException, NotConnectedException, NoResponseException {
  final SASLMechanism mechanism=selectMechanism(authzid,password);
  final CallbackHandler callbackHandler=configuration.getCallbackHandler();
  final String host=connection.getHost();
  final DomainBareJid xmppServiceDomain=connection.getXMPPServiceDomain();
synchronized (this) {
    currentMechanism=mechanism;
    if (callbackHandler != null) {
      currentMechanism.authenticate(host,xmppServiceDomain,callbackHandler,authzid,sslSession);
    }
 else {
      currentMechanism.authenticate(username,host,xmppServiceDomain,password,authzid,sslSession);
    }
    final long deadline=System.currentTimeMillis() + connection.getReplyTimeout();
    while (!mechanism.isFinished()) {
      final long now=System.currentTimeMillis();
      if (now >= deadline)       break;
      wait(deadline - now);
    }
  }
  mechanism.throwExceptionIfRequired();
  return mechanism;
}
