/** 
 * 首页数据
 * @param userId 当用户已经登录时，非空。为登录状态为null
 * @return 首页数据
 */
@GetMapping("/index") public Object index(@LoginUser Integer userId){
  if (HomeCacheManager.hasData(HomeCacheManager.INDEX)) {
    return ResponseUtil.ok(HomeCacheManager.getCacheData(HomeCacheManager.INDEX));
  }
  Callable<List> bannerListCallable=() -> adService.queryIndex();
  Callable<List> channelListCallable=() -> categoryService.queryChannel();
  Callable<List> couponListCallable;
  if (userId == null) {
    couponListCallable=() -> couponService.queryList(0,3);
  }
 else {
    couponListCallable=() -> couponService.queryAvailableList(userId,0,3);
  }
  Callable<List> newGoodsListCallable=() -> goodsService.queryByNew(0,SystemConfig.getNewLimit());
  Callable<List> hotGoodsListCallable=() -> goodsService.queryByHot(0,SystemConfig.getHotLimit());
  Callable<List> brandListCallable=() -> brandService.query(0,SystemConfig.getBrandLimit());
  Callable<List> topicListCallable=() -> topicService.queryList(0,SystemConfig.getTopicLimit());
  Callable<List> grouponListCallable=() -> grouponService.queryList(0,5);
  Callable<List> floorGoodsListCallable=this::getCategoryList;
  FutureTask<List> bannerTask=new FutureTask<>(bannerListCallable);
  FutureTask<List> channelTask=new FutureTask<>(channelListCallable);
  FutureTask<List> couponListTask=new FutureTask<>(couponListCallable);
  FutureTask<List> newGoodsListTask=new FutureTask<>(newGoodsListCallable);
  FutureTask<List> hotGoodsListTask=new FutureTask<>(hotGoodsListCallable);
  FutureTask<List> brandListTask=new FutureTask<>(brandListCallable);
  FutureTask<List> topicListTask=new FutureTask<>(topicListCallable);
  FutureTask<List> grouponListTask=new FutureTask<>(grouponListCallable);
  FutureTask<List> floorGoodsListTask=new FutureTask<>(floorGoodsListCallable);
  executorService.submit(bannerTask);
  executorService.submit(channelTask);
  executorService.submit(couponListTask);
  executorService.submit(newGoodsListTask);
  executorService.submit(hotGoodsListTask);
  executorService.submit(brandListTask);
  executorService.submit(topicListTask);
  executorService.submit(grouponListTask);
  executorService.submit(floorGoodsListTask);
  Map<String,Object> entity=new HashMap<>();
  try {
    entity.put("banner",bannerTask.get());
    entity.put("channel",channelTask.get());
    entity.put("couponList",couponListTask.get());
    entity.put("newGoodsList",newGoodsListTask.get());
    entity.put("hotGoodsList",hotGoodsListTask.get());
    entity.put("brandList",brandListTask.get());
    entity.put("topicList",topicListTask.get());
    entity.put("grouponList",grouponListTask.get());
    entity.put("floorGoodsList",floorGoodsListTask.get());
    HomeCacheManager.loadData(HomeCacheManager.INDEX,entity);
  }
 catch (  Exception e) {
    e.printStackTrace();
  }
  return ResponseUtil.ok(entity);
}
