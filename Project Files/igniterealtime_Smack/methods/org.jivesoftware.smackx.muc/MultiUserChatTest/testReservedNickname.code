public void testReservedNickname(){
  try {
    MultiUserChat muc2=new MultiUserChat(getConnection(1),room);
    String reservedNickname=muc2.getReservedNickname();
    assertNull("Reserved nickname is not null",reservedNickname);
    Form registrationForm=muc2.getRegistrationForm();
    Form answerForm=registrationForm.createAnswerForm();
    answerForm.setAnswer("muc#register_first","MyFirstName");
    answerForm.setAnswer("muc#register_last","MyLastName");
    answerForm.setAnswer("muc#register_roomnick","MyNick");
    muc2.sendRegistrationForm(answerForm);
    reservedNickname=muc2.getReservedNickname();
    assertEquals("Reserved nickname is wrong","MyNick",reservedNickname);
    muc2.join("MyNick");
    muc2.leave();
    MultiUserChat muc3=new MultiUserChat(getConnection(2),room);
    try {
      muc3.join("MyNick");
      fail("Other user was able to join with other user's reserved nickname");
    }
 catch (    XMPPException e) {
      XMPPError xmppError=e.getStanzaError();
      assertNotNull("No XMPPError was received when joining with other user's reserved nickname",xmppError);
      assertEquals("Different error code was received while joining with other user's reserved nickname",409,xmppError.getCode());
    }
    muc3.join("MyNotReservedNick");
    muc3.leave();
    registrationForm=muc3.getRegistrationForm();
    answerForm=registrationForm.createAnswerForm();
    answerForm.setAnswer("muc#register_first","MyFirstName 2");
    answerForm.setAnswer("muc#register_last","MyLastName 2");
    answerForm.setAnswer("muc#register_roomnick","MyNick");
    try {
      muc3.sendRegistrationForm(answerForm);
    }
 catch (    XMPPException e) {
      XMPPError xmppError=e.getStanzaError();
      assertNotNull("No XMPPError was received when reserving an already reserved nickname",xmppError);
      assertEquals("Different error code was received while reserving an already reserved nickname",409,xmppError.getCode());
    }
    registrationForm=muc3.getRegistrationForm();
    answerForm=registrationForm.createAnswerForm();
    answerForm.setAnswer("muc#register_first","MyFirstName 2");
    answerForm.setAnswer("muc#register_last","MyLastName 2");
    answerForm.setAnswer("muc#register_roomnick","MyNick 2");
    muc3.sendRegistrationForm(answerForm);
  }
 catch (  XMPPException e) {
    e.printStackTrace();
    fail(e.getMessage());
  }
}
