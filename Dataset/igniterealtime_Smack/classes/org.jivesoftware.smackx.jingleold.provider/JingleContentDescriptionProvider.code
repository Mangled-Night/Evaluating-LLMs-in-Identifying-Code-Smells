/** 
 * Parser for a Jingle description.
 * @author Alvaro Saurin
 */
public abstract class JingleContentDescriptionProvider extends ExtensionElementProvider<JingleContentDescription> {
  /** 
 * Parse a iq/jingle/description/payload-type element.
 * @param parser the input to parse
 * @return a payload type element
 */
  protected JinglePayloadType parsePayload(  final XmlPullParser parser){
    int ptId;
    String ptName;
    int ptChannels;
    ptId=Integer.parseInt(parser.getAttributeValue("","id"));
    ptName=parser.getAttributeValue("","name");
    ptChannels=Integer.parseInt(parser.getAttributeValue("","channels"));
    return new JinglePayloadType(new PayloadType(ptId,ptName,ptChannels));
  }
  /** 
 * Parse a iq/jingle/description element.
 * @param parser the input to parse
 * @return a description element
 * @throws IOException if an I/O error occurred.
 * @throws XmlPullParserException if an error in the XML parser occurred.
 */
  @Override public JingleContentDescription parse(  XmlPullParser parser,  int initialDepth,  XmlEnvironment xmlEnvironment) throws XmlPullParserException, IOException {
    JingleContentDescription desc=getInstance();
    outerloop:     while (true) {
      XmlPullParser.Event eventType=parser.next();
      if (eventType == XmlPullParser.Event.START_ELEMENT) {
        String name=parser.getName();
        if (name.equals(JingleContentDescription.JinglePayloadType.NODENAME)) {
          desc.addJinglePayloadType(parsePayload(parser));
        }
 else {
          throw new IOException("Unknow element \"" + name + "\" in content.");
        }
      }
 else       if (eventType == XmlPullParser.Event.END_ELEMENT) {
        if (parser.getDepth() == initialDepth) {
          break outerloop;
        }
      }
    }
    return desc;
  }
  /** 
 * Return a new instance of this class. Subclasses must overwrite this method.
 * @return the jingle content description.
 */
  protected abstract JingleContentDescription getInstance();
  /** 
 * Jingle audio.
 */
public static class Audio extends JingleContentDescriptionProvider {
    /** 
 * Parse an audio payload type.
 */
    @Override public JinglePayloadType parsePayload(    final XmlPullParser parser){
      JinglePayloadType pte=super.parsePayload(parser);
      PayloadType.Audio pt=new PayloadType.Audio(pte.getPayloadType());
      int ptClockRate=Integer.parseInt(parser.getAttributeValue("","clockrate"));
      pt.setClockRate(ptClockRate);
      return new JinglePayloadType.Audio(pt);
    }
    /** 
 * Get a new instance of this object.
 */
    @Override protected JingleContentDescription getInstance(){
      return new JingleContentDescription.Audio();
    }
  }
}
