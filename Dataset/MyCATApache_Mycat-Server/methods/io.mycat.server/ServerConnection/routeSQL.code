public RouteResultset routeSQL(String sql,int type){
  String db=this.schema;
  if (db == null) {
    db=SchemaUtil.detectDefaultDb(sql,type);
    if (db == null) {
      db=MycatServer.getInstance().getConfig().getUsers().get(user).getDefaultSchema();
      if (db == null) {
        writeErrMessage(ErrorCode.ERR_BAD_LOGICDB,"No MyCAT Database selected");
        return null;
      }
    }
  }
  SchemaConfig schema=MycatServer.getInstance().getConfig().getSchemas().get(db);
  if (schema == null) {
    writeErrMessage(ErrorCode.ERR_BAD_LOGICDB,"Unknown MyCAT Database '" + db + "'");
    return null;
  }
  RouteResultset rrs=null;
  try {
    rrs=MycatServer.getInstance().getRouterservice().route(MycatServer.getInstance().getConfig().getSystem(),schema,type,sql,this.charset,this);
  }
 catch (  Exception e) {
    StringBuilder s=new StringBuilder();
    LOGGER.warn(s.append(this).append(sql).toString() + " err:" + e.toString(),e);
    String msg=e.getMessage();
    writeErrMessage(ErrorCode.ER_PARSE_ERROR,msg == null ? e.getClass().getSimpleName() : msg);
    return null;
  }
  return rrs;
}
