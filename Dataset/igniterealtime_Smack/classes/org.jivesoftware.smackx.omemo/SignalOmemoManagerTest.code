/** 
 * Test OmemoManager functionality.
 */
public class SignalOmemoManagerTest extends SmackTestSuite {
  @Test public void instantiationTest(){
    SignalOmemoService.acknowledgeLicense();
    SignalOmemoService.setup();
    DummyConnection dummy=new DummyConnection();
    DummyConnection silly=new DummyConnection();
    OmemoManager a=OmemoManager.getInstanceFor(dummy,123);
    OmemoManager b=OmemoManager.getInstanceFor(dummy,234);
    OmemoManager c=OmemoManager.getInstanceFor(silly,123);
    OmemoManager d=OmemoManager.getInstanceFor(dummy,123);
    assertNotNull(a);
    assertNotNull(b);
    assertNotNull(c);
    assertNotNull(d);
    assertEquals(Integer.valueOf(123),a.getDeviceId());
    assertEquals(Integer.valueOf(234),b.getDeviceId());
    assertFalse(a == b);
    assertFalse(a == c);
    assertFalse(b == c);
    assertTrue(a == d);
  }
  @Test public void randomDeviceIdTest(){
    int a=OmemoManager.randomDeviceId();
    int b=OmemoManager.randomDeviceId();
    assertNotSame(a,b);
    assertTrue(a > 0);
    assertTrue(b > 0);
  }
  @Test public void stanzaRecognitionTest() throws Exception {
    String omemoXML="<encrypted xmlns='eu.siacs.conversations.axolotl'><header sid='1009'><key rid='1337'>MwohBfRqBm2atj3fT0/KUDg59Cnvfpgoe/PLNIu1xgSXujEZEAAYACIwKh6TTC7VBQZcCcKnQlO+6s1GQ9DIRKH4JU7XrJ+JJnkPUwJ4VLSeOEQD7HmFbhQPTLZO0u/qlng=</key><iv>sN0amy4e2NBrlb4G/OjNIQ==</iv></header><payload>4xVUAeg4M0Mhk+5n3YG1x12Dw/cYTc0Z</payload></encrypted>";
    OmemoElement omemoElement=new OmemoVAxolotlProvider().parse(TestUtils.getParser(omemoXML));
    Message m=StanzaBuilder.buildMessage().addExtension(omemoElement).build();
    Message n=StanzaBuilder.buildMessage().build();
    assertTrue(OmemoManager.stanzaContainsOmemoElement(m));
    assertFalse(OmemoManager.stanzaContainsOmemoElement(n));
  }
}
