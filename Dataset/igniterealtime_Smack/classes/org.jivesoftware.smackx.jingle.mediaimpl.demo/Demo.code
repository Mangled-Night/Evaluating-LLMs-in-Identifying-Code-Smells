/** 
 * Jingle Demo Application. It register in an XMPP Server and let users place calls using a full JID and auto-receive calls. Parameters: Server User Pass.
 */
public class Demo extends JFrame {
  private static final long serialVersionUID=-6584021277434403855L;
  private JingleTransportManager transportManager=null;
  private XMPPConnection xmppConnection=null;
  private String server=null;
  private String user=null;
  private String pass=null;
  private JingleManager jm=null;
  private JingleSession incoming=null;
  private JingleSession outgoing=null;
  private JTextField jid;
  public Demo(  String server,  String user,  String pass){
    this.server=server;
    this.user=user;
    this.pass=pass;
    if (user.equals("jeffw")) {
      jid=new JTextField("eowyn" + "@" + server + "/Smack");
    }
 else {
      jid=new JTextField("jeffw" + "@" + server + "/Smack");
    }
    xmppConnection=new XMPPTCPConnection(server);
    try {
      xmppConnection.connect();
      xmppConnection.login(user,pass);
      initialize();
    }
 catch (    XMPPException e) {
      LOGGER.log(Level.WARNING,"exception",e);
    }
  }
  public void initialize(){
    ICETransportManager icetm0=new ICETransportManager(xmppConnection,"10.47.47.53",3478);
    List<JingleMediaManager> mediaManagers=new ArrayList<JingleMediaManager>();
    mediaManagers.add(new SpeexMediaManager(icetm0));
    mediaManagers.add(new ScreenShareMediaManager(icetm0));
    jm=new JingleManager(xmppConnection,mediaManagers);
    jm.addCreationListener(icetm0);
    jm.addJingleSessionRequestListener(new JingleSessionRequestListener(){
      public void sessionRequested(      JingleSessionRequest request){
        try {
          incoming=request.accept();
          incoming.startIncoming();
        }
 catch (        XMPPException e) {
          LOGGER.log(Level.WARNING,"exception",e);
        }
      }
    }
);
    createGUI();
  }
  public void createGUI(){
    JPanel jPanel=new JPanel();
    jPanel.add(jid);
    jPanel.add(new JButton(new AbstractAction("Call"){
      private static final long serialVersionUID=4308448034795312815L;
      public void actionPerformed(      ActionEvent e){
        if (outgoing != null)         return;
        try {
          outgoing=jm.createOutgoingJingleSession(jid.getText());
          outgoing.startOutgoing();
        }
 catch (        XMPPException e1) {
          e1.printStackTrace();
        }
      }
    }
));
    jPanel.add(new JButton(new AbstractAction("Hangup"){
      private static final long serialVersionUID=-4508007389146723587L;
      public void actionPerformed(      ActionEvent e){
        if (outgoing != null)         try {
          outgoing.terminate();
        }
 catch (        XMPPException e1) {
          e1.printStackTrace();
        }
 finally {
          outgoing=null;
        }
        if (incoming != null)         try {
          incoming.terminate();
        }
 catch (        XMPPException e1) {
          e1.printStackTrace();
        }
 finally {
          incoming=null;
        }
      }
    }
));
    this.add(jPanel);
  }
  public static void main(  String args[]){
    Demo demo=null;
    if (args.length > 2) {
      demo=new Demo(args[0],args[1],args[2]);
      demo.pack();
      demo.setVisible(true);
      demo.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
    }
  }
}
