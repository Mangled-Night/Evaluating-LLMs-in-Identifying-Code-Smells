public class HintTest {
  protected Map<String,SchemaConfig> schemaMap;
  protected LayerCachePool cachePool=new SimpleCachePool();
  protected RouteStrategy routeStrategy;
  public HintTest(){
    String schemaFile="/route/schema.xml";
    String ruleFile="/route/rule.xml";
    SchemaLoader schemaLoader=new XMLSchemaLoader(schemaFile,ruleFile);
    schemaMap=schemaLoader.getSchemas();
    MycatServer.getInstance().getConfig().getSchemas().putAll(schemaMap);
    RouteStrategyFactory.init();
    routeStrategy=RouteStrategyFactory.getRouteStrategy("fdbparser");
  }
  /** 
 * 测试注解
 * @throws Exception
 */
  @Test public void testHint() throws Exception {
    SchemaConfig schema=schemaMap.get("TESTDB");
    String sql="/*!mycat: sql = select * from employee where sharding_id = 10010 */select * from employee";
    CacheService cacheService=new CacheService();
    RouteService routerService=new RouteService(cacheService);
    RouteResultset rrs=routerService.route(new SystemConfig(),schema,ServerParse.SELECT,sql,"UTF-8",null);
    Assert.assertTrue(rrs.getNodes().length == 1);
    sql="/*#mycat: sql = select * from employee where sharding_id = 10000 */select * from employee";
    rrs=routerService.route(new SystemConfig(),schema,ServerParse.SELECT,sql,"UTF-8",null);
    Assert.assertTrue(rrs.getNodes().length == 1);
    sql="/*!mycat: sql = select * from employee where sharding_id in ('10000','10010') */select * from employee";
    rrs=routerService.route(new SystemConfig(),schema,ServerParse.SELECT,sql,"UTF-8",null);
    Assert.assertTrue(rrs.getNodes().length == 2);
    sql="select * from employee";
    rrs=routerService.route(new SystemConfig(),schema,ServerParse.SELECT,sql,"UTF-8",null);
    Assert.assertTrue(rrs.getNodes().length == 2);
  }
}
