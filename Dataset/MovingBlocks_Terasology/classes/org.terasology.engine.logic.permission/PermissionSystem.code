@RegisterSystem(RegisterMode.AUTHORITY) @Share(PermissionManager.class) public class PermissionSystem extends BaseComponentSystem implements PermissionManager {
  @In private LocalPlayer localPlayer;
  @Override public void addPermission(  EntityRef player,  String permission){
    PermissionSetComponent permissionSet=player.getComponent(PermissionSetComponent.class);
    if (permissionSet != null) {
      permissionSet.permissions.add(permission);
      player.saveComponent(permissionSet);
    }
  }
  @Override public boolean hasPermission(  EntityRef player,  String permission){
    if (isLocal(player)) {
      return true;
    }
    PermissionSetComponent permissionSet=player.getComponent(PermissionSetComponent.class);
    return permissionSet != null && permissionSet.permissions.contains(permission);
  }
  @Override public boolean hasPermission(  EntityRef player,  Predicate<String> permissionPredicate){
    if (isLocal(player)) {
      return true;
    }
    PermissionSetComponent permissionSet=player.getComponent(PermissionSetComponent.class);
    return permissionSet != null && predicateMatches(permissionPredicate,permissionSet.permissions);
  }
  private boolean predicateMatches(  Predicate<String> permissionPredicate,  Set<String> permissions){
    for (    String permission : permissions) {
      if (permissionPredicate.apply(permission)) {
        return true;
      }
    }
    return false;
  }
  @Override public void removePermission(  EntityRef player,  String permission){
    PermissionSetComponent permissionSet=player.getComponent(PermissionSetComponent.class);
    if (permissionSet != null) {
      permissionSet.permissions.remove(permission);
      player.saveComponent(permissionSet);
    }
  }
  /** 
 * @param player client info entity of the player
 * @return true if it is the local player
 */
  private boolean isLocal(  EntityRef player){
    return localPlayer != null && localPlayer.getClientInfoEntity().equals(player);
  }
}
