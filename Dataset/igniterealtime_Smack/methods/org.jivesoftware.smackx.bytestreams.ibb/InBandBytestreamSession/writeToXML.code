/** 
 * Writes the given data stanza to the XMPP stream.
 * @param data the data packet
 * @throws IOException if an I/O error occurred while sending or if the stream is closed
 * @throws NotConnectedException if the XMPP connection is not connected.
 * @throws InterruptedException if the calling thread was interrupted.
 */
protected abstract void writeToXML(DataPacketExtension data) throws IOException, NotConnectedException, InterruptedException ;
@Override protected synchronized void writeToXML(DataPacketExtension data) throws IOException {
  IQ iq=new Data(data);
  iq.setTo(remoteJID);
  try {
    connection.sendIqRequestAndWaitForResponse(iq);
  }
 catch (  Exception e) {
    if (!this.isClosed) {
      InBandBytestreamSession.this.close();
      IOException ioException=new IOException();
      ioException.initCause(e);
      throw ioException;
    }
  }
}
@Override protected synchronized void writeToXML(DataPacketExtension data) throws NotConnectedException, InterruptedException {
  Message message=StanzaBuilder.buildMessage().to(remoteJID).addExtension(data).build();
  connection.sendStanza(message);
}
