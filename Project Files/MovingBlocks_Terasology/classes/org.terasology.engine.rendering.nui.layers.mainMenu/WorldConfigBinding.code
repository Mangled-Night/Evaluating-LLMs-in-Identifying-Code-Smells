/** 
 * Updates a world configurator through setProperty() whenever Binding#set() is called.
 */
private static class WorldConfigBinding<T> implements Binding<T> {
  private final String label;
  private final WorldConfigurator worldConfig;
  private final FieldMetadata<Object,T> fieldMetadata;
  private final ComponentLibrary compLib;
  protected WorldConfigBinding(  WorldConfigurator config,  String label,  ComponentLibrary compLib,  FieldMetadata<Object,T> fieldMetadata){
    this.worldConfig=config;
    this.label=label;
    this.compLib=compLib;
    this.fieldMetadata=fieldMetadata;
  }
  @Override public T get(){
    Component comp=worldConfig.getProperties().get(label);
    return fieldMetadata.getValue(comp);
  }
  @Override public void set(  T value){
    T old=get();
    if (!Objects.equals(old,value)) {
      cloneAndSet(label,value);
    }
  }
  private void cloneAndSet(  String group,  Object value){
    Component comp=worldConfig.getProperties().get(group);
    Component clone=compLib.copy(comp);
    fieldMetadata.setValue(clone,value);
    worldConfig.setProperty(label,clone);
  }
}
/** 
 * Updates a world configurator through setProperty() whenever Binding#set() is called.
 */
private static class WorldConfigBinding<T> implements Binding<T> {
  private final String label;
  private final WorldConfigurator worldConfig;
  private final FieldMetadata<Object,T> fieldMetadata;
  private final ComponentLibrary compLib;
  protected WorldConfigBinding(  WorldConfigurator config,  String label,  ComponentLibrary compLib,  FieldMetadata<Object,T> fieldMetadata){
    this.worldConfig=config;
    this.label=label;
    this.compLib=compLib;
    this.fieldMetadata=fieldMetadata;
  }
  @Override public T get(){
    Component comp=worldConfig.getProperties().get(label);
    return fieldMetadata.getValue(comp);
  }
  @Override public void set(  T value){
    T old=get();
    if (!Objects.equals(old,value)) {
      cloneAndSet(label,value);
    }
  }
  private void cloneAndSet(  String group,  Object value){
    Component comp=worldConfig.getProperties().get(group);
    Component clone=compLib.copy(comp);
    fieldMetadata.setValue(clone,value);
    worldConfig.setProperty(label,clone);
  }
}
