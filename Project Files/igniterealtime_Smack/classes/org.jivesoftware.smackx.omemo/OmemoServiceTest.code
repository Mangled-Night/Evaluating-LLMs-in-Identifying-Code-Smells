public class OmemoServiceTest extends SmackTestSuite {
  private static final long ONE_HOUR=1000L * 60 * 60;
  private static final int DELETE_STALE=OmemoConfiguration.getDeleteStaleDevicesAfterHours();
  @Test(expected=IllegalStateException.class) public void getInstanceFailsWhenNullTest(){
    OmemoService.getInstance();
  }
  @Test public void isServiceRegisteredTest(){
    assertFalse(OmemoService.isServiceRegistered());
  }
  /** 
 * Test correct functionality of isStale method.
 * @throws XmppStringprepException if the provided string is invalid.
 */
  @Test public void isStaleDeviceTest() throws XmppStringprepException {
    OmemoDevice user=new OmemoDevice(JidCreate.bareFrom("alice@wonderland.lit"),123);
    OmemoDevice other=new OmemoDevice(JidCreate.bareFrom("bob@builder.tv"),444);
    Date now=new Date();
    Date deleteMe=new Date(now.getTime() - ((DELETE_STALE + 1) * ONE_HOUR));
    assertTrue(OmemoService.isStale(user,other,deleteMe,DELETE_STALE));
    assertFalse(OmemoService.isStale(user,user,deleteMe,DELETE_STALE));
    assertFalse(OmemoService.isStale(user,other,null,DELETE_STALE));
  }
  @Test public void removeOurDeviceTest() throws XmppStringprepException {
    OmemoDevice a=new OmemoDevice(JidCreate.bareFrom("a@b.c"),123);
    OmemoDevice b=new OmemoDevice(JidCreate.bareFrom("a@b.c"),124);
    HashSet<OmemoDevice> devices=new HashSet<>();
    devices.add(a);
    devices.add(b);
    assertTrue(devices.contains(a));
    assertTrue(devices.contains(b));
    OmemoService.removeOurDevice(a,devices);
    assertFalse(devices.contains(a));
    assertTrue(devices.contains(b));
  }
}
