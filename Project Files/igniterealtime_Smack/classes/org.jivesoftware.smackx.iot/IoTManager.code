public abstract class IoTManager extends Manager {
  private static final Logger LOGGER=Logger.getLogger(IoTManager.class.getName());
  private final IoTProvisioningManager ioTProvisioningManager;
  private boolean allowNonFriends;
  private static boolean autoEnable;
  public static void setAutoEnableIoTManagers(  boolean autoEnable){
    IoTManager.autoEnable=autoEnable;
  }
  public static boolean isAutoEnableActive(){
    return autoEnable;
  }
  protected IoTManager(  XMPPConnection connection){
    super(connection);
    ioTProvisioningManager=IoTProvisioningManager.getInstanceFor(connection);
  }
  /** 
 * Set whether or not non friends should be able to use the services provided by this manager. Those non-friend entities still need to know the full JID for IQ based requests.
 * @param allowNonFriends true to allow everyone to use the services.
 */
  public void setAllowNonFriends(  boolean allowNonFriends){
    this.allowNonFriends=allowNonFriends;
  }
  protected boolean isAllowed(  Jid jid){
    if (allowNonFriends)     return true;
    return ioTProvisioningManager.isMyFriend(jid);
  }
protected abstract class IoTIqRequestHandler extends AbstractIqRequestHandler {
    protected IoTIqRequestHandler(    String element,    String namespace,    IQ.Type type,    Mode mode){
      super(element,namespace,type,mode);
    }
    @Override public final IQ handleIQRequest(    IQ iqRequest){
      if (!isAllowed(iqRequest.getFrom())) {
        LOGGER.warning("Ignoring IQ request " + iqRequest);
        return null;
      }
      return handleIoTIqRequest(iqRequest);
    }
    protected abstract IQ handleIoTIqRequest(    IQ iqRequest);
  }
}
