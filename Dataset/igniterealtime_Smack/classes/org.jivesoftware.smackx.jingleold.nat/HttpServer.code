/** 
 * A very Simple HTTP Server.
 */
@SuppressWarnings("UnusedVariable") public class HttpServer {
  private static final Logger LOGGER=Logger.getLogger(HttpServer.class.getName());
  public HttpServer(  int port){
    ServerSocket server_socket;
    try {
      server_socket=new ServerSocket(port);
      LOGGER.fine("httpServer running on port " + server_socket.getLocalPort());
      while (true) {
        Socket socket=server_socket.accept();
        LOGGER.fine("New connection accepted " + socket.getInetAddress() + ":"+ socket.getPort());
        try {
          HttpRequestHandler request=new HttpRequestHandler(socket);
          Thread thread=new Thread(request);
          thread.start();
        }
 catch (        Exception e) {
          LOGGER.log(Level.FINE,"Exception",e);
        }
      }
    }
 catch (    IOException e) {
      LOGGER.log(Level.FINE,"Exception",e);
    }
  }
  public static void main(  String[] args){
    HttpServer httpServer=new HttpServer(Integer.parseInt(args[0]));
  }
static class HttpRequestHandler implements Runnable {
    static final String CRLF="\r\n";
    Socket socket;
    InputStream input;
    OutputStream output;
    BufferedReader br;
    HttpRequestHandler(    Socket socket) throws Exception {
      this.socket=socket;
      this.input=socket.getInputStream();
      this.output=socket.getOutputStream();
      this.br=new BufferedReader(new InputStreamReader(socket.getInputStream(),StandardCharsets.UTF_8));
    }
    @Override public void run(){
      try {
        processRequest();
      }
 catch (      Exception e) {
        LOGGER.log(Level.WARNING,"exception",e);
      }
    }
    private void processRequest() throws Exception {
      while (true) {
        String headerLine=br.readLine();
        LOGGER.fine(headerLine);
        if (headerLine.equals(CRLF) || headerLine.equals(""))         break;
        StringTokenizer s=new StringTokenizer(headerLine);
        String temp=s.nextToken();
        if (temp.equals("GET")) {
          String serverLine="Server: Simple httpServer";
          String contentTypeLine="text";
          String entityBody="";
          String contentLengthLine;
          String statusLine="HTTP/1.0 200 OK" + CRLF;
          contentLengthLine="Content-Length: " + entityBody.length() + CRLF;
          contentTypeLine="text/html";
          output.write(statusLine.getBytes(StandardCharsets.UTF_8));
          output.write(serverLine.getBytes(StandardCharsets.UTF_8));
          output.write(contentTypeLine.getBytes(StandardCharsets.UTF_8));
          output.write(contentLengthLine.getBytes(StandardCharsets.UTF_8));
          output.write(CRLF.getBytes(StandardCharsets.UTF_8));
          output.write(entityBody.getBytes(StandardCharsets.UTF_8));
        }
      }
      try {
        output.close();
        br.close();
        socket.close();
      }
 catch (      Exception e) {
        LOGGER.log(Level.WARNING,"exception",e);
      }
    }
  }
}
