/** 
 * 初始载入配置获取防火墙配置，配置防火墙方法之一，一共有两处，另一处:
 * @see FirewallConfig
 * @modification 修改增加网段白名单
 * @date 2016/12/8
 * @modifiedBy Hash Zhang
 */
private void loadFirewall(Element root) throws IllegalAccessException, InvocationTargetException {
  NodeList list=root.getElementsByTagName("host");
  Map<String,List<UserConfig>> whitehost=new HashMap<>();
  Map<Pattern,List<UserConfig>> whitehostMask=new HashMap<>();
  for (int i=0, n=list.getLength(); i < n; i++) {
    Node node=list.item(i);
    if (node instanceof Element) {
      Element e=(Element)node;
      String hostStr=e.getAttribute("host").trim();
      String userStr=e.getAttribute("user").trim();
      String[] hosts=hostStr.split(",");
      for (      String host : hosts) {
        host=host.trim();
        if (this.firewall.existsHost(host)) {
          throw new ConfigException("host duplicated : " + host);
        }
      }
      String[] users=userStr.split(",");
      List<UserConfig> userConfigs=new ArrayList<UserConfig>();
      for (      String user : users) {
        user=user.trim();
        UserConfig uc=this.users.get(user);
        if (null == uc) {
          throw new ConfigException("[user: " + user + "] doesn't exist in [host: "+ hostStr+ "]");
        }
        if (uc.getSchemas() == null || uc.getSchemas().size() == 0) {
          throw new ConfigException("[host: " + hostStr + "] contains one root privileges user: "+ user);
        }
        userConfigs.add(uc);
      }
      for (      String host : hosts) {
        host=host.trim();
        if (host.contains("*") || host.contains("%")) {
          whitehostMask.put(FirewallConfig.getMaskPattern(host),userConfigs);
        }
 else {
          whitehost.put(host,userConfigs);
        }
      }
    }
  }
  firewall.setWhitehost(whitehost);
  firewall.setWhitehostMask(whitehostMask);
  WallConfig wallConfig=new WallConfig();
  NodeList blacklist=root.getElementsByTagName("blacklist");
  for (int i=0, n=blacklist.getLength(); i < n; i++) {
    Node node=blacklist.item(i);
    if (node instanceof Element) {
      Element e=(Element)node;
      String check=e.getAttribute("check");
      if (null != check) {
        firewall.setCheck(Boolean.parseBoolean(check));
      }
      Map<String,Object> props=ConfigUtil.loadElements((Element)node);
      ParameterMapping.mapping(wallConfig,props);
    }
  }
  firewall.setWallConfig(wallConfig);
  firewall.init();
}
