/** 
 * If the input stream is closed the output stream should not be closed as well.
 * @throws Exception should not happen
 */
@Test public void shouldNotCloseBothStreamsIfOutputStreamIsClosed() throws Exception {
  InBandBytestreamSession session=new InBandBytestreamSession(connection,initBytestream,initiatorJID);
  OutputStream outputStream=session.getOutputStream();
  outputStream.close();
  protocol.addResponse(null,Verification.requestTypeRESULT);
  InputStream inputStream=session.getInputStream();
  StanzaListener listener=Whitebox.getInternalState(inputStream,"dataPacketListener",StanzaListener.class);
  String base64Data=Base64.encode("Data");
  DataPacketExtension dpe=new DataPacketExtension(sessionID,0,base64Data);
  Data data=new Data(dpe);
  listener.processStanza(data);
  protocol.verifyAll();
  try {
    outputStream.flush();
    fail("should throw an exception");
  }
 catch (  IOException e) {
    assertTrue(e.getMessage().contains("closed"));
  }
  assertTrue(inputStream.read() != 0);
}
