/** 
 * Tests an automatic reconnection. Simulates a connection error and then waits until gets reconnected.
 */
public void testAutomaticReconnection() throws Exception {
  XMPPTCPConnection connection=getConnection(0);
  CountDownLatch latch=new CountDownLatch(1);
  XMPPTCPConnectionTestListener listener=new XMPPConnectionTestListener(latch);
  connection.addConnectionListener(listener);
  connection.notifyConnectionError(new Exception("Simulated Error"));
  latch.await(MIN_RECONNECT_WAIT,TimeUnit.SECONDS);
  assertEquals("The ConnectionListener.connectionStablished() notification was not fired",true,listener.reconnected);
  assertTrue("The ReconnectionManager algorithm has reconnected without waiting at least 5 seconds",listener.attemptsNotifications > 0);
  executeSomeServerInteraction(connection);
}
