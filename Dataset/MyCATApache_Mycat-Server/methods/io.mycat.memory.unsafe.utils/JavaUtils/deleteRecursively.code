public static void deleteRecursively(File file) throws IOException {
  if (file == null) {
    return;
  }
  if (file.isDirectory() && !isSymlink(file)) {
    IOException savedIOException=null;
    for (    File child : listFilesSafely(file)) {
      try {
        deleteRecursively(child);
      }
 catch (      IOException e) {
        savedIOException=e;
      }
    }
    if (savedIOException != null) {
      throw savedIOException;
    }
  }
  boolean deleted=file.delete();
  if (!deleted && file.exists()) {
    throw new IOException("Failed to delete: " + file.getAbsolutePath());
  }
}
