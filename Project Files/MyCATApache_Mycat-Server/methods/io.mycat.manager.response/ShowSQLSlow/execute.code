/** 
 * @param c
 * @param isClear   查询完成后是否清理掉内存里面的所有慢SQL数据
 * @param schema    逻辑库的schema，如果不为空 ，仅仅展示此schema的慢SQL
 */
public static void execute(ManagerConnection c,boolean isClear,String schema){
  ByteBuffer buffer=c.allocate();
  buffer=header.write(buffer,c,true);
  for (  FieldPacket field : fields) {
    buffer=field.write(buffer,c,true);
  }
  buffer=eof.write(buffer,c,true);
  byte packetId=eof.packetId;
  Map<String,UserStat> statMap=UserStatAnalyzer.getInstance().getUserStatMap();
  for (  UserStat userStat : statMap.values()) {
    String user=userStat.getUser();
    List<SQLRecord> keyList=userStat.getSqlRecorder().getRecords();
    for (    SQLRecord key : keyList) {
      if (key != null) {
        if (schema != null && !schema.equalsIgnoreCase(key.schema)) {
          continue;
        }
        RowDataPacket row=getRow(user,key,c.getCharset());
        row.packetId=++packetId;
        buffer=row.write(buffer,c,true);
      }
    }
    if (isClear) {
      userStat.getSqlRecorder().clear();
    }
  }
  EOFPacket lastEof=new EOFPacket();
  lastEof.packetId=++packetId;
  buffer=lastEof.write(buffer,c,true);
  c.write(buffer);
}
