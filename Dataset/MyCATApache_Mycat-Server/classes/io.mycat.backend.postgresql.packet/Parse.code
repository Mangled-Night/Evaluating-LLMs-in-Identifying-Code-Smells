/** 
 * 解析sql语句
 * @author Coollf
 */
public class Parse extends PostgreSQLPacket {
  private char marker=PacketMarker.F_Parse.getValue();
  private String name;
  private String sql;
  private short parameterNumber;
  private DateType[] parameterTypes;
  @Override public int getLength(){
    return 4 + name.getBytes(UTF8).length + sql.getBytes(UTF8).length+ 2+ 4 * parameterNumber;
  }
  @Override public char getMarker(){
    return marker;
  }
  public Parse(  String name,  String sql,  DateType... parameterTypes){
    this.name=(name == null) ? "\0" : (name.trim() + "\0");
    this.sql=(sql == null) ? "\0" : (sql.trim() + "\0");
    this.parameterNumber=(short)parameterTypes.length;
    this.parameterTypes=parameterTypes;
  }
  public void write(  ByteBuffer buffer) throws IOException {
    PIOUtils.SendChar(marker,buffer);
    PIOUtils.SendInteger4(getLength(),buffer);
    PIOUtils.SendString(name,buffer);
    PIOUtils.SendString(sql,buffer);
    PIOUtils.SendInteger2(parameterNumber,buffer);
    for (    DateType tp : parameterTypes) {
      PIOUtils.SendInteger4(tp.getValue(),buffer);
    }
  }
}
