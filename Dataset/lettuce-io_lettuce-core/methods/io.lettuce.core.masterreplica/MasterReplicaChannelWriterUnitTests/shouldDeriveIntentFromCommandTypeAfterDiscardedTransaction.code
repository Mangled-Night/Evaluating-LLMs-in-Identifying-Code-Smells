@Test void shouldDeriveIntentFromCommandTypeAfterDiscardedTransaction(){
  MasterReplicaChannelWriter writer=new MasterReplicaChannelWriter(connectionProvider,clientResources);
  when(connectionProvider.getConnectionAsync(any(ConnectionIntent.class))).thenReturn(CompletableFuture.completedFuture(connection));
  writer.write(mockCommand(CommandType.MULTI));
  writer.write(mockCommand(CommandType.DISCARD));
  writer.write(mockCommand(CommandType.GET));
  verify(connectionProvider,times(2)).getConnectionAsync(ConnectionIntent.WRITE);
  verify(connectionProvider).getConnectionAsync(ConnectionIntent.READ);
}
