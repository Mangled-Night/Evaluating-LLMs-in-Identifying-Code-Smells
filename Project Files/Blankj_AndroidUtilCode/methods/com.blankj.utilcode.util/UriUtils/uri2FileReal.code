/** 
 * Uri to file.
 * @param uri The uri.
 * @return file
 */
private static File uri2FileReal(final Uri uri){
  Log.d("UriUtils",uri.toString());
  String authority=uri.getAuthority();
  String scheme=uri.getScheme();
  String path=uri.getPath();
  if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.N && path != null) {
    String[] externals=new String[]{"/external/","/external_path/"};
    File file=null;
    for (    String external : externals) {
      if (path.startsWith(external)) {
        file=new File(Environment.getExternalStorageDirectory().getAbsolutePath() + path.replace(external,"/"));
        if (file.exists()) {
          Log.d("UriUtils",uri.toString() + " -> " + external);
          return file;
        }
      }
    }
    file=null;
    if (path.startsWith("/files_path/")) {
      file=new File(Utils.getApp().getFilesDir().getAbsolutePath() + path.replace("/files_path/","/"));
    }
 else     if (path.startsWith("/cache_path/")) {
      file=new File(Utils.getApp().getCacheDir().getAbsolutePath() + path.replace("/cache_path/","/"));
    }
 else     if (path.startsWith("/external_files_path/")) {
      file=new File(Utils.getApp().getExternalFilesDir(null).getAbsolutePath() + path.replace("/external_files_path/","/"));
    }
 else     if (path.startsWith("/external_cache_path/")) {
      file=new File(Utils.getApp().getExternalCacheDir().getAbsolutePath() + path.replace("/external_cache_path/","/"));
    }
    if (file != null && file.exists()) {
      Log.d("UriUtils",uri.toString() + " -> " + path);
      return file;
    }
  }
  if (ContentResolver.SCHEME_FILE.equals(scheme)) {
    if (path != null)     return new File(path);
    Log.d("UriUtils",uri.toString() + " parse failed. -> 0");
    return null;
  }
 else   if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT && DocumentsContract.isDocumentUri(Utils.getApp(),uri)) {
    if ("com.android.externalstorage.documents".equals(authority)) {
      final String docId=DocumentsContract.getDocumentId(uri);
      final String[] split=docId.split(":");
      final String type=split[0];
      if ("primary".equalsIgnoreCase(type)) {
        return new File(Environment.getExternalStorageDirectory() + "/" + split[1]);
      }
 else {
        StorageManager mStorageManager=(StorageManager)Utils.getApp().getSystemService(Context.STORAGE_SERVICE);
        try {
          Class<?> storageVolumeClazz=Class.forName("android.os.storage.StorageVolume");
          Method getVolumeList=mStorageManager.getClass().getMethod("getVolumeList");
          Method getUuid=storageVolumeClazz.getMethod("getUuid");
          Method getState=storageVolumeClazz.getMethod("getState");
          Method getPath=storageVolumeClazz.getMethod("getPath");
          Method isPrimary=storageVolumeClazz.getMethod("isPrimary");
          Method isEmulated=storageVolumeClazz.getMethod("isEmulated");
          Object result=getVolumeList.invoke(mStorageManager);
          final int length=Array.getLength(result);
          for (int i=0; i < length; i++) {
            Object storageVolumeElement=Array.get(result,i);
            final boolean mounted=Environment.MEDIA_MOUNTED.equals(getState.invoke(storageVolumeElement)) || Environment.MEDIA_MOUNTED_READ_ONLY.equals(getState.invoke(storageVolumeElement));
            if (!mounted)             continue;
            if ((Boolean)isPrimary.invoke(storageVolumeElement) && (Boolean)isEmulated.invoke(storageVolumeElement)) {
              continue;
            }
            String uuid=(String)getUuid.invoke(storageVolumeElement);
            if (uuid != null && uuid.equals(type)) {
              return new File(getPath.invoke(storageVolumeElement) + "/" + split[1]);
            }
          }
        }
 catch (        Exception ex) {
          Log.d("UriUtils",uri.toString() + " parse failed. " + ex.toString()+ " -> 1_0");
        }
      }
      Log.d("UriUtils",uri.toString() + " parse failed. -> 1_0");
      return null;
    }
 else     if ("com.android.providers.downloads.documents".equals(authority)) {
      String id=DocumentsContract.getDocumentId(uri);
      if (TextUtils.isEmpty(id)) {
        Log.d("UriUtils",uri.toString() + " parse failed(id is null). -> 1_1");
        return null;
      }
      if (id.startsWith("raw:")) {
        return new File(id.substring(4));
      }
 else       if (id.startsWith("msf:")) {
        id=id.split(":")[1];
      }
      long availableId=0;
      try {
        availableId=Long.parseLong(id);
      }
 catch (      Exception e) {
        return null;
      }
      String[] contentUriPrefixesToTry=new String[]{"content://downloads/public_downloads","content://downloads/all_downloads","content://downloads/my_downloads"};
      for (      String contentUriPrefix : contentUriPrefixesToTry) {
        Uri contentUri=ContentUris.withAppendedId(Uri.parse(contentUriPrefix),availableId);
        try {
          File file=getFileFromUri(contentUri,"1_1");
          if (file != null) {
            return file;
          }
        }
 catch (        Exception ignore) {
        }
      }
      Log.d("UriUtils",uri.toString() + " parse failed. -> 1_1");
      return null;
    }
 else     if ("com.android.providers.media.documents".equals(authority)) {
      final String docId=DocumentsContract.getDocumentId(uri);
      final String[] split=docId.split(":");
      final String type=split[0];
      Uri contentUri;
      if ("image".equals(type)) {
        contentUri=MediaStore.Images.Media.EXTERNAL_CONTENT_URI;
      }
 else       if ("video".equals(type)) {
        contentUri=MediaStore.Video.Media.EXTERNAL_CONTENT_URI;
      }
 else       if ("audio".equals(type)) {
        contentUri=MediaStore.Audio.Media.EXTERNAL_CONTENT_URI;
      }
 else {
        Log.d("UriUtils",uri.toString() + " parse failed. -> 1_2");
        return null;
      }
      final String selection="_id=?";
      final String[] selectionArgs=new String[]{split[1]};
      return getFileFromUri(contentUri,selection,selectionArgs,"1_2");
    }
 else     if (ContentResolver.SCHEME_CONTENT.equals(scheme)) {
      return getFileFromUri(uri,"1_3");
    }
 else {
      Log.d("UriUtils",uri.toString() + " parse failed. -> 1_4");
      return null;
    }
  }
 else   if (ContentResolver.SCHEME_CONTENT.equals(scheme)) {
    return getFileFromUri(uri,"2");
  }
 else {
    Log.d("UriUtils",uri.toString() + " parse failed. -> 3");
    return null;
  }
}
