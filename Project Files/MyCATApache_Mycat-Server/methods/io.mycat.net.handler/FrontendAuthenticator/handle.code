@Override public void handle(byte[] data){
  if (data.length == QuitPacket.QUIT.length && data[4] == MySQLPacket.COM_QUIT) {
    source.close("quit packet");
    return;
  }
  if (auth == null) {
    auth=new AuthPacket();
    auth.read(data);
    if (auth.clientAuthPlugin != null && !DEFAULT_AUTH_PLUGIN_NAME.equals(auth.clientAuthPlugin)) {
      AuthSwitchPacket authSwitch=new AuthSwitchPacket(DEFAULT_AUTH_PLUGIN_NAME.getBytes(),source.getSeed());
      authSwitch.packetId=2;
      authSwitch.write(this.source);
      return;
    }
  }
 else {
    AuthSwitchPacket authSwitch=new AuthSwitchPacket();
    authSwitch.read(data);
    auth.password=authSwitch.getAuthMethodData();
    AUTH_OK=new byte[]{7,0,0,4,0,0,0,2,0,0,0};
  }
  int nopassWordLogin=MycatServer.getInstance().getConfig().getSystem().getNonePasswordLogin();
  boolean skipPassWord=false;
  String defaultUser="";
  if (nopassWordLogin == 1) {
    skipPassWord=true;
    Map<String,UserConfig> userMaps=MycatServer.getInstance().getConfig().getUsers();
    if (!userMaps.isEmpty()) {
      setDefaultAccount(auth,userMaps);
    }
  }
  if (!checkUser(auth.user,source.getHost())) {
    failure(ErrorCode.ER_ACCESS_DENIED_ERROR,"Access denied for user '" + auth.user + "' with host '"+ source.getHost()+ "'");
    return;
  }
  if (!skipPassWord && !checkPassword(auth.password,auth.user)) {
    failure(ErrorCode.ER_ACCESS_DENIED_ERROR,"Access denied for user '" + auth.user + "', because password is error ");
    return;
  }
  if (isDegrade(auth.user)) {
    failure(ErrorCode.ER_ACCESS_DENIED_ERROR,"Access denied for user '" + auth.user + "', because service be degraded ");
    return;
  }
switch (checkSchema(auth.database,auth.user)) {
case ErrorCode.ER_BAD_DB_ERROR:
    failure(ErrorCode.ER_BAD_DB_ERROR,"Unknown database '" + auth.database + "'");
  break;
case ErrorCode.ER_DBACCESS_DENIED_ERROR:
String s="Access denied for user '" + auth.user + "' to database '"+ auth.database+ "'";
failure(ErrorCode.ER_DBACCESS_DENIED_ERROR,s);
break;
default :
success(auth);
}
}
