/** 
 * InBandBytestreamRequest class handles incoming In-Band Bytestream requests.
 * @author Henning Staib
 */
public class InBandBytestreamRequest implements BytestreamRequest {
  private final Open byteStreamRequest;
  private final InBandBytestreamManager manager;
  protected InBandBytestreamRequest(  InBandBytestreamManager manager,  Open byteStreamRequest){
    this.manager=manager;
    this.byteStreamRequest=byteStreamRequest;
  }
  /** 
 * Returns the sender of the In-Band Bytestream open request.
 * @return the sender of the In-Band Bytestream open request
 */
  @Override public Jid getFrom(){
    return this.byteStreamRequest.getFrom();
  }
  /** 
 * Returns the session ID of the In-Band Bytestream open request.
 * @return the session ID of the In-Band Bytestream open request
 */
  @Override public String getSessionID(){
    return this.byteStreamRequest.getSessionID();
  }
  /** 
 * Accepts the In-Band Bytestream open request and returns the session to send/receive data.
 * @return the session to send/receive data
 * @throws NotConnectedException if the XMPP connection is not connected.
 * @throws InterruptedException if the calling thread was interrupted.
 */
  @Override public InBandBytestreamSession accept() throws NotConnectedException, InterruptedException {
    XMPPConnection connection=this.manager.getConnection();
    InBandBytestreamSession ibbSession=new InBandBytestreamSession(connection,this.byteStreamRequest,this.byteStreamRequest.getFrom());
    this.manager.getSessions().put(this.byteStreamRequest.getSessionID(),ibbSession);
    IQ resultIQ=IQ.createResultIQ(this.byteStreamRequest);
    connection.sendStanza(resultIQ);
    return ibbSession;
  }
  /** 
 * Rejects the In-Band Bytestream request by sending a reject error to the initiator.
 * @throws NotConnectedException if the XMPP connection is not connected.
 * @throws InterruptedException if the calling thread was interrupted.
 */
  @Override public void reject() throws NotConnectedException, InterruptedException {
    this.manager.replyRejectPacket(this.byteStreamRequest);
  }
}
