/** 
 * Build sessions with all devices from the set, we don't have a session with yet. Return the set of all devices we have a session with afterwards.
 * @param connection authenticated XMPP connection
 * @param userDevice our OmemoDevice
 * @param devices set of devices we may want to build a session with if necessary
 * @return set of all devices with sessions
 * @throws SmackException.NotConnectedException if the XMPP connection is not connected.
 * @throws InterruptedException if the calling thread was interrupted.
 * @throws SmackException.NoResponseException if there was no response from the remote entity.
 * @throws IOException if an I/O error occurred.
 */
private Set<OmemoDevice> buildMissingSessionsWithDevices(XMPPConnection connection,OmemoDevice userDevice,Set<OmemoDevice> devices) throws SmackException.NotConnectedException, InterruptedException, SmackException.NoResponseException, IOException {
  Set<OmemoDevice> devicesWithSession=new HashSet<>();
  for (  OmemoDevice device : devices) {
    if (hasSession(userDevice,device)) {
      devicesWithSession.add(device);
      continue;
    }
    try {
      buildFreshSessionWithDevice(connection,userDevice,device);
      devicesWithSession.add(device);
    }
 catch (    CannotEstablishOmemoSessionException e) {
      LOGGER.log(Level.WARNING,userDevice + " cannot establish session with " + device+ " because their bundle could not be fetched.",e);
    }
catch (    CorruptedOmemoKeyException e) {
      LOGGER.log(Level.WARNING,userDevice + " could not establish session with " + device+ "because their bundle seems to be corrupt.",e);
    }
  }
  return devicesWithSession;
}
