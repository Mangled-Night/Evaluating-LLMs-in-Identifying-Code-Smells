public abstract class BlockLifecycleEvent implements Event, Iterable<Vector3ic> {
  private TIntList positions;
  private BlockEntityRegistry registry;
  public BlockLifecycleEvent(  TIntList positions,  BlockEntityRegistry registry){
    this.registry=registry;
    this.positions=positions;
  }
  @Override public Iterator<Vector3ic> iterator(){
    if (positions.size() < 3) {
      return Collections.emptyIterator();
    }
    return new Iterator<Vector3ic>(){
      private Vector3i next=new Vector3i(positions.get(0),positions.get(1),positions.get(2));
      private final Vector3i current=new Vector3i();
      private int index=3;
      @Override public boolean hasNext(){
        return next != null;
      }
      @Override public Vector3ic next(){
        if (next == null) {
          throw new NoSuchElementException();
        }
        current.set(next);
        fetchNext();
        return current;
      }
      private void fetchNext(){
        while (index < positions.size() - 2) {
          next.x=positions.get(index++);
          next.y=positions.get(index++);
          next.z=positions.get(index++);
          if (!registry.hasPermanentBlockEntity(next)) {
            return;
          }
        }
        next=null;
      }
    }
;
  }
  public int blockCount(){
    return positions.size() / 3;
  }
}
