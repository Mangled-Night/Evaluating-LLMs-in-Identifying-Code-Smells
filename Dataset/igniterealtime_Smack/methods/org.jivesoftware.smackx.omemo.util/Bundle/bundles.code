/** 
 * Break up the OmemoBundleElement into a list of crypto-lib specific bundles (T_PreKey). In case of the signal library, we break the OmemoBundleElement in ~100 PreKeyBundles (one for every transported preKey).
 * @param bundle  OmemoBundleElement containing multiple PreKeys
 * @param contact Contact that the bundle belongs to
 * @return a HashMap with one T_Bundle per preKey and the preKeyId as key
 * @throws CorruptedOmemoKeyException when one of the keys cannot be parsed
 */
public HashMap<Integer,T_Bundle> bundles(OmemoBundleElement bundle,OmemoDevice contact) throws CorruptedOmemoKeyException {
  HashMap<Integer,T_Bundle> bundles=new HashMap<>();
  for (  int deviceId : bundle.getPreKeys().keySet()) {
    try {
      bundles.put(deviceId,bundleFromOmemoBundle(bundle,contact,deviceId));
    }
 catch (    CorruptedOmemoKeyException e) {
      LOGGER.log(Level.INFO,"Cannot parse PreKeyBundle: " + e.getMessage());
    }
  }
  if (bundles.size() == 0) {
    throw new CorruptedOmemoKeyException("Bundle contained no valid preKeys.");
  }
  return bundles;
}
